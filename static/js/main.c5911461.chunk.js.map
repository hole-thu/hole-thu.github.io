{"version":3,"sources":["color_picker.js","text_splitter.js","infrastructure/functions.js","infrastructure/widgets.js","Config.js","Markdown.js","Common.js","Message.js","cache.js","flows_api.js","Attention.js","UserAction.js","Flows.js","Title.js","Sidebar.js","PressureHelper.js","App.js","registerServiceWorker.js","index.js"],"names":["ColorPicker","this","names","current_h","Math","random","name","is_tmp","toLowerCase","PID_RE","URL_PID_RE","NICKNAME_RE","URL_RE","TAG_RE","split_text","txt","rules","forEach","rule","regex","concat","apply","map","part","content","split","seg","test","filter","get_json","res","ok","text","then","t","JSON","parse","e","console","error","trace","log","SyntaxError","substr","length","Error","status","statusText","NAMES","pad2","x","format_time","time","getMonth","getDate","getHours","getMinutes","getSeconds","chinese_format","buildFormatter","chineseStrings","Time","props","Date","stamp","className","date","formatter","title","toLocaleString","timeZone","hour12","short","TitleLine","LoginPopupSelf","state","loading_status","input_token_ref","React","createRef","tar","ref","preventDefault","href","current","value","alert","target","placeholder","onClick","setThuhole","type","disabled","on_close","Component","LoginPopup","popup_show","on_popup_bound","on_popup","bind","on_close_bound","setState","children","token_callback","BUILTIN_IMGS","DEFAULT_CONFIG","background_img","background_color","pressure","easter_egg","color_scheme","block_words_v3","whitelist_cw","ipfs_gateway_list","load_config","loaded_config","config","Object","assign","localStorage","keys","key","undefined","window","save_config","need_load","stringify","bgimg_style","img","color","background","backgroundImage","encodeURI","backgroundColor","backgroundSize","ConfigBackground","callback","save_changes","img_select","indexOf","onChange","on_select","on_change_img","on_change_color","style","PureComponent","ConfigColorScheme","ConfigTextArea","id","sift","description","display","on_change","ConfigSwitch","switch","val","checked","ConfigUI","save_changes_bound","chg","confirm","location","reload","reset_settings","array","join","v","string","md","MarkdownIt","html","linkify","breaks","inline","highlight","str","lang","hljs","getLanguage","__","utils","escapeHtml","use","MarkdownItKaTeX","throwOnError","errorColor","API_BASE","ColoredSpan","colors","normalize_url","url","stop_loading","parentNode","classList","remove","HighlightedMarkdown","processInstructions","shouldProcessNode","node","processNode","index","currentLevel","HeadingTag","src","attribs","alt","referrerPolicy","onError","onLoad","rel","parent","originalText","data","search_param","search_kws","s","push","RegExp","replace","splitted","Fragment","idx","p","URL","pathname","endsWith","searchParams","get","startsWith","is_video","controls","is_audio","show_pid","substring","color_picker","HtmlToReact","ProcessNodeDefinitions","processDefaultNode","parser","Parser","rawMd","renderedMarkdown","render","parseWithInstructions","TEXTAREA_BACKUP","SafeTextarea","on_change_bound","on_keydown_bound","on_keydown","clear","area_ref","change_callback","submit_callback","on_submit","event","ctrlKey","altKey","focus","onKeyDown","maxLength","pwa_prompt_event","PromotionBar","is_ios","navigator","userAgent","matchMedia","matches","standalone","prompt","addEventListener","ClickHandler","moved","init_y","init_x","on_begin_bound","on_begin","on_move_bound","on_move","on_end_bound","on_end","MOVE_THRESHOLD","last_fire","touches","screenY","screenX","abs","do_callback","onTouchStart","onMouseDown","onTouchMove","onMouseMove","MessageViewer","msg","input_suf_ref","load","fetch","headers","token","json","start_time","salt","tmp_token","catch","err","tt","do_set_token","timestamp","user","detail","Cache","db","added_items_since_maintenance","encrypt","decrypt","open_req","indexedDB","open","onerror","onupgradeneeded","result","createObjectStore","keyPath","createIndex","unique","onsuccess","setTimeout","maintenance","pid","o","i","new_key","charCodeAt","String","fromCharCode","c","target_version","parseInt","Promise","resolve","reject","store","transaction","objectStore","get_req","data_str","version","last_access","put","delete","warn","req","count_req","count","openKeyCursor","cur","primaryKey","continue","deleteDatabase","cache","hole_cache","handle_response","response","a","notify","code","parse_replies","replies","sort","b","cid","info","name_id","r","gen_name","_display_color","variant","API","load_replies","cache_version","load_replies_with_cache","cached","set_attention","attention","URLSearchParams","append","method","body","report","reason","block","del","note","update_cw","cw","get_list","page","submode","get_search","keyword","encodeURIComponent","get_single","get_attention","add_vote","vote","get_multi","pids","set_title","save_attentions","saved_attentions","REPOSITORY","EMAIL","TokenCtx","createContext","set_value","InfoSidebar","show_sidebar","serviceWorker","getRegistrations","registrations","registration","unregister","process","LoginForm","custom_title","TITLE","auto_block_rank","AUTO_BLCOK","FormData","j","rank","copy","Consumer","copy_token","update_title","width","min","max","list","update_auto_block","do_popup","ReplyForm","preview","use_title","on_use_title_change_bound","on_use_title_change","global_keypress_handler_bound","global_keypress_handler","tagName","document","removeEventListener","includes","unshift","on_complete","onSubmit","toggle_preview","PostForm","upload_progress_text","is_loading","file_name","file_type","CW_BACKUP","allow_search","AS_BACKUP","has_poll","POLL_BACKUP","poll_options","on_allow_search_change_bound","on_allow_search_change","on_cw_change_bound","on_cw_change","on_poll_option_change_bound","on_poll_option_change","opt","do_post","splice","f","files","xh","XMLHttpRequest","upload","upload_progress","upload_complete","upload_error","upload_abort","setRequestHeader","send","replaceAll","hash","curr","y","test_ipfs","new_text","origin","set","loaded","total","toFixed","responseText","update_text_after_upload","on_file_change","option","CLICKABLE_TAGS","audio","QUOTE_BLACKLIST","LATEST_POST_ID","load_single_meta","title_elem","single","reply","deletion_detect","Reply","do_filter_name","do_delete","do_report","do_block","author","replyText","has_block_words","some","word","can_del","author_title","dangerous_user","blocked_count","FlowItem","likenum","is_quote","do_edit_cw","img_clickable","do_vote","copy_link","is_reported","hot_score","poll","question","answers","onVote","customStyles","theme","noStorage","latest_reply","FlowSidebar","error_msg","filter_name","rev","syncState","sync_state","reply_ref","prev","update_count","set_variant","prev_info","prevState","forceCheck","closest","should_text","replies_to_show","slice","reverse","replies_cnt","main_thread_elem","show_reply_bar","set_filter_name","make_do_delete","toggle_rev","toggle_attention","float","is_blocked","offset","height","overflow","once","FlowItemRow","needFold","mode","comments","reply_status","reply_error","hl_rules","parts","quote_id","FlowItemQuote","FlowChunk","ind","hiddenIfInvisible","Flow","toUpperCase","by_c","submode_names","get_submode_names","set_submode","search_text","SubFlow","loaded_pages","chunks","export_text","on_scroll_bound","on_scroll","failed","max_id","comment_json","finished","use_search","use_regex","match","regex_search","toString","post","every","Array","from","Set","scrollHeight","scrollY","innerHeight","load_page","max_len","can_export","trunc_string","should_deletion_detect","gen_export","readOnly","flag_re","ControlBar","set_mode","on_keypress_bound","on_keypress","do_refresh_bound","do_refresh","do_attention_bound","do_attention","decodeURIComponent","lastIndexOf","flag_res","exec","scrollTo","onKeyPress","Title","Sidebar","do_close_bound","do_close","do_back_bound","do_back","contents","stack","cur_title","onTouchEnd","click","PressureHelper","level","fired","esc_interval","clearInterval","Pressure","change","force","do_fire","end","polyfill","only","preventSelect","repeat","THRESHOLD","setInterval","new_level","pad","left","right","top","bottom","DeprecatedAlert","App","override","update_color_scheme","add","addListener","listen_darkmode","default","light","dark","sidebar_stack","flow_render_key","show_sidebar_bound","set_mode_bound","on_pressure_bound","on_pressure","ns","position","pop","protocol","hostname","arg","search","tmp_token_suf","Provider","isLocalhost","Boolean","registerValidSW","swUrl","register","onupdatefound","installingWorker","installing","onstatechange","controller","ReactDOM","getElementById","ready","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.c5911461.chunk.js","sourcesContent":["// https://martin.ankerl.com/2009/12/09/how-to-create-random-colors-programmatically/\n\nconst golden_ratio_conjugate = 0.618033988749895;\n\nexport class ColorPicker {\n  constructor() {\n    this.names = {};\n    this.current_h = Math.random();\n  }\n\n  get(name, is_tmp = false) {\n    name = name.toLowerCase();\n    if (is_tmp) return ['hsl(0, 0%, 86%)', 'hsl(0, 0%, 25%)'];\n    if (name === '洞主') return ['hsl(0, 0%, 97%)', 'hsl(0, 0%, 16%)'];\n\n    if (!this.names[name]) {\n      this.current_h += golden_ratio_conjugate;\n      this.current_h %= 1;\n      this.names[name] = [\n        `hsl(${this.current_h * 360}, 50%, 90%)`,\n        `hsl(${this.current_h * 360}, 60%, 20%)`,\n      ];\n    }\n    return this.names[name];\n  }\n}\n","// regexp should match the WHOLE segmented part\n// export const PID_RE=/(^|[^\\d\\u20e3\\ufe0e\\ufe0f])([2-9]\\d{4,5}|1\\d{4,6})(?![\\d\\u20e3\\ufe0e\\ufe0f])/g;\nexport const PID_RE = /(^|[^\\d\\u20e3\\ufe0e\\ufe0f])(#\\d{1,7})(?![\\d\\u20e3\\ufe0e\\ufe0f])/g;\n// TODO: fix this re\n// export const URL_PID_RE=/((?:https?:\\/\\/)?thuhole\\.com\\/?#(?:#|%23)([2-9]\\d{4,5}|1\\d{4,6}))(?!\\d|\\u20e3|\\ufe0e|\\ufe0f)/g;\nexport const URL_PID_RE = /((?:https?:\\/\\/)?hole\\.thu\\.monster\\/?#(?:#|%23)(\\d{1,7}))(?!\\d|\\u20e3|\\ufe0e|\\ufe0f)/g;\nexport const NICKNAME_RE = /(^|[^A-Za-z])((?:(?:Angry|Baby|Crazy|Diligent|Excited|Fat|Greedy|Hungry|Interesting|Jolly|Kind|Little|Magic|Naïve|Old|PKU|Quiet|Rich|Superman|Tough|Undefined|Valuable|Wifeless|Xiangbuchulai|Young|Zombie)\\s)?(?:Alice|Bob|Carol|Dave|Eve|Francis|Grace|Hans|Isabella|Jason|Kate|Louis|Margaret|Nathan|Olivia|Paul|Queen|Richard|Susan|Thomas|Uma|Vivian|Winnie|Xander|Yasmine|Zach)|You Win(?: \\d+)?|洞主)(?![A-Za-z])/gi;\nexport const URL_RE = /(^|[^.@a-zA-Z0-9_])((?:https?:\\/\\/)?(?:(?:[\\w-]+\\.)+[a-zA-Z]{2,7}|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,5})(?::\\d{1,5})?(?:\\/[\\w~!@#$%^&*()\\-_=+[\\]{};:,./?|]*)?)(?![a-zA-Z0-9])/gi;\n\nexport const TAG_RE = /(^|\\s)(#[^#\\s]{1,32})($|\\s|#)/g;\n\nexport function split_text(txt, rules) {\n  // rules: [['name',/regex/],...]\n  // return: [['name','part'],[null,'part'],...]\n\n  txt = [[null, txt]];\n  rules.forEach((rule) => {\n    let [name, regex] = rule;\n    txt = [].concat.apply(\n      [],\n      txt.map((part) => {\n        let [rule, content] = part;\n        if (rule)\n          // already tagged by previous rules\n          return [part];\n        else {\n          return content\n            .split(regex)\n            .map((seg) => (regex.test(seg) ? [name, seg] : [null, seg]))\n            .filter(([name, seg]) => name !== null || seg);\n        }\n      }),\n    );\n  });\n  return txt;\n}\n","export function get_json(res) {\n  if (!res.ok) {\n    return res.text().then((t) => {\n      console.log('error:', res);\n      t = t.length < 100 ? t : '';\n      throw Error(`${res.status} ${res.statusText} ${t}`);\n    });\n  }\n  return res.text().then((t) => {\n    try {\n      return JSON.parse(t);\n    } catch (e) {\n      console.error('json parse error');\n      console.trace(e);\n      console.log(t);\n      throw new SyntaxError('JSON Parse Error ' + t.substr(0, 50));\n    }\n  });\n}\n\nexport function listen_darkmode(override) {\n  // override: true/false/undefined\n  function update_color_scheme() {\n    if (\n      override === undefined\n        ? window.matchMedia('(prefers-color-scheme: dark)').matches\n        : override\n    )\n      document.body.classList.add('root-dark-mode');\n    else document.body.classList.remove('root-dark-mode');\n  }\n\n  update_color_scheme();\n  window.matchMedia('(prefers-color-scheme: dark)').addListener(() => {\n    update_color_scheme();\n  });\n}\n\nconst NAMES = [\n  'Alice',\n  'Bob',\n  'Carol',\n  'Dave',\n  'Eve',\n  'Francis',\n  'Grace',\n  'Hans',\n  'Isabella',\n  'Jason',\n  'Kate',\n  'Louis',\n  'Margaret',\n  'Nathan',\n  'Olivia',\n  'Paul',\n  'Queen',\n  'Richard',\n  'Susan',\n  'Thomas',\n  'Uma',\n  'Vivian',\n  'Winnie',\n  'Xander',\n  'Yasmine',\n  'Zach',\n];\n\nexport function gen_name(name_id) {\n  if (name_id == 0) return '洞主';\n\n  let r = name_id;\n  let name = '';\n  do {\n    r -= 1;\n    name += ' ' + NAMES[r % 26];\n    r = parseInt(r / 26);\n  } while (r);\n\n  return name.substr(1);\n}\n","import React, { Component, PureComponent } from 'react';\nimport ReactDOM from 'react-dom';\n\nimport TimeAgo from 'react-timeago';\nimport chineseStrings from 'react-timeago/lib/language-strings/zh-CN';\nimport buildFormatter from 'react-timeago/lib/formatters/buildFormatter';\n\nimport './global.css';\nimport './widgets.css';\n\nimport { get_json, API_VERSION_PARAM } from './functions';\n\nfunction pad2(x) {\n  return x < 10 ? '0' + x : '' + x;\n}\nexport function format_time(time) {\n  return `${time.getMonth() + 1}-${pad2(\n    time.getDate(),\n  )} ${time.getHours()}:${pad2(time.getMinutes())}:${pad2(time.getSeconds())}`;\n}\nconst chinese_format = buildFormatter(chineseStrings);\nexport function Time(props) {\n  const time = new Date(props.stamp * 1000);\n  return (\n    <span className={'time-str'}>\n      <TimeAgo\n        date={time}\n        formatter={chinese_format}\n        title={time.toLocaleString('zh-CN', {\n          timeZone: 'Asia/Shanghai',\n          hour12: false,\n        })}\n      />\n      &nbsp;\n      {!props.short ? format_time(time) : null}\n    </span>\n  );\n}\n\nexport function TitleLine(props) {\n  return (\n    <p className=\"centered-line title-line aux-margin\">\n      <span className=\"black-outline\">{props.text}</span>\n    </p>\n  );\n}\n\nexport function GlobalTitle(props) {\n  return (\n    <div className=\"aux-margin\">\n      <div className=\"title\">\n        <p className=\"centered-line\">{props.text}</p>\n      </div>\n    </div>\n  );\n}\n\nclass LoginPopupSelf extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading_status: 'idle',\n    };\n\n    this.input_token_ref = React.createRef();\n  }\n\n  setThuhole(e, tar, ref) {\n    console.log(tar);\n    e.preventDefault();\n    tar.href = '/_login?p=thuhole&token=' + ref.current.value;\n    console.log(tar);\n    alert('T大树洞已经没有啦😭');\n  }\n\n  render() {\n    return (\n      <div>\n        <div className=\"thuhole-login-popup-shadow\" />\n        <div className=\"thuhole-login-popup\">\n          <p>\n            <b>通过第三方验证登陆新T树洞</b>\n          </p>\n          <p>\n            <a href=\"/_login?p=cs\" target=\"_blank\">\n              <span className=\"icon icon-login\" />\n              &nbsp;闭社\n            </a>\n          </p>\n          <p>\n            <input ref={this.input_token_ref} placeholder=\"T大树洞Token\" />\n            <br />\n            <a\n              href=\"/_login?p=thuhole\"\n              target=\"_blank\"\n              onClick={(e) => {\n                this.setThuhole(e, e.target, this.input_token_ref);\n              }}\n            >\n              <span className=\"icon icon-login\" />\n              &nbsp;T大树洞\n            </a>\n          </p>\n          <p>\n            <small>前往Telegram群查询15分钟临时token</small>\n            <br />\n            <a href=\"//t.me/THUChatBot\" target=\"_blank\">\n              <span className=\"icon icon-login\" />\n              &nbsp;清华大水群\n            </a>\n          </p>\n          <p>\n            <button type=\"button\" disabled>\n              <span className=\"icon icon-login\" />\n              &nbsp;未名bbs\n            </button>\n          </p>\n          <p>\n            <button type=\"button\" disabled>\n              <span className=\"icon icon-login\" />\n              &nbsp;清华统一身份认证\n            </button>\n          </p>\n          <hr />\n          <p>\n            <button onClick={this.props.on_close}>取消</button>\n          </p>\n          <hr />\n          <div className=\"thuhole-login-popup-info\">\n            <p>提醒:</p>\n            <ul>\n              <li>\n                {' '}\n                无论采用哪种方式注册，你后台记录的用户名都是本质实名的（除临时token），因为闭社/T大树洞的管理员可以根据你的闭社id/树洞评论区代号查到邮箱。但是这不影响新T树洞的安全性。新T树洞的匿名性来自隔离用户名与发布的内容，而非试图隔离用户名与真实身份。\n              </li>\n              <li>\n                {' '}\n                由于T大树洞仍未提供授权接口，使用T大树洞方式登陆需要用你的token在特定洞发布一段随机内容以确定身份。这是否违反用户条例由T大树洞管理员决定，需自行承担相关风险。完成登陆后建议立即重置T大树洞token。{' '}\n              </li>\n              <li> 目前一个人可能有两个帐号。</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport class LoginPopup extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      popup_show: false,\n    };\n    this.on_popup_bound = this.on_popup.bind(this);\n    this.on_close_bound = this.on_close.bind(this);\n  }\n\n  on_popup() {\n    this.setState({\n      popup_show: true,\n    });\n  }\n  on_close() {\n    this.setState({\n      popup_show: false,\n    });\n  }\n\n  render() {\n    return (\n      <>\n        {this.props.children(this.on_popup_bound)}\n        {this.state.popup_show && (\n          <LoginPopupSelf\n            token_callback={this.props.token_callback}\n            on_close={this.on_close_bound}\n          />\n        )}\n      </>\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\n\nimport './Config.css';\n\nconst BUILTIN_IMGS = {\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/gbp.jpg':\n    '怀旧背景（默认）',\n  'https://www.tsinghua.edu.cn/image/nav-bg.jpg': '清华紫',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/gbp.jpg':\n    '寻觅繁星',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/eriri.jpg':\n    '平成著名画师',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/yurucamp.jpg':\n    '露营天下第一',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/minecraft.jpg':\n    '麦恩·库拉夫特',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/cyberpunk.jpg':\n    '赛博城市',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/bj.jpg':\n    '城市的星光',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/sif.jpg':\n    '梦开始的地方',\n};\n\nconst DEFAULT_CONFIG = {\n  background_img:\n    '//cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/gbp.jpg',\n  background_color: '#113366',\n  pressure: false,\n  easter_egg: true,\n  color_scheme: 'default',\n  block_words_v3: ['蜘蛛'],\n  whitelist_cw: [],\n  ipfs_gateway_list: [\n    'https://<hash>.ipfs.dweb.link/',\n    'https://<hash>.ipfs.hub.textile.io/',\n    'https://<hash>.ipfs.infura-ipfs.io/',\n    'https://ipfs.adatools.io/ipfs/<hash>',\n    'https://<hash>.ipfs.astyanax.io/',\n    'https://crustwebsites.net/ipfs/<hash>',\n    'https://gateway.pinata.cloud/ipfs/<hash>',\n    'https://ipfs.eth.aragon.network/ipfs/<hash>',\n    'https://ipfs.best-practice.se/ipfs/<hash>',\n    'https://gateway.ipfs.io/ipfs/<hash>',\n    'https://ipfs.fleek.co/ipfs/<hash>',\n    'https://cloudflare-ipfs.com/ipfs/<hash>',\n    'https://via0.com/ipfs/<hash>',\n  ],\n};\n\nexport function load_config() {\n  let config = Object.assign({}, DEFAULT_CONFIG);\n  let loaded_config;\n  try {\n    loaded_config = JSON.parse(localStorage['hole_config'] || '{}');\n  } catch (e) {\n    alert('设置加载失败，将重置为默认设置！\\n' + e);\n    delete localStorage['hole_config'];\n    loaded_config = {};\n  }\n\n  // unrecognized configs are removed\n  Object.keys(loaded_config).forEach((key) => {\n    if (config[key] !== undefined) config[key] = loaded_config[key];\n  });\n\n  if (loaded_config['block_words_v2']) {\n    config['block_words_v3'] = loaded_config['block_words_v2'].concat(\n      config['block_words_v3'],\n    );\n  }\n\n  console.log('config loaded', config);\n  window.config = config;\n}\nexport function save_config(need_load = true) {\n  localStorage['hole_config'] = JSON.stringify(window.config);\n  if (need_load) load_config();\n}\n\nexport function bgimg_style(img, color) {\n  if (img === undefined) img = window.config.background_img;\n  if (color === undefined) color = window.config.background_color;\n  return {\n    background: 'transparent center center',\n    backgroundImage: img === null ? 'unset' : 'url(\"' + encodeURI(img) + '\")',\n    backgroundColor: color,\n    backgroundSize: 'cover',\n  };\n}\n\nclass ConfigBackground extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      img: window.config.background_img,\n      color: window.config.background_color,\n    };\n  }\n\n  save_changes() {\n    this.props.callback({\n      background_img: this.state.img,\n      background_color: this.state.color,\n    });\n  }\n\n  on_select(e) {\n    let value = e.target.value;\n    this.setState(\n      {\n        img: value === '##other' ? '' : value === '##color' ? null : value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n  on_change_img(e) {\n    this.setState(\n      {\n        img: e.target.value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n  on_change_color(e) {\n    this.setState(\n      {\n        color: e.target.value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n\n  render() {\n    let img_select =\n      this.state.img === null\n        ? '##color'\n        : Object.keys(BUILTIN_IMGS).indexOf(this.state.img) === -1\n        ? '##other'\n        : this.state.img;\n    return (\n      <div>\n        <p>\n          <b>背景图片：</b>\n          <select\n            className=\"config-select\"\n            value={img_select}\n            onChange={this.on_select.bind(this)}\n          >\n            {Object.keys(BUILTIN_IMGS).map((key) => (\n              <option key={key} value={key}>\n                {BUILTIN_IMGS[key]}\n              </option>\n            ))}\n            <option value=\"##other\">输入图片网址……</option>\n            <option value=\"##color\">纯色背景……</option>\n          </select>\n          &nbsp;\n          <small>#background_img</small>&nbsp;\n          {img_select === '##other' && (\n            <input\n              type=\"url\"\n              placeholder=\"图片网址\"\n              value={this.state.img}\n              onChange={this.on_change_img.bind(this)}\n            />\n          )}\n          {img_select === '##color' && (\n            <input\n              type=\"color\"\n              value={this.state.color}\n              onChange={this.on_change_color.bind(this)}\n            />\n          )}\n        </p>\n        <div\n          className=\"bg-preview\"\n          style={bgimg_style(this.state.img, this.state.color)}\n        />\n      </div>\n    );\n  }\n}\n\nclass ConfigColorScheme extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      color_scheme: window.config.color_scheme,\n    };\n  }\n\n  save_changes() {\n    this.props.callback({\n      color_scheme: this.state.color_scheme,\n    });\n  }\n\n  on_select(e) {\n    let value = e.target.value;\n    this.setState(\n      {\n        color_scheme: value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <p>\n          <b>夜间模式：</b>\n          <select\n            className=\"config-select\"\n            value={this.state.color_scheme}\n            onChange={this.on_select.bind(this)}\n          >\n            <option value=\"default\">跟随系统</option>\n            <option value=\"light\">始终浅色模式</option>\n            <option value=\"dark\">始终深色模式</option>\n          </select>\n          &nbsp;<small>#color_scheme</small>\n        </p>\n        <p className=\"config-description\">\n          选择浅色或深色模式，深色模式下将会调暗图片亮度\n        </p>\n      </div>\n    );\n  }\n}\n\nclass ConfigTextArea extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      [props.id]: window.config[props.id],\n    };\n  }\n\n  save_changes() {\n    this.props.callback({\n      [this.props.id]: this.props.sift(this.state[this.props.id]),\n    });\n  }\n\n  on_change(e) {\n    let value = this.props.parse(e.target.value);\n    this.setState(\n      {\n        [this.props.id]: value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <label>\n          <p>\n            <b>{this.props.name}</b>&nbsp;<small>#{this.props.id}</small>\n          </p>\n          <p className=\"config-description\">{this.props.description}</p>\n          <textarea\n            name={'config-' + this.props.id}\n            id={`config-textarea-${this.props.id}`}\n            className=\"config-textarea\"\n            value={this.props.display(this.state[this.props.id])}\n            onChange={this.on_change.bind(this)}\n          />\n        </label>\n      </div>\n    );\n  }\n}\n\nclass ConfigSwitch extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      switch: window.config[this.props.id],\n    };\n  }\n\n  on_change(e) {\n    let val = e.target.checked;\n    this.setState(\n      {\n        switch: val,\n      },\n      () => {\n        this.props.callback({\n          [this.props.id]: val,\n        });\n      },\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <p>\n          <label>\n            <input\n              name={'config-' + this.props.id}\n              type=\"checkbox\"\n              checked={this.state.switch}\n              onChange={this.on_change.bind(this)}\n            />\n            &nbsp;<b>{this.props.name}</b>\n            &nbsp;<small>#{this.props.id}</small>\n          </label>\n        </p>\n        <p className=\"config-description\">{this.props.description}</p>\n      </div>\n    );\n  }\n}\n\nexport class ConfigUI extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.save_changes_bound = this.save_changes.bind(this);\n  }\n\n  save_changes(chg) {\n    console.log(chg);\n    Object.keys(chg).forEach((key) => {\n      window.config[key] = chg[key];\n    });\n    save_config(false);\n  }\n\n  reset_settings() {\n    if (window.confirm('重置所有设置？')) {\n      window.config = {};\n      save_config();\n      window.location.reload();\n    }\n  }\n\n  render() {\n    return (\n      <div>\n        <div className=\"box config-ui-header\">\n          <p>\n            这些功能仍在测试，可能不稳定（\n            <a onClick={this.reset_settings.bind(this)}>全部重置</a>）\n          </p>\n          <p>\n            <b>\n              部分设置修改后需要{' '}\n              <a\n                onClick={() => {\n                  window.location.reload();\n                }}\n              >\n                刷新页面\n              </a>{' '}\n              方可生效\n            </b>\n          </p>\n        </div>\n        <div className=\"box\">\n          <ConfigBackground\n            id=\"background\"\n            callback={this.save_changes_bound}\n          />\n          <hr />\n          <ConfigColorScheme\n            id=\"color-scheme\"\n            callback={this.save_changes_bound}\n          />\n          <hr />\n          {/* <ConfigBlockWords\n            id=\"block-words\"\n            callback={this.save_changes_bound}\n          /> */}\n          <ConfigTextArea\n            id=\"block_words_v3\"\n            callback={this.save_changes_bound}\n            name=\"设置屏蔽词\"\n            description={'包含屏蔽词的树洞会被折叠，每行写一个屏蔽词'}\n            display={(array) => array.join('\\n')}\n            sift={(array) => array.filter((v) => v)}\n            parse={(string) => string.split('\\n')}\n          />\n          <hr />\n          <ConfigTextArea\n            id=\"whitelist_cw\"\n            callback={this.save_changes_bound}\n            name=\"展开指定的折叠警告\"\n            description={\n              '完全匹配的树洞不会被折叠，每行一个豁免词，也可使用一个星号(\"*\")表示豁免所有'\n            }\n            display={(array) => array.join('\\n')}\n            sift={(array) => array.filter((v) => v)}\n            parse={(string) => string.split('\\n')}\n          />\n          <hr />\n          <ConfigTextArea\n            id=\"ipfs_gateway_list\"\n            callback={this.save_changes_bound}\n            name=\"候选ipfs网关\"\n            description={\n              '<hash>表示要替换的哈希值。下次上传文件会使用第一行的，上传后根据速度调整。'\n            }\n            display={(array) => array.join('\\n')}\n            sift={(array) => array.filter((v) => v)}\n            parse={(string) => string.split('\\n')}\n          />\n          <hr />\n          <ConfigSwitch\n            callback={this.save_changes_bound}\n            id=\"pressure\"\n            name=\"快速返回\"\n            description=\"短暂按住 Esc 键或重压屏幕（3D Touch）可以快速返回或者刷新树洞\"\n          />\n          <hr />\n          <ConfigSwitch\n            callback={this.save_changes_bound}\n            id=\"easter_egg\"\n            name=\"允许彩蛋\"\n            description=\"在某些情况下显示彩蛋\"\n          />\n          <hr />\n          <p>\n            新功能建议或问题反馈请在&nbsp;\n            <a\n              href=\"https://git.thu.monster/newthuhole/hole-backend-rust/issues\"\n              target=\"_blank\"\n            >\n              Gitea\n            </a>\n            &nbsp;提出。\n          </p>\n        </div>\n      </div>\n    );\n  }\n}\n","import MarkdownIt from 'markdown-it';\nimport MarkdownItKaTeX from 'markdown-it-katex';\nimport hljs from 'highlight.js';\nimport 'highlight.js/styles/atom-one-dark.css';\nimport './Markdown.css';\n\nimport 'katex/dist/katex.min.css';\n\nlet md = new MarkdownIt({\n  html: false,\n  linkify: false,\n  breaks: true,\n  inline: true,\n  highlight(str, lang) {\n    if (lang && hljs.getLanguage(lang)) {\n      try {\n        return (\n          '<pre class=\"hljs\"><code>' +\n          hljs.highlight(lang, str, true).value +\n          '</code></pre>'\n        );\n      } catch (__) {}\n    }\n    return (\n      '<pre class=\"hljs\"><code>' + md.utils.escapeHtml(str) + '</code></pre>'\n    );\n  },\n}).use(MarkdownItKaTeX, {\n  throwOnError: false,\n  errorColor: '#aa0000',\n});\n\nexport default (text) => md.render(text);\n","import React, { Component, PureComponent } from 'react';\nimport { format_time, Time, TitleLine } from './infrastructure/widgets';\nimport HtmlToReact from 'html-to-react';\nimport './Common.css';\nimport {\n  URL_PID_RE,\n  URL_RE,\n  PID_RE,\n  NICKNAME_RE,\n  TAG_RE,\n  split_text,\n} from './text_splitter';\nimport { save_config } from './Config';\nimport renderMd from './Markdown';\n\nexport { format_time, Time, TitleLine };\n\nexport const API_BASE = '/_api/v1';\n\n// https://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex\nfunction escape_regex(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nfunction is_video(s) {\n  try {\n    let url = new URL(s);\n    return (\n      url.pathname.endsWith('.mp4') ||\n      url.pathname.endsWith('.mov') ||\n      (url.searchParams.get('filetype') || '').startsWith('video/')\n    );\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction is_audio(s) {\n  try {\n    let url = new URL(s);\n    return (\n      url.pathname.endsWith('.mp3') ||\n      (url.searchParams.get('filetype') || '').startsWith('audio/')\n    );\n  } catch (e) {\n    return false;\n  }\n}\n\nexport function build_highlight_re(\n  txt,\n  split = ' ',\n  option = 'g',\n  isRegex = false,\n) {\n  if (isRegex) {\n    try {\n      return new RegExp('(' + txt.slice(1, -1) + ')', option);\n    } catch (e) {\n      return /^$/g;\n    }\n  } else {\n    return txt\n      ? new RegExp(\n          `(${txt\n            .split(split)\n            .filter((x) => !!x)\n            .map(escape_regex)\n            .join('|')})`,\n          option,\n        )\n      : /^$/g;\n  }\n}\n\nexport function ColoredSpan(props) {\n  return (\n    <span\n      className=\"colored-span\"\n      style={{\n        '--coloredspan-bgcolor-light': props.colors[0],\n        '--coloredspan-bgcolor-dark': props.colors[1],\n      }}\n    >\n      {props.children}\n    </span>\n  );\n}\n\nfunction normalize_url(url) {\n  return /^https?:\\/\\//.test(url) ? url : 'http://' + url;\n}\n\nfunction stop_loading(e) {\n  e.target.parentNode.classList.remove('loading');\n}\n\n// props: text, show_pid, color_picker, search_param\nexport class HighlightedMarkdown extends Component {\n  render() {\n    const props = this.props;\n    const processDefs = new HtmlToReact.ProcessNodeDefinitions(React);\n    const processInstructions = [\n      {\n        shouldProcessNode: (node) => /^h[123456]$/.test(node.name),\n        processNode(node, children, index) {\n          let currentLevel = +node.name[1];\n          if (currentLevel < 3) currentLevel = 3;\n          const HeadingTag = `h${currentLevel}`;\n          return <HeadingTag key={index}>{children}</HeadingTag>;\n        },\n      },\n      {\n        shouldProcessNode: (node) => node.name === 'img',\n        processNode(node, index) {\n          return (\n            <span className=\"ext-img__warpper loading\">\n              <img\n                src={normalize_url(node.attribs.src)}\n                alt={node.alt}\n                className=\"ext-img\"\n                referrerPolicy=\"no-referrer\"\n                onError={stop_loading}\n                onLoad={stop_loading}\n              />\n            </span>\n          );\n        },\n      },\n      {\n        shouldProcessNode: (node) => node.name === 'a',\n        processNode(node, children, index) {\n          return (\n            <a\n              href={normalize_url(node.attribs.href)}\n              target=\"_blank\"\n              rel=\"noopenner noreferrer\"\n              className=\"ext-link\"\n              key={index}\n            >\n              {children}\n              <span className=\"icon icon-new-tab\" />\n            </a>\n          );\n        },\n      },\n      {\n        shouldProcessNode(node) {\n          return (\n            node.type === 'text' &&\n            (!node.parent ||\n              !node.parent.attribs ||\n              node.parent.attribs['encoding'] !== 'application/x-tex')\n          ); // pid, nickname, search\n        },\n        processNode(node, children, index) {\n          const originalText = node.data;\n          let rules = [\n            ['url_pid', URL_PID_RE],\n            ['url', URL_RE],\n            ['pid', PID_RE],\n            ['nickname', NICKNAME_RE],\n            ['tag', TAG_RE],\n          ];\n          if (props.search_param) {\n            let search_kws = props.search_param.split(' ').filter((s) => !!s);\n            rules.push([\n              'search',\n              new RegExp(\n                `(${search_kws\n                  .map((s) => s.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'))\n                  .join('|')})`,\n                'g',\n              ),\n            ]);\n          }\n          const splitted = split_text(originalText, rules);\n\n          return (\n            <React.Fragment key={index}>\n              {splitted.map(([rule, p], idx) => {\n                return (\n                  <span key={idx}>\n                    {rule === 'url_pid' ? (\n                      <span className=\"url-pid-link\" title={p}>\n                        /##\n                      </span>\n                    ) : rule === 'url' ? (\n                      <>\n                        <a\n                          href={normalize_url(p)}\n                          className=\"ext-link\"\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                        >\n                          {p}\n                          <span className=\"icon icon-new-tab\" />\n                        </a>\n                        {is_video(p) && (\n                          <video className=\"ext-video\" src={p} controls />\n                        )}\n                        {is_audio(p) && (\n                          <audio className=\"ext-audio\" src={p} controls />\n                        )}\n                      </>\n                    ) : rule === 'pid' ? (\n                      <a\n                        href={'#' + p}\n                        onClick={(e) => {\n                          e.preventDefault();\n                          props.show_pid(p.substring(1));\n                        }}\n                      >\n                        {p}\n                      </a>\n                    ) : rule === 'nickname' ? (\n                      <ColoredSpan colors={props.color_picker.get(p)}>\n                        {p}\n                      </ColoredSpan>\n                    ) : rule === 'search' ? (\n                      <span className=\"search-query-highlight\">{p}</span>\n                    ) : rule === 'tag' ? (\n                      <a href={p}>{p}</a>\n                    ) : (\n                      p\n                    )}\n                  </span>\n                );\n              })}\n            </React.Fragment>\n          );\n        },\n      },\n      {\n        shouldProcessNode: () => true,\n        processNode: processDefs.processDefaultNode,\n      },\n    ];\n    const parser = new HtmlToReact.Parser();\n    let rawMd = props.text;\n    const renderedMarkdown = renderMd(rawMd);\n    return (\n      parser.parseWithInstructions(\n        renderedMarkdown,\n        (node) => node.type !== 'script',\n        processInstructions,\n      ) || null\n    );\n  }\n}\n\nwindow.TEXTAREA_BACKUP = {};\n\nexport class SafeTextarea extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      text: '',\n    };\n    this.on_change_bound = this.on_change.bind(this);\n    this.on_keydown_bound = this.on_keydown.bind(this);\n    this.clear = this.clear.bind(this);\n    this.area_ref = React.createRef();\n    this.change_callback = props.on_change || (() => {});\n    this.submit_callback = props.on_submit || (() => {});\n  }\n\n  componentDidMount() {\n    this.setState(\n      {\n        text: window.TEXTAREA_BACKUP[this.props.id] || '',\n      },\n      () => {\n        this.change_callback(this.state.text);\n      },\n    );\n  }\n\n  componentWillUnmount() {\n    window.TEXTAREA_BACKUP[this.props.id] = this.state.text;\n    this.change_callback(this.state.text);\n  }\n\n  on_change(event) {\n    this.setState({\n      text: event.target.value,\n    });\n    this.change_callback(event.target.value);\n  }\n  on_keydown(event) {\n    if (event.key === 'Enter' && event.ctrlKey && !event.altKey) {\n      event.preventDefault();\n      this.submit_callback();\n    }\n  }\n\n  clear() {\n    this.setState({\n      text: '',\n    });\n  }\n  set(text) {\n    this.change_callback(text);\n    this.setState({\n      text: text,\n    });\n  }\n  get() {\n    return this.state.text;\n  }\n  focus() {\n    this.area_ref.current.focus();\n  }\n\n  render() {\n    return (\n      <textarea\n        ref={this.area_ref}\n        onChange={this.on_change_bound}\n        value={this.state.text}\n        onKeyDown={this.on_keydown_bound}\n        maxLength=\"4096\"\n      />\n    );\n  }\n}\n\nlet pwa_prompt_event = null;\nwindow.addEventListener('beforeinstallprompt', (e) => {\n  console.log('pwa: received before install prompt');\n  pwa_prompt_event = e;\n});\n\nexport function PromotionBar(props) {\n  let is_ios = /iPhone|iPad|iPod/i.test(window.navigator.userAgent);\n  let is_installed =\n    window.matchMedia('(display-mode: standalone)').matches ||\n    window.navigator.standalone;\n\n  if (is_installed) return null;\n\n  if (is_ios)\n    // noinspection JSConstructorReturnsPrimitive\n    return !navigator.standalone ? (\n      <div className=\"box promotion-bar\">\n        <span className=\"icon icon-about\" />\n        &nbsp; 用 Safari 把树洞 <b>添加到主屏幕</b> 更好用\n      </div>\n    ) : null;\n  // noinspection JSConstructorReturnsPrimitive\n  else\n    return pwa_prompt_event ? (\n      <div className=\"box promotion-bar\">\n        <span className=\"icon icon-about\" />\n        &nbsp; 把网页版树洞{' '}\n        <b>\n          <a\n            onClick={() => {\n              if (pwa_prompt_event) pwa_prompt_event.prompt();\n            }}\n          >\n            安装到桌面\n          </a>\n        </b>{' '}\n        更好用\n      </div>\n    ) : null;\n}\n\nexport class ClickHandler extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      moved: true,\n      init_y: 0,\n      init_x: 0,\n    };\n    this.on_begin_bound = this.on_begin.bind(this);\n    this.on_move_bound = this.on_move.bind(this);\n    this.on_end_bound = this.on_end.bind(this);\n\n    this.MOVE_THRESHOLD = 3;\n    this.last_fire = 0;\n  }\n\n  on_begin(e) {\n    //console.log('click',(e.touches?e.touches[0]:e).screenY,(e.touches?e.touches[0]:e).screenX);\n    this.setState({\n      moved: false,\n      init_y: (e.touches ? e.touches[0] : e).screenY,\n      init_x: (e.touches ? e.touches[0] : e).screenX,\n    });\n  }\n  on_move(e) {\n    if (!this.state.moved) {\n      let mvmt =\n        Math.abs((e.touches ? e.touches[0] : e).screenY - this.state.init_y) +\n        Math.abs((e.touches ? e.touches[0] : e).screenX - this.state.init_x);\n      //console.log('move',mvmt);\n      if (mvmt > this.MOVE_THRESHOLD)\n        this.setState({\n          moved: true,\n        });\n    }\n  }\n  on_end(event) {\n    //console.log('end');\n    if (!this.state.moved) this.do_callback(event);\n    this.setState({\n      moved: true,\n    });\n  }\n\n  do_callback(event) {\n    if (this.last_fire + 100 > +new Date()) return;\n    this.last_fire = +new Date();\n    this.props.callback(event);\n  }\n\n  render() {\n    return (\n      <div\n        onTouchStart={this.on_begin_bound}\n        onMouseDown={this.on_begin_bound}\n        onTouchMove={this.on_move_bound}\n        onMouseMove={this.on_move_bound}\n        onClick={this.on_end_bound}\n      >\n        {this.props.children}\n      </div>\n    );\n  }\n}\n\nexport function test_ipfs(hash) {\n  let key = 'testing_' + hash;\n  window[key] = { curr: 0 };\n  window.config.ipfs_gateway_list.forEach((url) => {\n    fetch(url.replaceAll('<hash>', hash), { method: 'HEAD' })\n      .then((res) => {\n        if (res.ok) {\n          console.log(url, 'success!');\n          if (window[key]) {\n            window[key].curr += 1;\n            window[key][url] = window[key].curr;\n            let list = window.config.ipfs_gateway_list;\n            list.sort(\n              (x, y) => (window[key][x] || 9999) - (window[key][y] || 999),\n            );\n            window.config.ipfs_gateway_list = list;\n            save_config(false);\n          }\n        }\n      })\n      .catch((e) => {\n        console.log(url, 'fail!');\n      });\n  });\n}\n","import React, { PureComponent } from 'react';\nimport { Time, API_BASE } from './Common';\nimport { get_json } from './infrastructure/functions';\n\nimport './Message.css';\n\nexport class MessageViewer extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading_status: 'idle',\n      msg: [],\n    };\n    this.input_suf_ref = React.createRef();\n  }\n\n  componentDidMount() {\n    this.load();\n  }\n\n  load() {\n    if (this.state.loading_status === 'loading') return;\n    this.setState(\n      {\n        loading_status: 'loading',\n      },\n      () => {\n        fetch(API_BASE + '/systemlog', {\n          headers: { 'User-Token': this.props.token },\n        })\n          .then(get_json)\n          .then((json) => {\n            this.setState({\n              loading_status: 'done',\n              msg: json.data,\n              start_time: json.start_time,\n              salt: json.salt,\n              tmp_token: json.tmp_token,\n            });\n          })\n          .catch((err) => {\n            console.error(err);\n            alert('' + err);\n            this.setState({\n              loading_status: 'failed',\n            });\n          });\n      },\n    );\n  }\n\n  do_set_token() {\n    if (this.state.loading_status === 'loading') return;\n    if (!this.input_suf_ref.current.value) {\n      alert('不建议后缀为空');\n      return;\n    }\n    let tt = this.state.tmp_token + '_' + this.input_suf_ref.current.value;\n    console.log(tt);\n    localStorage['TOKEN'] = tt;\n    alert('已登录为临时用户，过期后需注销重新登陆');\n    window.location.reload();\n  }\n\n  render() {\n    if (this.state.loading_status === 'loading')\n      return <p className=\"box box-tip\">加载中……</p>;\n    else if (this.state.loading_status === 'failed')\n      return (\n        <div className=\"box box-tip\">\n          <a\n            onClick={() => {\n              this.load();\n            }}\n          >\n            重新加载\n          </a>\n        </div>\n      );\n    else if (this.state.loading_status === 'done')\n      return (\n        <>\n          <br />\n          <p>\n            最近一次重置 <Time stamp={this.state.start_time} short={false} />\n          </p>\n          <p>\n            随机盐 <b>{this.state.salt}</b>\n          </p>\n          <br />\n          <div>\n            <p>15分钟临时token:</p>\n            <div className=\"input-prepend\">{this.state.tmp_token}_ </div>\n            <input\n              type=\"text\"\n              className=\"input-suf\"\n              ref={this.input_suf_ref}\n              placeholder=\"自定义后缀\"\n              maxLength={10}\n            />\n            <button\n              type=\"button\"\n              disabled={this.state.loading_status === 'loading'}\n              onClick={(e) => this.do_set_token()}\n            >\n              使用\n            </button>\n          </div>\n          {this.state.msg.map((msg) => (\n            <div className=\"box\" key={msg.type + msg.timestamp}>\n              <div className=\"box-header\">\n                <Time stamp={msg.timestamp} short={false} />\n                &nbsp; &nbsp;\n                <b>{msg.type}</b>\n                &nbsp;\n                <span className=\"box-header-name\">{msg.user}</span>\n              </div>\n              <div className=\"box-content\">\n                <pre>{msg.detail}</pre>\n              </div>\n            </div>\n          ))}\n        </>\n      );\n    else return null;\n  }\n}\n","const HOLE_CACHE_DB_NAME = 'hole_cache_db';\nconst CACHE_DB_VER = 1;\nconst MAINTENANCE_STEP = 150;\nconst MAINTENANCE_COUNT = 1000;\n\nconst ENC_KEY = 42;\n\nclass Cache {\n  constructor() {\n    this.db = null;\n    this.added_items_since_maintenance = 0;\n    this.encrypt = this.encrypt.bind(this);\n    this.decrypt = this.decrypt.bind(this);\n    const open_req = indexedDB.open(HOLE_CACHE_DB_NAME, CACHE_DB_VER);\n    open_req.onerror = console.error.bind(console);\n    open_req.onupgradeneeded = (event) => {\n      console.log('comment cache db upgrade');\n      const db = event.target.result;\n      const store = db.createObjectStore('comment', {\n        keyPath: 'pid',\n      });\n      store.createIndex('last_access', 'last_access', { unique: false });\n    };\n    open_req.onsuccess = (event) => {\n      console.log('comment cache db loaded');\n      this.db = event.target.result;\n      setTimeout(this.maintenance.bind(this), 1);\n    };\n  }\n\n  // use window.hole_cache.encrypt() only after cache is loaded!\n  encrypt(pid, data) {\n    let s = JSON.stringify(data);\n    let o = '';\n    for (let i = 0, key = (ENC_KEY ^ pid) % 128; i < s.length; i++) {\n      let c = s.charCodeAt(i);\n      let new_key = (key ^ (c / 2)) % 128;\n      o += String.fromCharCode(key ^ s.charCodeAt(i));\n      key = new_key;\n    }\n    return o;\n  }\n\n  // use window.hole_cache.decrypt() only after cache is loaded!\n  decrypt(pid, s) {\n    let o = '';\n    if (typeof s !== typeof 'str') return null;\n\n    for (let i = 0, key = (ENC_KEY ^ pid) % 128; i < s.length; i++) {\n      let c = key ^ s.charCodeAt(i);\n      o += String.fromCharCode(c);\n      key = (key ^ (c / 2)) % 128;\n    }\n\n    try {\n      return JSON.parse(o);\n    } catch (e) {\n      console.error('decrypt failed');\n      console.trace(e);\n      return null;\n    }\n  }\n\n  get(pid, target_version) {\n    pid = parseInt(pid);\n    return new Promise((resolve, reject) => {\n      if (!this.db) return resolve(null);\n      const tx = this.db.transaction(['comment'], 'readwrite');\n      const store = tx.objectStore('comment');\n      const get_req = store.get(pid);\n      get_req.onsuccess = () => {\n        let res = get_req.result;\n        if (!res || !res.data_str) {\n          //console.log('comment cache miss '+pid);\n          resolve(null);\n        } else if (target_version === res.version) {\n          // hit\n          //console.log('comment cache hit', pid);\n          res.last_access = +new Date();\n          store.put(res);\n          let data = this.decrypt(pid, res.data_str);\n          resolve(data); // obj or null\n        } else {\n          // expired\n          console.log(\n            'comment cache expired',\n            pid,\n            ': ver',\n            res.version,\n            'target',\n            target_version,\n          );\n          store.delete(pid);\n          resolve(null);\n        }\n      };\n      get_req.onerror = (e) => {\n        console.warn('comment cache indexeddb open failed');\n        console.error(e);\n        resolve(null);\n      };\n    });\n  }\n\n  put(pid, target_version, data) {\n    pid = parseInt(pid);\n    return new Promise((resolve, reject) => {\n      if (!this.db) return resolve();\n      const tx = this.db.transaction(['comment'], 'readwrite');\n      const store = tx.objectStore('comment');\n      store.put({\n        pid: pid,\n        version: target_version,\n        data_str: this.encrypt(pid, data),\n        last_access: +new Date(),\n      });\n      //console.log('comment cache put', pid);\n      if (++this.added_items_since_maintenance === MAINTENANCE_STEP)\n        setTimeout(this.maintenance.bind(this), 1);\n    });\n  }\n\n  delete(pid) {\n    pid = parseInt(pid);\n    return new Promise((resolve, reject) => {\n      if (!this.db) return resolve();\n      const tx = this.db.transaction(['comment'], 'readwrite');\n      const store = tx.objectStore('comment');\n      let req = store.delete(pid);\n      console.log('comment cache delete', pid);\n      req.onerror = () => {\n        console.warn('comment cache delete failed ', pid);\n        return resolve();\n      };\n      req.onsuccess = () => resolve();\n    });\n  }\n\n  maintenance() {\n    if (!this.db) return;\n    const tx = this.db.transaction(['comment'], 'readwrite');\n    const store = tx.objectStore('comment');\n    let count_req = store.count();\n    count_req.onsuccess = () => {\n      let count = count_req.result;\n      if (count > MAINTENANCE_COUNT) {\n        console.log('comment cache db maintenance', count);\n        store.index('last_access').openKeyCursor().onsuccess = (e) => {\n          let cur = e.target.result;\n          if (cur) {\n            //console.log('maintenance: delete',cur);\n            store.delete(cur.primaryKey);\n            if (--count > MAINTENANCE_COUNT) cur.continue();\n          }\n        };\n      } else {\n        console.log('comment cache db no need to maintenance', count);\n      }\n      this.added_items_since_maintenance = 0;\n    };\n    count_req.onerror = console.error.bind(console);\n  }\n\n  clear() {\n    if (!this.db) return;\n    indexedDB.deleteDatabase(HOLE_CACHE_DB_NAME);\n    console.log('delete comment cache db');\n  }\n}\n\nexport function cache() {\n  if (!window.hole_cache) window.hole_cache = new Cache();\n  return window.hole_cache;\n}\n","import { get_json, gen_name } from './infrastructure/functions';\nimport { API_BASE } from './Common';\nimport { cache } from './cache';\n\nexport { get_json };\n\nconst SEARCH_PAGESIZE = 50;\n\nconst handle_response = async (response, notify = false) => {\n  let json = await get_json(response);\n  if (json.code !== 0) {\n    if (json.msg) {\n      if (notify) {\n        alert(json.msg);\n      } else {\n        throw new Error(json.msg);\n      }\n    } else {\n      throw new Error(JSON.stringify(json));\n    }\n  }\n  return json;\n};\n\nexport const parse_replies = (replies, color_picker) =>\n  replies\n    .sort((a, b) => parseInt(a.cid, 10) - parseInt(b.cid, 10))\n    .map((info) => {\n      info.name = gen_name(info.name_id);\n      info._display_color = color_picker.get(info.name, info.is_tmp);\n      info.variant = {};\n      return info;\n    });\n\nexport const API = {\n  load_replies: async (pid, token, color_picker, cache_version) => {\n    pid = parseInt(pid);\n    let response = await fetch(API_BASE + '/getcomment?pid=' + pid, {\n      headers: {\n        'User-Token': token,\n      },\n    });\n    let json = await handle_response(response);\n    // Why delete then put ??\n    //console.log('Put cache', json, pid, cache_version);\n    cache().put(pid, cache_version, json);\n    json.data = parse_replies(json.data, color_picker);\n    return json;\n  },\n\n  load_replies_with_cache: async (pid, token, color_picker, cache_version) => {\n    pid = parseInt(pid);\n    let json = await cache().get(pid, cache_version);\n    //console.log('Get Cache', json, pid, cache_version);\n    if (json) {\n      //console.log('cache.data', json.data);\n      json.data = parse_replies(json.data, color_picker);\n      return { data: json, cached: true };\n    } else {\n      //console.log('Cache fail, new fetch');\n      json = await API.load_replies(pid, token, color_picker, cache_version);\n      return { data: json, cached: !json };\n    }\n  },\n\n  set_attention: async (pid, attention, token) => {\n    let data = new URLSearchParams();\n    data.append('pid', pid);\n    data.append('switch', attention ? '1' : '0');\n    let response = await fetch(API_BASE + '/attention', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': token,\n      },\n      body: data,\n    });\n    // Delete cache to update `attention` on next reload\n    cache().delete(pid);\n    return handle_response(response, false);\n  },\n\n  report: async (pid, reason, token) => {\n    let data = new URLSearchParams();\n    data.append('pid', pid);\n    data.append('reason', reason);\n    let response = await fetch(API_BASE + '/report', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': token,\n      },\n      body: data,\n    });\n    return handle_response(response, false);\n  },\n\n  block: async (type, id, token) => {\n    let data = new URLSearchParams([\n      ['type', type],\n      ['id', id],\n    ]);\n    let response = await fetch(API_BASE + '/block', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': token,\n      },\n      body: data,\n    });\n    return handle_response(response, false);\n  },\n\n  del: async (type, id, note, token) => {\n    let data = new URLSearchParams();\n    data.append('type', type);\n    data.append('id', id);\n    data.append('note', note);\n    let response = await fetch(API_BASE + '/delete', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': token,\n      },\n      body: data,\n    });\n    return handle_response(response, false);\n  },\n\n  update_cw: async (cw, id, token) => {\n    let data = new URLSearchParams();\n    data.append('cw', cw);\n    data.append('pid', id);\n    let response = await fetch(API_BASE + '/editcw', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': token,\n      },\n      body: data,\n    });\n    return handle_response(response, false);\n  },\n\n  get_list: async (page, token, submode) => {\n    let response = await fetch(\n      `${API_BASE}/getlist?p=${page}&order_mode=${submode}`,\n      {\n        headers: { 'User-Token': token },\n      },\n    );\n    return handle_response(response);\n  },\n\n  get_search: async (page, keyword, token, submode) => {\n    let response = await fetch(\n      `${API_BASE}/search?search_mode=${submode}&page=${page}&keywords=${encodeURIComponent(\n        keyword,\n      )}&pagesize=${SEARCH_PAGESIZE}`,\n      {\n        headers: { 'User-Token': token },\n      },\n    );\n    return handle_response(response);\n  },\n\n  get_single: async (pid, token) => {\n    let response = await fetch(API_BASE + '/getone?pid=' + pid, {\n      headers: { 'User-Token': token },\n    });\n    return handle_response(response);\n  },\n\n  get_attention: async (token) => {\n    let response = await fetch(API_BASE + '/getattention', {\n      headers: { 'User-Token': token },\n    });\n    return handle_response(response);\n  },\n\n  add_vote: async (vote, pid, token) => {\n    let data = new URLSearchParams([\n      ['vote', vote],\n      ['pid', pid],\n    ]);\n    let response = await fetch(API_BASE + '/vote', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': token,\n      },\n      body: data,\n    });\n    return handle_response(response, true);\n  },\n\n  get_multi: async (pids, token) => {\n    let response = await fetch(\n      API_BASE + '/getmulti?' + pids.map((pid) => `pids=${pid}`).join('&'),\n      {\n        headers: {\n          'User-Token': token,\n        },\n      },\n    );\n    return handle_response(response, true);\n  },\n\n  set_title: async (title, token) => {\n    console.log('title: ', title);\n    let data = new URLSearchParams([['title', title]]);\n    let response = await fetch(API_BASE + '/title', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': token,\n      },\n      body: data,\n    });\n    return handle_response(response, true);\n  },\n};\n","export function load_attentions() {\n  window.saved_attentions = JSON.parse(\n    localStorage['saved_attentions'] || '[]',\n  );\n}\n\nexport function save_attentions() {\n  localStorage['saved_attentions'] = JSON.stringify(window.saved_attentions);\n}\n","import React, { Component } from 'react';\nimport {\n  API_BASE,\n  SafeTextarea,\n  PromotionBar,\n  HighlightedMarkdown,\n  test_ipfs,\n} from './Common';\nimport { MessageViewer } from './Message';\nimport { LoginPopup } from './infrastructure/widgets';\nimport { ColorPicker } from './color_picker';\nimport { ConfigUI } from './Config';\nimport copy from 'copy-to-clipboard';\nimport { cache } from './cache';\nimport { get_json } from './flows_api';\nimport { save_attentions } from './Attention';\n\nimport './UserAction.css';\n\nconst REPOSITORY = 'https://git.thu.monster/newthuhole/';\nconst EMAIL = 'hole_thu@riseup.net';\n\nexport const TokenCtx = React.createContext({\n  value: null,\n  set_value: () => {},\n});\n\nexport function InfoSidebar(props) {\n  return (\n    <div>\n      <PromotionBar />\n      <LoginForm show_sidebar={props.show_sidebar} />\n      <div className=\"box list-menu\">\n        <a href=\"/about.html\" target=\"_blank\">\n          <span className=\"icon icon-about\" />\n          <label>关于</label>\n        </a>\n        &nbsp;&nbsp;\n        <a\n          onClick={() => {\n            props.show_sidebar('设置', <ConfigUI />);\n          }}\n        >\n          <span className=\"icon icon-settings\" />\n          <label>本地设置</label>\n        </a>\n        &nbsp;&nbsp;\n        <a href=\"/policy.html\" target=\"_blank\">\n          <span className=\"icon icon-textfile\" />\n          <label>树洞规范（试行）</label>\n        </a>\n        <p>\n          <em>强烈建议开始使用前先看一遍所有设置选项</em>\n        </p>\n      </div>\n      <div className=\"box help-desc-box\">\n        <p>\n          <a\n            onClick={() => {\n              if ('serviceWorker' in navigator) {\n                navigator.serviceWorker\n                  .getRegistrations()\n                  .then((registrations) => {\n                    for (let registration of registrations) {\n                      console.log('unregister', registration);\n                      registration.unregister();\n                    }\n                  });\n              }\n              cache().clear();\n              setTimeout(() => {\n                window.location.reload(true);\n              }, 200);\n            }}\n          >\n            强制检查更新\n          </a>\n          （当前版本：【{process.env.REACT_APP_BUILD_INFO || '---'}{' '}\n          {process.env.NODE_ENV}】 会自动在后台检查更新并在下次访问时更新）\n        </p>\n      </div>\n      <div className=\"box help-desc-box\">\n        <p>意见反馈请加tag #意见反馈 或到github后端的issue区。</p>\n        <p>\n          新T树洞强烈期待有其他更多树洞的出现，一起分布式互联，构建清华树洞族。详情见\n          关于 中的描述。\n        </p>\n        <p>\n          联系我们：<a href={'mailto:' + EMAIL}>{EMAIL}</a> 。\n        </p>\n      </div>\n      <div className=\"box help-desc-box\">\n        <p>\n          新T树洞 网页版 by @hole_thu，基于\n          <a href=\"https://www.gnu.org/licenses/agpl-3.0.html\" target=\"_blank\">\n            AGPLv3\n          </a>\n          协议在{' '}\n          <a href={REPOSITORY} target=\"_blank\">\n            Gitea\n          </a>{' '}\n          开源。\n        </p>\n        <p>\n          新T树洞 网页版基于\n          <a\n            href=\"https://github.com/pkuhelper-web/webhole\"\n            target=\"_blank\"\n            rel=\"noopener\"\n          >\n            P大树洞网页版 by @xmcp\n          </a>\n          、\n          <a\n            href=\"https://github.com/thuhole/webhole\"\n            target=\"_blank\"\n            rel=\"noopener\"\n          >\n            T大树洞网页版 by @thuhole\n          </a>\n          、{' '}\n          <a href=\"https://reactjs.org/\" target=\"_blank\" rel=\"noopener\">\n            React\n          </a>\n          、\n          <a href=\"https://icomoon.io/#icons\" target=\"_blank\" rel=\"noopener\">\n            IcoMoon\n          </a>\n          等开源项目。\n        </p>\n        <hr />\n        <p>\n          新T树洞 后端 by @hole_thu，基于\n          <a href=\"http://www.wtfpl.net/about/\" target=\"_blank\">\n            WTFPLv2\n          </a>\n          协议在{' '}\n          <a href={REPOSITORY} target=\"_blank\">\n            Gitea\n          </a>{' '}\n          开源。\n        </p>\n      </div>\n    </div>\n  );\n}\n\nexport class LoginForm extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      custom_title: window.TITLE || '',\n      auto_block_rank: window.AUTO_BLCOK || 2,\n    };\n  }\n\n  update_title(title, token) {\n    if (title === window.TITLE) {\n      alert('无变化');\n      return;\n    }\n    let data = new FormData();\n    data.append('title', title);\n    fetch(API_BASE + '/title', {\n      method: 'POST',\n      headers: { 'User-Token': token },\n      body: data,\n    })\n      .then(get_json)\n      .then((j) => {\n        if (j.code !== 0) {\n          throw new Error(j.msg);\n        }\n        window.TITLE = title;\n        alert('专属头衔设置成功');\n      })\n      .catch((err) => alert('设置头衔出错了:\\n' + err));\n  }\n\n  update_auto_block(rank, token) {\n    let data = new FormData();\n    data.append('rank', rank);\n    fetch(API_BASE + '/auto_block', {\n      method: 'POST',\n      headers: { 'User-Token': token },\n      body: data,\n    })\n      .then(get_json)\n      .then((j) => {\n        if (j.code !== 0) {\n          throw new Error(j.msg);\n        }\n        window.AUTO_BLCOK = rank;\n        alert('设置自动拉黑阈值成功');\n      })\n      .catch((err) => alert('设置自动拉黑出错了:\\n' + err));\n  }\n\n  copy_token(token) {\n    if (copy(token)) alert('复制成功！\\n请一定不要泄露哦');\n  }\n\n  render() {\n    return (\n      <TokenCtx.Consumer>\n        {(token) => (\n          <div>\n            {/*{!!token.value &&*/}\n            {/*    <LifeInfoBox token={token.value} set_token={token.set_value} />*/}\n            {/*}*/}\n            <div className=\"login-form box\">\n              {token.value ? (\n                <div>\n                  <p>\n                    <b>您已登录。</b>\n                    <button\n                      type=\"button\"\n                      onClick={() => {\n                        token.set_value(null);\n                      }}\n                    >\n                      <span className=\"icon icon-logout\" /> 注销\n                    </button>\n                    <br />\n                  </p>\n                  <p>\n                    <a\n                      onClick={() => {\n                        this.props.show_sidebar(\n                          '系统日志',\n                          <MessageViewer token={token.value} />,\n                        );\n                      }}\n                    >\n                      查看系统日志\n                    </a>\n                    <br />\n                    举报记录、管理日志等都是公开的。\n                  </p>\n                  <p>\n                    <a onClick={this.copy_token.bind(this, token.value)}>\n                      复制 User Token\n                    </a>\n                    <br />\n                    User\n                    Token仅用于开发bot，切勿告知他人。若怀疑被盗号请刷新Token(刷新功能即将上线)。\n                  </p>\n                  <p>\n                    专属头衔：\n                    <input\n                      value={this.state.custom_title}\n                      onChange={(e) => {\n                        this.setState({ custom_title: e.target.value });\n                      }}\n                      maxLength={10}\n                    />\n                    <button\n                      className=\"update-title-btn\"\n                      type=\"button\"\n                      onClick={(e) => {\n                        this.update_title(this.state.custom_title, token.value);\n                      }}\n                      disabled={!this.state.custom_title}\n                    >\n                      提交\n                    </button>\n                    <br />\n                    设置专属头衔后，可在发言时选择使用。重置后需重新设置。临时用户如需保持头衔请使用相同后缀。\n                  </p>\n                  <p>\n                    自动拉黑阈值:\n                    <span style={{ display: 'inline-block', width: '3rem' }}>\n                      <b>{this.state.auto_block_rank * 5}</b>\n                    </span>\n                    <input\n                      value={this.state.auto_block_rank}\n                      type=\"range\"\n                      min=\"1\"\n                      max=\"10\"\n                      list=\"autoBlock\"\n                      onChange={(e) => {\n                        this.setState({ auto_block_rank: e.target.value });\n                      }}\n                    />\n                    <button\n                      className=\"update-title-btn\"\n                      type=\"button\"\n                      onClick={(e) => {\n                        this.update_auto_block(\n                          this.state.auto_block_rank,\n                          token.value,\n                        );\n                      }}\n                    >\n                      提交\n                    </button>\n                    <datalist id=\"autoBlock\">\n                      <option>1</option>\n                      <option>2</option>\n                      <option>3</option>\n                    </datalist>\n                    <br />\n                    自动不展示被拉黑次数较多用户发布的内容，包括自己。对每个洞及其评论的可见性会有1小时缓存，频繁修改无效。\n                  </p>\n                </div>\n              ) : (\n                <LoginPopup token_callback={token.set_value}>\n                  {(do_popup) => (\n                    <div>\n                      <p>\n                        <button type=\"button\" onClick={do_popup}>\n                          <span className=\"icon icon-login\" />\n                          &nbsp;登录\n                        </button>\n                      </p>\n                      <p>\n                        <small>\n                          新T树洞\n                          面向T大学生，通过已验证身份的第三方服务授权登陆。\n                        </small>\n                      </p>\n                    </div>\n                  )}\n                </LoginPopup>\n              )}\n            </div>\n          </div>\n        )}\n      </TokenCtx.Consumer>\n    );\n  }\n}\n\nexport class ReplyForm extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      text: '',\n      loading_status: 'done',\n      preview: false,\n      use_title: false,\n    };\n    this.on_change_bound = this.on_change.bind(this);\n    this.on_use_title_change_bound = this.on_use_title_change.bind(this);\n    this.area_ref = this.props.area_ref || React.createRef();\n    this.global_keypress_handler_bound = this.global_keypress_handler.bind(\n      this,\n    );\n    this.color_picker = new ColorPicker();\n  }\n\n  global_keypress_handler(e) {\n    if (\n      e.code === 'Enter' &&\n      !e.ctrlKey &&\n      !e.altKey &&\n      ['input', 'textarea'].indexOf(e.target.tagName.toLowerCase()) === -1\n    ) {\n      if (this.area_ref.current) {\n        e.preventDefault();\n        this.area_ref.current.focus();\n      }\n    }\n  }\n  componentDidMount() {\n    document.addEventListener('keypress', this.global_keypress_handler_bound);\n  }\n  componentWillUnmount() {\n    document.removeEventListener(\n      'keypress',\n      this.global_keypress_handler_bound,\n    );\n  }\n\n  on_change(value) {\n    this.setState({\n      text: value,\n    });\n  }\n\n  on_use_title_change(event) {\n    this.setState({\n      use_title: event.target.checked,\n    });\n  }\n\n  on_submit(event) {\n    if (event) event.preventDefault();\n    if (this.state.loading_status === 'loading') return;\n    if (!this.state.text) return;\n    this.setState({\n      loading_status: 'loading',\n    });\n\n    const { pid } = this.props;\n    const { text, use_title } = this.state;\n    let data = new URLSearchParams({\n      pid: pid,\n      text: text,\n      use_title: use_title ? '1' : '',\n    });\n    fetch(API_BASE + '/docomment', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': this.props.token,\n      },\n      body: data,\n    })\n      .then(get_json)\n      .then((json) => {\n        if (json.code !== 0) {\n          throw new Error(json.msg);\n        }\n\n        let saved_attentions = window.saved_attentions;\n        if (!saved_attentions.includes(pid)) {\n          saved_attentions.unshift(pid);\n          window.saved_attentions = saved_attentions;\n          save_attentions();\n        }\n\n        this.setState({\n          loading_status: 'done',\n          text: '',\n          preview: false,\n        });\n        this.area_ref.current.clear();\n        this.props.on_complete();\n      })\n      .catch((e) => {\n        console.error(e);\n        alert('回复失败\\n' + e);\n        this.setState({\n          loading_status: 'done',\n        });\n      });\n  }\n\n  toggle_preview() {\n    this.setState({\n      preview: !this.state.preview,\n    });\n  }\n\n  render() {\n    return (\n      <form\n        onSubmit={this.on_submit.bind(this)}\n        className={'reply-form box' + (this.state.text ? ' reply-sticky' : '')}\n      >\n        {this.state.preview ? (\n          <div className=\"reply-preview\">\n            <HighlightedMarkdown\n              text={this.state.text}\n              color_picker={this.color_picker}\n              show_pid={() => {}}\n            />\n          </div>\n        ) : (\n          <SafeTextarea\n            ref={this.area_ref}\n            id={this.props.pid}\n            on_change={this.on_change_bound}\n            on_submit={this.on_submit.bind(this)}\n          />\n        )}\n        <div className=\"reply-form-opt-box\">\n          <div className=\"reply-form-buttons\">\n            <button\n              type=\"button\"\n              onClick={() => {\n                this.toggle_preview();\n              }}\n            >\n              {this.state.preview ? (\n                <span className=\"icon icon-eye-blocked\" />\n              ) : (\n                <span className=\"icon icon-eye\" />\n              )}\n            </button>\n            {this.state.loading_status === 'loading' ? (\n              <button disabled=\"disabled\">\n                <span className=\"icon icon-loading\" />\n              </button>\n            ) : (\n              <button type=\"submit\">\n                <span className=\"icon icon-send\" />\n              </button>\n            )}\n          </div>\n          {window.TITLE && (\n            <label>\n              <input\n                type=\"checkbox\"\n                onChange={this.on_use_title_change_bound}\n                checked={this.state.use_title}\n              />{' '}\n              使用头衔\n            </label>\n          )}\n        </div>\n      </form>\n    );\n  }\n}\n\nexport class PostForm extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      text: '',\n      upload_progress_text: '',\n      is_loading: false,\n      file_name: '',\n      file_type: '',\n      cw: window.CW_BACKUP || '',\n      allow_search: window.AS_BACKUP || false,\n      loading_status: 'done',\n      preview: false,\n      has_poll: !!window.POLL_BACKUP,\n      poll_options: JSON.parse(window.POLL_BACKUP || '[\"\"]'),\n      use_title: false,\n    };\n    this.area_ref = React.createRef();\n    this.on_change_bound = this.on_change.bind(this);\n    this.on_allow_search_change_bound = this.on_allow_search_change.bind(this);\n    this.on_use_title_change_bound = this.on_use_title_change.bind(this);\n    this.on_cw_change_bound = this.on_cw_change.bind(this);\n    this.on_poll_option_change_bound = this.on_poll_option_change.bind(this);\n    this.color_picker = new ColorPicker();\n  }\n\n  componentDidMount() {\n    if (this.area_ref.current) this.area_ref.current.focus();\n  }\n\n  componentWillUnmount() {\n    const { cw, allow_search, has_poll, poll_options } = this.state;\n    window.CW_BACKUP = cw;\n    window.AS_BACKUP = allow_search;\n    localStorage['DEFAULT_ALLOW_SEARCH'] = allow_search ? '1' : '';\n    window.POLL_BACKUP = has_poll ? JSON.stringify(poll_options) : null;\n  }\n\n  on_allow_search_change(event) {\n    this.setState({\n      allow_search: event.target.checked,\n    });\n  }\n\n  on_use_title_change(event) {\n    this.setState({\n      use_title: event.target.checked,\n    });\n  }\n\n  on_cw_change(event) {\n    this.setState({\n      cw: event.target.value,\n    });\n  }\n\n  on_change(value) {\n    this.setState({\n      text: value,\n    });\n  }\n\n  do_post() {\n    const {\n      cw,\n      text,\n      allow_search,\n      use_title,\n      has_poll,\n      poll_options,\n    } = this.state;\n    let data = new URLSearchParams({\n      cw: cw,\n      text: text,\n      allow_search: allow_search ? '1' : '',\n      use_title: use_title ? '1' : '',\n      type: 'text',\n    });\n    if (has_poll) {\n      poll_options.forEach((opt) => {\n        if (opt) data.append('poll_options', opt);\n      });\n    }\n\n    fetch(API_BASE + '/dopost', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'User-Token': this.props.token,\n      },\n      body: data,\n    })\n      .then(get_json)\n      .then((json) => {\n        if (json.code !== 0) {\n          throw new Error(json.msg);\n        }\n\n        this.setState({\n          loading_status: 'done',\n          text: '',\n          preview: false,\n        });\n        this.area_ref.current.clear();\n        this.props.on_complete();\n        window.CW_BACKUP = '';\n        window.POLL_BACKUP = null;\n      })\n      .catch((e) => {\n        console.error(e);\n        alert('发表失败\\n' + e);\n        this.setState({\n          loading_status: 'done',\n        });\n      });\n  }\n\n  on_submit(event) {\n    if (event) event.preventDefault();\n    if (this.state.loading_status === 'loading') return;\n    if (!this.state.text) return;\n    {\n      this.setState({\n        loading_status: 'loading',\n      });\n      this.do_post();\n    }\n  }\n\n  toggle_preview() {\n    this.setState({\n      preview: !this.state.preview,\n    });\n  }\n\n  on_poll_option_change(event, idx) {\n    let poll_options = this.state.poll_options;\n    let text = event.target.value;\n    poll_options[idx] = text;\n    if (!text && poll_options.length > 1) {\n      poll_options.splice(idx, 1);\n    }\n    if (poll_options[poll_options.length - 1] && poll_options.length < 8) {\n      poll_options.push('');\n    }\n    this.setState({ poll_options: poll_options });\n  }\n\n  on_file_change(event) {\n    console.log(event);\n    let f = event.target.files[0];\n    if (f) {\n      console.log(f);\n      this.setState({ is_loading: true, file_name: f.name, file_type: f.type });\n      // let data = new FormData();\n      // data.append('file', f);\n\n      var xh = new XMLHttpRequest();\n      xh.upload.addEventListener(\n        'progress',\n        this.upload_progress.bind(this),\n        false,\n      );\n      xh.addEventListener('load', this.upload_complete.bind(this), false);\n      xh.addEventListener('error', this.upload_error.bind(this), false);\n      xh.addEventListener('abort', this.upload_abort.bind(this), false);\n      xh.open('POST', API_BASE + '/upload');\n      xh.setRequestHeader('User-Token', this.props.token);\n      xh.send(f);\n    }\n  }\n\n  update_text_after_upload(data) {\n    const { file_name, file_type } = this.state;\n    let url =\n      (window.config.ipfs_gateway_list[0] || '<hash>(无ipfs网关)').replaceAll(\n        '<hash>',\n        data.hash,\n      ) +\n      `?filename=${encodeURIComponent(file_name)}&filetype=${encodeURIComponent(\n        file_type,\n      )}`;\n    test_ipfs(data.hash);\n    let new_text =\n      this.state.text +\n      '\\n' +\n      (file_type.startsWith('image/') ? `![](${url})` : url) +\n      ` [加载失败请点击此](${window.location.origin}/ipfs.html#${data.hash})\\n\\n---\\n`;\n    this.setState({ text: new_text });\n    this.area_ref.current.set(new_text);\n  }\n\n  upload_progress(event) {\n    console.log(event.loaded, event.total);\n    this.setState({\n      upload_progress_text: `${((event.loaded * 100) / event.total).toFixed(\n        2,\n      )}%`,\n    });\n  }\n\n  upload_complete(event) {\n    try {\n      let j = JSON.parse(event.target.responseText);\n      if (j.code != 0) {\n        alert(j.msg);\n        throw new Error();\n      }\n      this.update_text_after_upload(j.data);\n      this.setState({ is_loading: false });\n    } catch (e) {\n      console.log(e);\n      this.upload_error(event);\n    }\n  }\n\n  upload_error(event) {\n    alert(\n      '上传失败\\n' +\n        (event.target.responseText.length < 100\n          ? event.target.responseText\n          : event.target.status),\n    );\n    this.setState({ is_loading: false });\n  }\n\n  upload_abort(event) {\n    alert('上传已中断');\n    this.setState({ is_loading: false });\n  }\n\n  render() {\n    const {\n      has_poll,\n      poll_options,\n      preview,\n      loading_status,\n      upload_progress_text,\n      is_loading,\n      file_name,\n    } = this.state;\n    return (\n      <form onSubmit={this.on_submit.bind(this)} className=\"post-form box\">\n        <div className=\"post-form-bar\">\n          <div>\n            {preview ? (\n              <button\n                type=\"button\"\n                onClick={() => {\n                  this.toggle_preview();\n                }}\n              >\n                <span className=\"icon icon-eye-blocked\" />\n                &nbsp;编辑\n              </button>\n            ) : (\n              <button\n                type=\"button\"\n                onClick={() => {\n                  this.toggle_preview();\n                }}\n              >\n                <span className=\"icon icon-eye\" />\n                &nbsp;预览\n              </button>\n            )}\n\n            {loading_status !== 'done' ? (\n              <button disabled=\"disabled\">\n                <span className=\"icon icon-loading\" />\n                &nbsp;上传\n              </button>\n            ) : (\n              <button type=\"submit\">\n                <span className=\"icon icon-send\" />\n                &nbsp;发表\n              </button>\n            )}\n          </div>\n          <div className=\"checkbox-bar\">\n            <label>\n              <input\n                type=\"checkbox\"\n                onChange={this.on_allow_search_change_bound}\n                checked={this.state.allow_search}\n              />{' '}\n              允许搜索\n            </label>\n            {window.TITLE && (\n              <label>\n                <input\n                  type=\"checkbox\"\n                  onChange={this.on_use_title_change_bound}\n                  checked={this.state.use_title}\n                />{' '}\n                使用头衔\n              </label>\n            )}\n          </div>\n        </div>\n        {preview ? (\n          <div className=\"post-preview\">\n            <HighlightedMarkdown\n              text={this.state.text}\n              color_picker={this.color_picker}\n              show_pid={() => {}}\n            />\n          </div>\n        ) : (\n          <>\n            <span>上传并插入文件: </span>\n            <input\n              className=\"file-input\"\n              type=\"file\"\n              name=\"file\"\n              onChange={this.on_file_change.bind(this)}\n              disabled={is_loading}\n            />\n            {is_loading && (\n              <p>\n                <small>\n                  上传 <i>{file_name}</i> 中: {upload_progress_text}\n                </small>\n              </p>\n            )}\n            <input\n              type=\"text\"\n              placeholder=\"折叠警告(留空表示不折叠)\"\n              value={this.state.cw}\n              id=\"post_cw\"\n              className=\"spoiler-input\"\n              onChange={this.on_cw_change_bound}\n              maxLength=\"32\"\n            />\n            <SafeTextarea\n              ref={this.area_ref}\n              id=\"new_post\"\n              on_change={this.on_change_bound}\n              on_submit={this.on_submit.bind(this)}\n            />\n          </>\n        )}\n        <button\n          type=\"button\"\n          onClick={() => {\n            this.setState({ has_poll: !has_poll });\n          }}\n        >\n          {has_poll ? '取消' : '添加'}投票\n        </button>\n\n        {has_poll && (\n          <div className=\"post-form-poll-options\">\n            <h6>投票选项</h6>\n            {poll_options.map((option, idx) => (\n              <input\n                key={idx}\n                type=\"text\"\n                value={option}\n                placeholder=\"输入以添加选项...\"\n                onChange={(e) => this.on_poll_option_change_bound(e, idx)}\n                maxLength=\"32\"\n              />\n            ))}\n          </div>\n        )}\n        <br />\n        <br />\n        <br />\n        <p>\n          <small>\n            请遵守\n            <a href=\"/policy.html\" target=\"_blank\">\n              树洞管理规范（试行）\n            </a>\n            ，文明发言。\n          </small>\n        </p>\n        <p>\n          <small>\n            首选ipfs网关可以在设置中修改，如效果不佳仍可使用图床，例如：\n            <a href=\"https://imgtu.com/\" target=\"_blank\">\n              路过图床\n            </a>\n            、\n            <a href=\"https://sm.ms/\" target=\"_blank\">\n              sm.ms\n            </a>\n            、\n            <a\n              href=\"https://bbs.pku.edu.cn/v2/post-read.php?bid=154&threadid=3743\"\n              target=\"_blank\"\n            >\n              未名BBS\n            </a>\n            、\n            <a href=\"https://zhuanlan.zhihu.com/write\" target=\"_blank\">\n              知乎\n            </a>\n            。\n          </small>\n        </p>\n      </form>\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\nimport copy from 'copy-to-clipboard';\nimport { ColorPicker } from './color_picker';\nimport { split_text, PID_RE } from './text_splitter';\nimport {\n  format_time,\n  Time,\n  TitleLine,\n  ClickHandler,\n  ColoredSpan,\n  HighlightedMarkdown,\n} from './Common';\nimport './Flows.css';\nimport LazyLoad, { forceCheck } from 'react-lazyload';\nimport { TokenCtx, ReplyForm } from './UserAction';\nimport { API, parse_replies } from './flows_api';\nimport { cache } from './cache';\nimport { save_attentions } from './Attention';\nimport Poll from 'react-polls';\n\n/*\nconst IMAGE_BASE = 'https://thimg.yecdn.com/';\nconst IMAGE_BAK_BASE = 'https://img2.thuhole.com/';\n*/\n\nconst CLICKABLE_TAGS = { a: true, audio: true };\nconst PREVIEW_REPLY_COUNT = 10;\n// const QUOTE_BLACKLIST=['23333','233333','66666','666666','10086','10000','100000','99999','999999','55555','555555'];\nconst QUOTE_BLACKLIST = [];\n\nwindow.LATEST_POST_ID = parseInt(localStorage['_LATEST_POST_ID'], 10) || 0;\n\nconst DZ_NAME = '洞主';\n\nfunction load_single_meta(show_sidebar, token) {\n  return async (pid, replace = false) => {\n    let color_picker = new ColorPicker();\n    let title_elem = '树洞 #' + pid;\n    show_sidebar(\n      title_elem,\n      <div className=\"box box-tip\">正在加载 #{pid}</div>,\n      replace ? 'replace' : 'push',\n    );\n    try {\n      let single = await API.get_single(pid, token);\n      single.data.variant = {};\n      let { data: replies } = await API.load_replies_with_cache(\n        pid,\n        token,\n        color_picker,\n        parseInt(single.data.reply),\n      );\n      show_sidebar(\n        title_elem,\n        <FlowSidebar\n          key={+new Date()}\n          info={single.data}\n          replies={replies.data}\n          attention={replies.attention}\n          token={token}\n          show_sidebar={show_sidebar}\n          color_picker={color_picker}\n          deletion_detect={localStorage['DELETION_DETECT'] === 'on'}\n        />,\n        'replace',\n      );\n    } catch (e) {\n      console.error(e);\n      show_sidebar(\n        title_elem,\n        <div className=\"box box-tip\">\n          <p>\n            <a onClick={() => load_single_meta(show_sidebar, token)(pid, true)}>\n              重新加载\n            </a>\n          </p>\n          <p>{'' + e}</p>\n        </div>,\n        'replace',\n      );\n    }\n  };\n}\n\nclass Reply extends PureComponent {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    const {\n      info,\n      color_picker,\n      show_pid,\n      do_filter_name,\n      do_delete,\n      do_report,\n      do_block,\n      search_param,\n    } = this.props;\n    const author = info.name,\n      replyText = info.text,\n      has_block_words =\n        window.config.block_words_v3.some((word) => info.text.includes(word)) &&\n        !info.can_del;\n    this.color_picker = new ColorPicker();\n    return (\n      <div\n        className={'flow-reply box'}\n        style={\n          info._display_color\n            ? {\n                '--box-bgcolor-light': info._display_color[0],\n                '--box-bgcolor-dark': info._display_color[1],\n              }\n            : null\n        }\n      >\n        <div className=\"box-header\">\n          {!!do_filter_name && (\n            <span\n              className=\"reply-header-badge clickable\"\n              onClick={() => {\n                do_filter_name(info.name);\n              }}\n            >\n              <span className=\"icon icon-locate\" />\n            </span>\n          )}\n          &nbsp;\n          {<span className=\"box-header-name\">{info.name}</span>}\n          {info.author_title && (\n            <span className=\"box-header-name author-title\">{`\"${info.author_title}\"`}</span>\n          )}\n          {info.is_tmp && (\n            <span className=\"box-header-name tmp-title\">临时账号</span>\n          )}\n          {!!do_delete && !!info.can_del && (\n            <span\n              className=\"clickable\"\n              onClick={() => {\n                do_delete('cid', info.cid);\n              }}\n            >\n              {' '}\n              🗑️{' '}\n            </span>\n          )}\n          {!!do_block && (\n            <span className=\"clickable\" onClick={do_block}>\n              {' '}\n              🚫{' '}\n            </span>\n          )}\n          {!!do_report && (\n            <>\n              &nbsp;\n              <span className=\"clickable\" onClick={do_report}>\n                <span className=\"icon icon-flag\" />\n              </span>\n              &nbsp;\n            </>\n          )}\n          {info.dangerous_user && (\n            <span className=\"danger-info\"> {info.dangerous_user} </span>\n          )}\n          {info.blocked_count && (\n            <span className=\"danger-info\"> {info.blocked_count} </span>\n          )}\n          <Time stamp={info.timestamp} short={!do_report} />\n          &nbsp;\n          {has_block_words && <span className=\"box-header-badge\">已屏蔽</span>}\n        </div>\n        {!has_block_words && (\n          <div className=\"box-content\">\n            <HighlightedMarkdown\n              author={author}\n              text={replyText}\n              color_picker={color_picker}\n              show_pid={show_pid}\n              search_param={search_param}\n            />\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\nclass FlowItem extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      cw: props.info.cw || '',\n    };\n  }\n\n  copy_link(event) {\n    event.preventDefault();\n    copy(\n      `${event.target.href}${\n        this.props.info.cw ? ' 【' + this.props.info.cw + '】' : ''\n      }\\n` +\n        `${this.props.info.text}${\n          this.props.info.type === 'image'\n            ? ' [图片]'\n            : this.props.info.type === 'audio'\n            ? ' [语音]'\n            : ''\n        }\\n` +\n        `（${format_time(new Date(this.props.info.timestamp * 1000))} ${\n          this.props.info.likenum\n        }关注 ${this.props.info.reply}回复）\\n` +\n        this.props.replies\n          .map((r) => (r.cw ? '【' + r.cw + '】' : '') + r.text)\n          .join('\\n'),\n    );\n  }\n\n  on_cw_change(event) {\n    this.setState({\n      cw: event.target.value,\n    });\n  }\n\n  render() {\n    const {\n      info,\n      is_quote,\n      cached,\n      attention,\n      do_filter_name,\n      do_delete,\n      do_edit_cw,\n      img_clickable,\n      color_picker,\n      show_pid,\n      do_vote,\n      do_block,\n      search_param,\n    } = this.props;\n    const { cw } = this.state;\n    const _display_color = color_picker.get(DZ_NAME, info.is_tmp);\n    return (\n      <div className={'flow-item' + (is_quote ? ' flow-item-quote' : '')}>\n        {!!is_quote && (\n          <div className=\"quote-tip black-outline\">\n            <div>\n              <span className=\"icon icon-quote\" />\n            </div>\n            {/*<div>*/}\n            {/*  <small>提到</small>*/}\n            {/*</div>*/}\n          </div>\n        )}\n        <div\n          className=\"box\"\n          style={{\n            '--box-bgcolor-light': _display_color[0],\n            '--box-bgcolor-dark': _display_color[1],\n          }}\n        >\n          {!!window.LATEST_POST_ID &&\n            parseInt(info.pid, 10) > window.LATEST_POST_ID && (\n              <div className=\"flow-item-dot\" />\n            )}\n          {!!attention && !cached && <div className=\"flow-item-dot\" />}\n          <div className=\"box-header\">\n            {!!do_filter_name && (\n              <span\n                className=\"reply-header-badge clickable\"\n                onClick={() => {\n                  do_filter_name(DZ_NAME);\n                }}\n              >\n                <span className=\"icon icon-locate\" />\n              </span>\n            )}\n            {!!parseInt(info.likenum, 10) && (\n              <span className=\"box-header-badge\">\n                {info.likenum}&nbsp;\n                <span\n                  className={'icon icon-' + (attention ? 'star-ok' : 'star')}\n                />\n              </span>\n            )}\n            {!!parseInt(info.reply, 10) && (\n              <span className=\"box-header-badge\">\n                {info.reply}&nbsp;\n                <span className=\"icon icon-reply\" />\n              </span>\n            )}\n            <code className=\"box-id\">\n              <a href={'##' + info.pid} onClick={this.copy_link.bind(this)}>\n                #{info.pid}\n              </a>\n            </code>\n            &nbsp;\n            {info.author_title && (\n              <span className=\"box-header-name author-title\">{`\"${info.author_title}\"`}</span>\n            )}\n            {info.is_tmp && (\n              <span className=\"box-header-name tmp-title\">临时账号</span>\n            )}\n            {info.is_reported && <span className=\"danger-info\"> R </span>}\n            {!!do_delete && !!info.can_del && (\n              <span\n                className=\"clickable\"\n                onClick={() => {\n                  do_delete('pid', info.pid);\n                }}\n              >\n                {' '}\n                🗑️{' '}\n              </span>\n            )}\n            {!!do_block && (\n              <span className=\"clickable\" onClick={do_block}>\n                {' '}\n                🚫{' '}\n              </span>\n            )}\n            {info.dangerous_user && (\n              <span className=\"danger-info\"> {info.dangerous_user} </span>\n            )}\n            {info.blocked_count && (\n              <span className=\"danger-info\"> {info.blocked_count} </span>\n            )}\n            {info.cw !== null && (!do_edit_cw || !info.can_del) && (\n              <span className=\"box-header-cw\">{info.cw}</span>\n            )}\n            {!!do_edit_cw && !!info.can_del && (\n              <div className=\"box-header-cw-edit clickable\">\n                <input\n                  type=\"text\"\n                  value={cw}\n                  maxLength=\"32\"\n                  placeholder=\"编辑折叠警告\"\n                  onChange={this.on_cw_change.bind(this)}\n                />\n                <button type=\"button\" onClick={(e) => do_edit_cw(cw, info.pid)}>\n                  更新\n                </button>\n              </div>\n            )}\n            {info.allow_search && <span> 📢 </span>}\n            <Time stamp={info.timestamp} short={!img_clickable} />\n          </div>\n          {!!info.hot_score && (\n            <span className=\"box-header\">hot score: {info.hot_score}</span>\n          )}\n          <div className=\"box-content\">\n            <HighlightedMarkdown\n              text={info.text}\n              color_picker={color_picker}\n              show_pid={show_pid}\n              search_param={search_param}\n            />\n          </div>\n          {info.poll && (\n            <div className={!do_vote ? 'box-poll disabled' : 'box-poll'}>\n              <Poll\n                key={info.poll.vote || 'x'}\n                question={''}\n                answers={info.poll.answers}\n                onVote={do_vote || (() => {})}\n                customStyles={{ theme: 'cyan' }}\n                noStorage={true}\n                vote={localStorage['VOTE_RECORD:' + info.pid] || info.poll.vote}\n              />\n            </div>\n          )}\n          {!!(attention && info.variant.latest_reply) && (\n            <p className=\"box-footer\">\n              最新回复 <Time stamp={info.variant.latest_reply} short={false} />\n            </p>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n\nclass FlowSidebar extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      attention: props.attention,\n      info: props.info,\n      replies: props.replies,\n      loading_status: 'done',\n      error_msg: null,\n      filter_name: null,\n      rev: false,\n    };\n    this.color_picker = props.color_picker;\n    this.syncState = props.sync_state || (() => {});\n    this.reply_ref = React.createRef();\n  }\n\n  set_variant(cid, variant) {\n    this.setState(\n      (prev) => {\n        if (cid)\n          return {\n            replies: prev.replies.map((reply) => {\n              if (reply.cid === cid)\n                return Object.assign({}, reply, {\n                  variant: Object.assign({}, reply.variant, variant),\n                });\n              else return reply;\n            }),\n          };\n        else\n          return {\n            info: Object.assign({}, prev.info, {\n              variant: Object.assign({}, prev.info.variant, variant),\n            }),\n          };\n      },\n      function () {\n        this.syncState({\n          info: this.state.info,\n          replies: this.state.replies,\n        });\n      },\n    );\n  }\n\n  load_replies(update_count = true) {\n    this.setState({\n      loading_status: 'loading',\n      error_msg: null,\n    });\n    API.load_replies(\n      this.state.info.pid,\n      this.props.token,\n      this.color_picker,\n      null,\n    )\n      .then((json) => {\n        this.setState(\n          (prev, props) => ({\n            replies: json.data,\n            info: update_count\n              ? Object.assign({}, prev.info, {\n                  reply: '' + json.data.length,\n                  likenum: '' + json.likenum,\n                })\n              : prev.info,\n            attention: !!json.attention,\n            loading_status: 'done',\n            error_msg: null,\n          }),\n          () => {\n            this.syncState({\n              replies: this.state.replies,\n              attention: this.state.attention,\n              info: this.state.info,\n            });\n            if (this.state.replies.length)\n              this.set_variant(null, {\n                latest_reply: Math.max.apply(\n                  null,\n                  this.state.replies.map((r) => parseInt(r.timestamp)),\n                ),\n              });\n          },\n        );\n      })\n      .catch((e) => {\n        console.error(e);\n        this.setState({\n          replies: [],\n          loading_status: 'done',\n          error_msg: '' + e,\n        });\n      });\n  }\n\n  toggle_attention() {\n    const prev_info = this.state.info;\n    const pid = prev_info.pid;\n    API.set_attention(pid, !this.state.attention, this.props.token)\n      .then((json) => {\n        this.setState({\n          attention: json.attention,\n          info: Object.assign({}, prev_info, {\n            likenum: '' + json.likenum,\n          }),\n        });\n\n        let saved_attentions = window.saved_attentions;\n        if (json.attention && !saved_attentions.includes(pid)) {\n          saved_attentions.unshift(pid);\n        } else if (!json.attention && saved_attentions.includes(pid)) {\n          const idx = saved_attentions.indexOf(pid);\n          saved_attentions.splice(idx, 1);\n        }\n        window.saved_attentions = saved_attentions;\n        save_attentions();\n\n        this.syncState({\n          attention: json.attention,\n          info: Object.assign({}, prev_info, {\n            likenum: '' + json.likenum,\n          }),\n        });\n      })\n      .catch((e) => {\n        this.setState({\n          loading_status: 'done',\n        });\n        alert('设置关注失败\\n' + e);\n        console.error(e);\n      });\n  }\n\n  do_vote(vote) {\n    this.setState({\n      loading_status: 'loading',\n      error_msg: null,\n    });\n    API.add_vote(vote, this.state.info.pid, this.props.token)\n      .then((json) => {\n        if (json.code !== 0) return;\n        localStorage['VOTE_RECORD:' + this.state.info.pid] = vote;\n        this.setState(\n          (prev, props) => ({\n            info: Object.assign({}, prev.info, { poll: json.data }),\n            loading_status: 'done',\n          }),\n          () => {\n            this.syncState({\n              info: this.state.info,\n            });\n          },\n        );\n      })\n      .catch((e) => {\n        console.error(e);\n        this.setState({\n          loading_status: 'done',\n          error_msg: '' + e,\n        });\n      });\n  }\n\n  report(event, text = '') {\n    console.log(text);\n    let reason = prompt(`举报 #${this.state.info.pid} 的理由：`, text);\n    if (reason !== null) {\n      API.report(this.state.info.pid, reason, this.props.token)\n        .then((json) => {\n          alert('举报成功');\n        })\n        .catch((e) => {\n          alert('举报失败\\n' + e);\n          console.error(e);\n        });\n    }\n  }\n\n  block(name, type, id, on_complete) {\n    if (confirm(`确定拉黑${name}吗？后续将不会收到其发布的任何内容`)) {\n      API.block(type, id, this.props.token)\n        .then((json) => {\n          let data = json.data;\n          alert(`操作成功，当前拉黑数 ${data.curr}`);\n          !!on_complete && on_complete();\n        })\n        .catch((e) => {\n          alert('拉黑失败\\n' + e);\n          console.error(e);\n        });\n    }\n  }\n\n  set_filter_name(name) {\n    this.setState((prevState) => ({\n      filter_name: name === prevState.filter_name ? null : name,\n    }));\n  }\n\n  toggle_rev() {\n    this.setState((prevState) => ({ rev: !prevState.rev }), forceCheck);\n  }\n\n  show_reply_bar(name, event) {\n    if (this.reply_ref.current && !event.target.closest('a, .clickable')) {\n      let text = this.reply_ref.current.get();\n      if (\n        /^\\s*(?:Re (?:|洞主|(?:[A-Z][a-z]+ )?(?:[A-Z][a-z]+)|You Win(?: \\d+)?):)?\\s*$/.test(\n          text,\n        )\n      ) {\n        // text is nearly empty so we can replace it\n        let should_text = 'Re ' + name + ': ';\n        if (should_text === this.reply_ref.current.get())\n          this.reply_ref.current.set('');\n        else this.reply_ref.current.set(should_text);\n      }\n    }\n  }\n\n  make_do_delete(token, on_complete = null) {\n    const do_delete = (type, id) => {\n      let note = prompt(`将删除${type}=${id}, 备注：`, '(无)');\n      if (note !== null) {\n        API.del(type, id, note, token)\n          .then((json) => {\n            alert('删除成功');\n            on_complete();\n          })\n          .catch((e) => {\n            alert('删除失败\\n' + e);\n            console.error(e);\n          });\n      }\n    };\n    return do_delete;\n  }\n\n  do_edit_cw(cw, id) {\n    API.update_cw(cw, id, this.props.token)\n      .then((json) => {\n        this.setState(\n          {\n            info: Object.assign({}, this.state.info, { cw: cw }),\n          },\n          () => {\n            this.syncState({\n              info: this.state.info,\n            });\n          },\n        );\n        alert('已更新');\n      })\n      .catch((e) => {\n        alert('更新失败\\n' + e);\n        console.error(e);\n      });\n  }\n\n  render() {\n    if (this.state.loading_status === 'loading')\n      return <p className=\"box box-tip\">加载中……</p>;\n\n    let show_pid = load_single_meta(this.props.show_sidebar, this.props.token);\n\n    let replies_to_show = this.state.filter_name\n      ? this.state.replies.filter((r) => r.name === this.state.filter_name)\n      : this.state.replies.slice();\n    if (this.state.rev) replies_to_show.reverse();\n\n    // may not need key, for performance\n    // key for lazyload elem\n    // let view_mode_key =\n    //   (this.state.rev ? 'y-' : 'n-') + (this.state.filter_name || 'null');\n\n    let replies_cnt = { [DZ_NAME]: 1 };\n    replies_to_show.forEach((r) => {\n      if (replies_cnt[r.name] === undefined) replies_cnt[r.name] = 0;\n      replies_cnt[r.name]++;\n    });\n\n    // hide main thread when filtered\n    let main_thread_elem =\n      this.state.filter_name && this.state.filter_name !== DZ_NAME ? null : (\n        <ClickHandler\n          callback={(e) => {\n            this.show_reply_bar('', e);\n          }}\n        >\n          <FlowItem\n            info={this.state.info}\n            attention={this.state.attention}\n            img_clickable={true}\n            color_picker={this.color_picker}\n            show_pid={show_pid}\n            search_param={this.props.search_param}\n            replies={this.state.replies}\n            set_variant={(variant) => {\n              this.set_variant(null, variant);\n            }}\n            do_filter_name={\n              replies_cnt[DZ_NAME] > 1 ? this.set_filter_name.bind(this) : null\n            }\n            do_delete={this.make_do_delete(this.props.token, () => {\n              window.location.reload();\n            })}\n            do_edit_cw={this.do_edit_cw.bind(this)}\n            do_vote={this.do_vote.bind(this)}\n            do_block={() => {\n              this.block('洞主', 'post', this.state.info.pid, () => {\n                window.location.reload();\n              });\n            }}\n          />\n        </ClickHandler>\n      );\n\n    return (\n      <div className=\"flow-item-row sidebar-flow-item\">\n        <div className=\"box box-tip\">\n          {!!this.props.token && (\n            <span>\n              <a onClick={this.report.bind(this)}>\n                <span className=\"icon icon-flag\" />\n                <label>举报</label>\n              </a>\n              &nbsp;&nbsp;\n            </span>\n          )}\n          <a onClick={this.load_replies.bind(this)}>\n            <span className=\"icon icon-refresh\" />\n            <label>刷新</label>\n          </a>\n          {(this.state.replies.length >= 1 || this.state.rev) && (\n            <span>\n              &nbsp;&nbsp;\n              <a onClick={this.toggle_rev.bind(this)}>\n                <span className=\"icon icon-order-rev\" />\n                <label>{this.state.rev ? '还原' : '逆序'}</label>\n              </a>\n            </span>\n          )}\n          {!!this.props.token && (\n            <span>\n              &nbsp;&nbsp;\n              <a\n                onClick={() => {\n                  this.toggle_attention();\n                }}\n              >\n                {this.state.attention ? (\n                  <span>\n                    <span className=\"icon icon-star-ok\" />\n                    <label>已关注</label>\n                  </span>\n                ) : (\n                  <span>\n                    <span className=\"icon icon-star\" />\n                    <label>未关注</label>\n                  </span>\n                )}\n              </a>\n            </span>\n          )}\n        </div>\n        {!!this.state.filter_name && (\n          <div className=\"box box-tip flow-item filter-name-bar\">\n            <p>\n              <span style={{ float: 'left' }}>\n                <a\n                  onClick={() => {\n                    this.set_filter_name(null);\n                  }}\n                >\n                  还原\n                </a>\n              </span>\n              <span className=\"icon icon-locate\" />\n              &nbsp;当前只看&nbsp;\n              <ColoredSpan\n                colors={this.color_picker.get(this.state.filter_name)}\n              >\n                {this.state.filter_name}\n              </ColoredSpan>\n            </p>\n          </div>\n        )}\n        {!this.state.rev && main_thread_elem}\n        {!!this.state.error_msg && (\n          <div className=\"box box-tip flow-item\">\n            <p>加载失败</p>\n            <p>{this.state.error_msg}</p>\n          </div>\n        )}\n        {this.props.deletion_detect &&\n          parseInt(this.state.info.reply) > this.state.replies.length &&\n          !!this.state.replies.length && (\n            <div className=\"box box-tip flow-item box-danger\">\n              {parseInt(this.state.info.reply) - this.state.replies.length}{' '}\n              条回复被删除\n            </div>\n          )}\n        {replies_to_show.map(\n          (reply, i) =>\n            (reply.can_del || !reply.is_blocked) && (\n              <LazyLoad\n                key={i}\n                offset={1500}\n                height=\"5em\"\n                overflow={true}\n                once={true}\n              >\n                <ClickHandler\n                  callback={(e) => {\n                    this.show_reply_bar(reply.name, e);\n                  }}\n                >\n                  <Reply\n                    info={reply}\n                    color_picker={this.color_picker}\n                    show_pid={show_pid}\n                    search_param={this.props.search_param}\n                    set_variant={(variant) => {\n                      this.set_variant(reply.cid, variant);\n                    }}\n                    do_filter_name={\n                      replies_cnt[reply.name] > 1\n                        ? this.set_filter_name.bind(this)\n                        : null\n                    }\n                    do_delete={this.make_do_delete(\n                      this.props.token,\n                      this.load_replies.bind(this),\n                    )}\n                    do_block={() => {\n                      this.block(\n                        reply.name,\n                        'comment',\n                        reply.cid,\n                        this.load_replies.bind(this),\n                      );\n                    }}\n                    do_report={(e) => {\n                      this.report(\n                        e,\n                        `评论区${reply.name}，评论id ${reply.cid}`,\n                      );\n                    }}\n                  />\n                </ClickHandler>\n              </LazyLoad>\n            ),\n        )}\n        {this.state.rev && main_thread_elem}\n        {this.props.token ? (\n          <ReplyForm\n            pid={this.state.info.pid}\n            token={this.props.token}\n            area_ref={this.reply_ref}\n            on_complete={this.load_replies.bind(this)}\n          />\n        ) : (\n          <div className=\"box box-tip flow-item\">登录后可以回复树洞</div>\n        )}\n      </div>\n    );\n  }\n}\n\nclass FlowItemRow extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.needFold =\n      props.info.cw &&\n      window.config.whitelist_cw.indexOf('*') == -1 &&\n      window.config.whitelist_cw.indexOf(props.info.cw) == -1 &&\n      props.mode === 'list';\n    this.has_block_words =\n      window.config.block_words_v3.some((word) =>\n        props.info.text.includes(word),\n      ) && !props.info.can_del;\n    this.color_picker = new ColorPicker();\n    this.state = {\n      replies: props.info.comments\n        ? parse_replies(props.info.comments, this.color_picker)\n        : [],\n      reply_status: 'done',\n      reply_error: null,\n      info: Object.assign({}, props.info, { variant: {} }),\n      attention: props.info.attention,\n      cached: true, // default no display anything\n    };\n  }\n\n  componentDidMount() {\n    // cache from getlist, so always to this to update attention\n    if (!this.props.info.comments) {\n      //if (true || parseInt(this.state.info.reply, 10)) {\n      this.load_replies(null, /*update_count=*/ false);\n    }\n  }\n\n  // reveal() {\n  //   this.setState({ hidden: false });\n  // }\n\n  load_replies(callback, update_count = true) {\n    //console.log('fetching reply', this.state.info.pid);\n    this.setState({\n      reply_status: 'loading',\n      reply_error: null,\n    });\n    API.load_replies_with_cache(\n      this.state.info.pid,\n      this.props.token,\n      this.color_picker,\n      parseInt(this.state.info.reply),\n    )\n      .then(({ data: json, cached }) => {\n        //console.log('>> update', json, json.attention);\n        this.setState(\n          (prev, props) => ({\n            replies: json.data,\n            info: Object.assign({}, prev.info, {\n              reply: update_count ? '' + json.data.length : prev.info.reply,\n              variant: json.data.length\n                ? {\n                    latest_reply: Math.max.apply(\n                      null,\n                      json.data.map((r) => parseInt(r.timestamp)),\n                    ),\n                  }\n                : {},\n            }),\n            attention: !!json.attention,\n            reply_status: 'done',\n            reply_error: null,\n            cached,\n          }),\n          callback,\n        );\n      })\n      .catch((e) => {\n        console.error(e);\n        this.setState(\n          {\n            replies: [],\n            reply_status: 'failed',\n            reply_error: '' + e,\n          },\n          callback,\n        );\n      });\n  }\n\n  show_sidebar() {\n    this.props.show_sidebar(\n      '树洞 #' + this.state.info.pid,\n      <FlowSidebar\n        key={+new Date()}\n        info={this.state.info}\n        search_param={this.props.search_param}\n        replies={this.state.replies}\n        attention={this.state.attention}\n        sync_state={this.setState.bind(this)}\n        token={this.props.token}\n        show_sidebar={this.props.show_sidebar}\n        color_picker={this.color_picker}\n        deletion_detect={this.props.deletion_detect}\n      />,\n    );\n  }\n\n  render() {\n    const { show_sidebar, token, search_param, is_quote, mode } = this.props;\n    let show_pid = load_single_meta(show_sidebar, token, [this.state.info.pid]);\n\n    let hl_rules = [['pid', PID_RE]];\n    let parts = split_text(this.state.info.text, hl_rules);\n\n    //console.log('hl:', parts,this.state.info.pid);\n\n    let quote_id = null;\n    if (!is_quote)\n      for (let [mode, content] of parts) {\n        content = content.length > 0 ? content.substring(1) : content;\n        if (\n          mode === 'pid' &&\n          QUOTE_BLACKLIST.indexOf(content) === -1 &&\n          parseInt(content) < parseInt(this.state.info.pid)\n        ) {\n          if (quote_id === null) quote_id = parseInt(content);\n          else {\n            quote_id = null;\n            break;\n          }\n        }\n      }\n\n    let res = (\n      <div\n        className={\n          'flow-item-row flow-item-row-with-prompt' +\n          (is_quote ? ' flow-item-row-quote' : '')\n        }\n        onClick={(event) => {\n          if (!CLICKABLE_TAGS[event.target.tagName.toLowerCase()])\n            this.show_sidebar();\n        }}\n      >\n        <FlowItem\n          info={this.state.info}\n          attention={this.state.attention}\n          img_clickable={false}\n          is_quote={this.props.is_quote}\n          color_picker={this.color_picker}\n          show_pid={show_pid}\n          replies={this.state.replies}\n          cached={this.state.cached}\n          search_param={search_param}\n        />\n        <div className=\"flow-reply-row\">\n          {this.state.reply_status === 'loading' && (\n            <div className=\"box box-tip\">加载中</div>\n          )}\n          {this.state.reply_status === 'failed' && (\n            <div className=\"box box-tip\">\n              <p>\n                <a\n                  onClick={() => {\n                    this.load_replies();\n                  }}\n                >\n                  重新加载评论\n                </a>\n              </p>\n              <p>{this.state.reply_error}</p>\n            </div>\n          )}\n          {this.state.replies\n            .slice(0, PREVIEW_REPLY_COUNT)\n            .map(\n              (reply) =>\n                (reply.can_del || !reply.is_blocked) && (\n                  <Reply\n                    key={reply.cid}\n                    info={reply}\n                    color_picker={this.color_picker}\n                    show_pid={show_pid}\n                    search_param={search_param}\n                  />\n                ),\n            )}\n          {this.state.replies.length > PREVIEW_REPLY_COUNT && (\n            <div className=\"box box-tip\">\n              还有 {this.state.replies.length - PREVIEW_REPLY_COUNT} 条\n            </div>\n          )}\n        </div>\n      </div>\n    );\n\n    if (this.needFold || this.has_block_words) {\n      return (\n        (!this.has_block_words || mode !== 'list') && (\n          <div\n            className=\"flow-item-row flow-item-row-with-prompt\"\n            onClick={(event) => {\n              if (!CLICKABLE_TAGS[event.target.tagName.toLowerCase()])\n                this.show_sidebar();\n            }}\n          >\n            <div\n              className={\n                'flow-item' + (this.props.is_quote ? ' flow-item-quote' : '')\n              }\n            >\n              {!!this.props.is_quote && (\n                <div className=\"quote-tip black-outline\">\n                  <div>\n                    <span className=\"icon icon-quote\" />\n                  </div>\n                  {/*<div>*/}\n                  {/*  <small>提到</small>*/}\n                  {/*</div>*/}\n                </div>\n              )}\n              <div className=\"box\">\n                <div className=\"box-header\">\n                  {!!this.props.do_filter_name && (\n                    <span\n                      className=\"reply-header-badge clickable\"\n                      onClick={() => {\n                        this.props.do_filter_name(DZ_NAME);\n                      }}\n                    >\n                      <span className=\"icon icon-locate\" />\n                    </span>\n                  )}\n                  <code className=\"box-id\">#{this.props.info.pid}</code>\n                  &nbsp;\n                  {this.props.info.author_title && (\n                    <span className=\"box-header-name author-title\">{`\"${this.props.info.author_title}\"`}</span>\n                  )}\n                  {this.props.info.is_tmp && (\n                    <span className=\"box-header-name tmp-title\">临时账号</span>\n                  )}\n                  {this.props.info.cw !== null && (\n                    <span className=\"box-header-cw\">{this.props.info.cw}</span>\n                  )}\n                  <Time stamp={this.props.info.timestamp} short={true} />\n                  <span className=\"box-header-badge\">\n                    {this.needFold ? '已折叠' : '已屏蔽'}\n                  </span>\n                  <div style={{ clear: 'both' }} />\n                </div>\n              </div>\n            </div>\n          </div>\n        )\n      );\n    }\n\n    return quote_id ? (\n      <div>\n        {res}\n        <FlowItemQuote\n          pid={quote_id}\n          show_sidebar={this.props.show_sidebar}\n          token={this.props.token}\n          deletion_detect={this.props.deletion_detect}\n        />\n      </div>\n    ) : (\n      res\n    );\n  }\n}\n\nclass FlowItemQuote extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading_status: 'empty',\n      error_msg: null,\n      info: null,\n    };\n  }\n\n  componentDidMount() {\n    this.load();\n  }\n\n  load() {\n    this.setState(\n      {\n        loading_status: 'loading',\n      },\n      () => {\n        API.get_single(this.props.pid, this.props.token)\n          .then((json) => {\n            this.setState({\n              loading_status: 'done',\n              info: json.data,\n            });\n          })\n          .catch((err) => {\n            if (('' + err).indexOf('没有这条树洞') !== -1)\n              this.setState({\n                loading_status: 'empty',\n              });\n            else\n              this.setState({\n                loading_status: 'error',\n                error_msg: '' + err,\n              });\n          });\n      },\n    );\n  }\n\n  render() {\n    if (this.state.loading_status === 'empty') return null;\n    else if (this.state.loading_status === 'loading')\n      return (\n        <div className=\"aux-margin\">\n          <div className=\"box box-tip\">\n            <span className=\"icon icon-loading\" />\n            提到了 #{this.props.pid}\n          </div>\n        </div>\n      );\n    else if (this.state.loading_status === 'error')\n      return (\n        <div className=\"aux-margin\">\n          <div className=\"box box-tip\">\n            <p>\n              <a onClick={this.load.bind(this)}>重新加载</a>\n            </p>\n            <p>{this.state.error_msg}</p>\n          </div>\n        </div>\n      );\n    // 'done'\n    else\n      return (\n        <FlowItemRow\n          info={this.state.info}\n          mode={this.props.mode}\n          show_sidebar={this.props.show_sidebar}\n          token={this.props.token}\n          is_quote={true}\n          deletion_detect={this.props.deletion_detect}\n        />\n      );\n  }\n}\n\nfunction FlowChunk(props) {\n  return (\n    <TokenCtx.Consumer>\n      {({ value: token }) => (\n        <div className=\"flow-chunk\">\n          {!!props.title && <TitleLine text={props.title} />}\n          {props.list.map(\n            (info, ind) =>\n              (info.can_del || !info.is_blocked) && (\n                <LazyLoad\n                  key={info.key || info.pid}\n                  offset={500}\n                  height=\"15em\"\n                  hiddenIfInvisible={false}\n                >\n                  <div>\n                    {!!(\n                      props.deletion_detect &&\n                      props.mode === 'list' &&\n                      ind &&\n                      props.list[ind - 1].pid - info.pid > 1\n                    ) && (\n                      <div className=\"flow-item-row\">\n                        <div className=\"box box-tip flow-item box-danger\">\n                          {props.list[ind - 1].pid - info.pid - 1} 条被删除\n                        </div>\n                      </div>\n                    )}\n                    <FlowItemRow\n                      info={info}\n                      mode={props.mode}\n                      show_sidebar={props.show_sidebar}\n                      token={token}\n                      deletion_detect={props.deletion_detect}\n                      search_param={props.search_param}\n                    />\n                  </div>\n                </LazyLoad>\n              ),\n          )}\n        </div>\n      )}\n    </TokenCtx.Consumer>\n  );\n}\n\nexport class Flow extends PureComponent {\n  constructor(props) {\n    super(props);\n    let submode = window[props.mode.toUpperCase() + '_SUBMODE_BACKUP'];\n    if (submode === undefined) {\n      submode = props.mode === 'list' ? (window.config.by_c ? 1 : 0) : 0;\n    }\n    this.state = {\n      submode: submode,\n    };\n  }\n\n  get_submode_names(mode) {\n    switch (mode) {\n      case 'list':\n        return ['最新', '最近回复', '近期热门', '随机'];\n      case 'attention':\n        return ['线上关注', '本地收藏'];\n      case 'search':\n        return ['Tag搜索', '全文搜索', '头衔'];\n    }\n    return [];\n  }\n\n  set_submode(submode) {\n    window[this.props.mode.toUpperCase() + '_SUBMODE_BACKUP'] = submode;\n    this.setState({\n      submode: submode,\n    });\n  }\n\n  render() {\n    const { submode } = this.state;\n    const submode_names = this.get_submode_names(this.props.mode);\n    return (\n      <>\n        <div className=\"aux-margin flow-submode-choice\">\n          {submode_names.map((name, idx) => (\n            <a\n              key={idx}\n              className={submode === idx ? 'choiced' : ''}\n              onClick={this.set_submode.bind(this, idx)}\n            >\n              {name}\n            </a>\n          ))}\n        </div>\n\n        <SubFlow\n          key={submode}\n          show_sidebar={this.props.show_sidebar}\n          mode={this.props.mode}\n          submode={submode}\n          search_text={this.props.search_text}\n          token={this.props.token}\n        />\n      </>\n    );\n  }\n}\n\nclass SubFlow extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      mode: props.mode,\n      search_param: props.search_text,\n      loaded_pages: 0,\n      chunks: {\n        title: '',\n        data: [],\n      },\n      export_text: '',\n      loading_status: 'done',\n      error_msg: null,\n    };\n    this.on_scroll_bound = this.on_scroll.bind(this);\n    window.LATEST_POST_ID = parseInt(localStorage['_LATEST_POST_ID'], 10) || 0;\n  }\n\n  load_page(page) {\n    const failed = (err) => {\n      console.error(err);\n      this.setState((prev, props) => ({\n        loaded_pages: prev.loaded_pages - 1,\n        loading_status: 'failed',\n        error_msg: '' + err,\n      }));\n    };\n\n    if (page > this.state.loaded_pages + 1) throw new Error('bad page');\n    if (page === this.state.loaded_pages + 1) {\n      const { mode, search_param } = this.state;\n      const { token, submode } = this.props;\n      console.log('fetching page', page);\n      cache();\n      if (mode === 'list') {\n        API.get_list(page, token, submode)\n          .then((json) => {\n            if (page === 1 && json.data.length) {\n              // update latest_post_id\n              let max_id = window.LATEST_POST_ID || -1;\n              json.data.forEach((x) => {\n                if (parseInt(x.pid, 10) > max_id) max_id = parseInt(x.pid, 10);\n              });\n              localStorage['_LATEST_POST_ID'] = '' + max_id;\n            }\n            window.TITLE = json.custom_title;\n            window.AUTO_BLCOK = json.auto_block_rank;\n            json.data.forEach((x) => {\n              if (x.comments) {\n                let comment_json = {\n                  code: 0,\n                  attention: x.attention,\n                  data: x.comments,\n                };\n                //console.log('My cache', comment_json, x.pid, x.reply)\n                cache().put(x.pid, parseInt(x.reply, 10), comment_json);\n              }\n            });\n            this.setState((prev, props) => ({\n              chunks: {\n                title: 'News Feed',\n                data: prev.chunks.data.concat(\n                  json.data.filter(\n                    (x) =>\n                      prev.chunks.data.length === 0 ||\n                      !prev.chunks.data\n                        .slice(-100)\n                        .some((p) => p.pid === x.pid),\n                  ),\n                ),\n              },\n              loading_status: 'done',\n            }));\n          })\n          .catch(failed);\n      } else if (mode === 'search' && search_param) {\n        API.get_search(page, search_param, token, submode)\n          .then((json) => {\n            const finished = json.data.length === 0;\n            this.setState((prev, props) => ({\n              chunks: {\n                title: 'Result for \"' + search_param + '\"',\n                data: prev.chunks.data.concat(json.data),\n              },\n              mode: finished ? 'search_finished' : 'search',\n              loading_status: 'done',\n            }));\n          })\n          .catch(failed);\n      } else if (mode === 'single') {\n        const pid = parseInt(this.state.search_param.substr(1), 10);\n        API.get_single(pid, this.props.token)\n          .then((json) => {\n            let x = json.data;\n            if (x.comments) {\n              let comment_json = {\n                code: 0,\n                attention: x.attention,\n                data: x.comments,\n              };\n              //console.log('My cache', comment_json, x.pid, x.reply)\n              cache().put(x.pid, parseInt(x.reply, 10), comment_json);\n            }\n\n            this.setState({\n              chunks: {\n                title: 'PID = ' + pid,\n                data: [json.data],\n              },\n              mode: 'single_finished',\n              loading_status: 'done',\n            });\n          })\n          .catch(failed);\n      } else if (mode === 'attention') {\n        let use_search = !!this.state.search_param;\n        let use_regex = use_search && !!this.state.search_param.match(/\\/.+\\//);\n        let regex_search = /.+/;\n        if (use_regex) {\n          try {\n            regex_search = new RegExp(this.state.search_param.slice(1, -1));\n          } catch (e) {\n            alert(`请检查正则表达式合法性！\\n${e}`);\n            regex_search = /.+/;\n          }\n        }\n        console.log(use_search, use_regex);\n\n        if (this.props.submode === 0) {\n          API.get_attention(this.props.token)\n            .then((json) => {\n              this.setState({\n                chunks: {\n                  title: `${\n                    use_search\n                      ? use_regex\n                        ? `Result for RegEx ${regex_search.toString()} in `\n                        : `Result for \"${this.state.search_param}\" in `\n                      : ''\n                  }Attention List`,\n                  data: !use_search\n                    ? json.data\n                    : !use_regex\n                    ? json.data.filter((post) => {\n                        return this.state.search_param\n                          .split(' ')\n                          .every((keyword) => post.text.includes(keyword));\n                      }) // Not using regex\n                    : json.data.filter(\n                        (post) => !!post.text.match(regex_search),\n                      ), // Using regex\n                },\n                mode: 'attention_finished',\n                loading_status: 'done',\n              });\n              if (!use_search) {\n                window.saved_attentions = Array.from(\n                  new Set([\n                    ...window.saved_attentions,\n                    ...json.data.map((post) => post.pid),\n                  ]),\n                ).sort((a, b) => b - a);\n                save_attentions();\n              }\n            })\n            .catch(failed);\n        } else if (this.props.submode === 1) {\n          const PERPAGE = 50;\n          let pids = window.saved_attentions\n            .sort((a, b) => b - a)\n            .slice((page - 1) * PERPAGE, page * PERPAGE);\n          if (pids.length) {\n            API.get_multi(pids, this.props.token)\n              .then((json) => {\n                json.data.forEach((x) => {\n                  if (x.comments) {\n                    let comment_json = {\n                      code: 0,\n                      attention: x.attention,\n                      data: x.comments,\n                    };\n                    //console.log('My cache', comment_json, x.pid, x.reply)\n                    cache().put(x.pid, parseInt(x.reply, 10), comment_json);\n                  }\n                });\n                this.setState((prev, props) => ({\n                  chunks: {\n                    title: 'Attention List: Local',\n                    data: prev.chunks.data.concat(json.data),\n                  },\n                  loading_status: 'done',\n                }));\n              })\n              .catch(failed);\n          } else {\n            console.log('local attention finished');\n            this.setState({\n              loading_status: 'done',\n              mode: 'attention_finished',\n            });\n            return;\n          }\n        }\n      } else {\n        console.log('nothing to load');\n        return;\n      }\n\n      this.setState((prev, props) => ({\n        loaded_pages: prev.loaded_pages + 1,\n        loading_status: 'loading',\n        error_msg: null,\n      }));\n    }\n  }\n\n  on_scroll(event) {\n    if (event.target === document) {\n      const avail =\n        document.body.scrollHeight - window.scrollY - window.innerHeight;\n      if (avail < window.innerHeight && this.state.loading_status === 'done')\n        this.load_page(this.state.loaded_pages + 1);\n    }\n  }\n\n  componentDidMount() {\n    this.load_page(1);\n    window.addEventListener('scroll', this.on_scroll_bound);\n    window.addEventListener('resize', this.on_scroll_bound);\n  }\n  componentWillUnmount() {\n    window.removeEventListener('scroll', this.on_scroll_bound);\n    window.removeEventListener('resize', this.on_scroll_bound);\n  }\n\n  trunc_string(s, max_len) {\n    return s.substr(0, max_len) + (s.length > max_len ? '...' : '');\n  }\n\n  gen_export() {\n    this.setState({\n      can_export: false,\n      export_text:\n        '以下是你关注的洞及摘要，复制保存到本地吧。\\n\\n' +\n        this.state.chunks.data\n          .map(\n            (p) =>\n              `#${p.pid}: ${this.trunc_string(\n                p.text.replaceAll('\\n', ' '),\n                50,\n              )}`,\n          )\n          .join('\\n\\n'),\n    });\n  }\n\n  render() {\n    const should_deletion_detect = localStorage['DELETION_DETECT'] === 'on';\n    return (\n      <div className=\"flow-container\">\n        {this.state.mode === 'attention_finished' && this.props.submode == 0 && (\n          <button\n            className=\"export-btn\"\n            type=\"button\"\n            onClick={this.gen_export.bind(this)}\n          >\n            导出\n          </button>\n        )}\n\n        {this.state.export_text && (\n          <div className=\"box\">\n            <textarea\n              className=\"export-textarea\"\n              value={this.state.export_text}\n              readOnly\n            />\n          </div>\n        )}\n\n        <FlowChunk\n          title={this.state.chunks.title}\n          list={this.state.chunks.data}\n          mode={this.state.mode}\n          search_param={this.state.search_param || null}\n          show_sidebar={this.props.show_sidebar}\n          deletion_detect={should_deletion_detect}\n        />\n        {this.state.loading_status === 'failed' && (\n          <div className=\"aux-margin\">\n            <div className=\"box box-tip\">\n              <p>\n                <a\n                  onClick={() => {\n                    this.load_page(this.state.loaded_pages + 1);\n                  }}\n                >\n                  重新加载\n                </a>\n              </p>\n              <p>{this.state.error_msg}</p>\n            </div>\n          </div>\n        )}\n        <TitleLine\n          text={\n            this.state.loading_status === 'loading' ? (\n              <span>\n                <span className=\"icon icon-loading\" />\n                &nbsp;Loading...\n              </span>\n            ) : (\n              '🄯 2020 copyleft: hole_thu'\n            )\n          }\n        />\n      </div>\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\n// import {AppSwitcher} from './infrastructure/widgets';\nimport { InfoSidebar, PostForm } from './UserAction';\nimport { TokenCtx } from './UserAction';\n\nimport './Title.css';\n\nconst flag_re = /^\\/\\/setflag ([a-zA-Z0-9_]+)=(.*)$/;\n\nclass ControlBar extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      search_text: '',\n    };\n    this.set_mode = props.set_mode;\n\n    this.on_change_bound = this.on_change.bind(this);\n    this.on_keypress_bound = this.on_keypress.bind(this);\n    this.do_refresh_bound = this.do_refresh.bind(this);\n    this.do_attention_bound = this.do_attention.bind(this);\n  }\n\n  componentDidMount() {\n    if (window.location.hash) {\n      let text = decodeURIComponent(window.location.hash).substr(1);\n      if (text.lastIndexOf('?') !== -1)\n        text = text.substr(0, text.lastIndexOf('?')); // fuck wechat '#param?nsukey=...'\n      this.setState(\n        {\n          search_text: text,\n        },\n        () => {\n          this.on_keypress({ key: 'Enter' });\n        },\n      );\n    }\n\n    window.addEventListener(\n      'hashchange',\n      () => {\n        let text = decodeURIComponent(window.location.hash).substr(1);\n        if (text && text[0] != '#') {\n          console.log('search', text);\n          this.setState(\n            {\n              search_text: text,\n            },\n            () => {\n              this.on_keypress({ key: 'Enter' });\n            },\n          );\n        }\n      },\n      false,\n    );\n  }\n\n  on_change(event) {\n    this.setState({\n      search_text: event.target.value,\n    });\n  }\n\n  on_keypress(event) {\n    if (event.key === 'Enter') {\n      let flag_res = flag_re.exec(this.state.search_text);\n      if (flag_res) {\n        if (flag_res[2]) {\n          localStorage[flag_res[1]] = flag_res[2];\n          alert(\n            'Set Flag ' +\n              flag_res[1] +\n              '=' +\n              flag_res[2] +\n              '\\nYou may need to refresh this webpage.',\n          );\n        } else {\n          delete localStorage[flag_res[1]];\n          alert(\n            'Clear Flag ' +\n              flag_res[1] +\n              '\\nYou may need to refresh this webpage.',\n          );\n        }\n        return;\n      }\n\n      const mode = this.state.search_text.startsWith('#')\n        ? 'single'\n        : this.props.mode !== 'attention'\n        ? 'search'\n        : 'attention';\n      this.set_mode(mode, this.state.search_text || '');\n    }\n  }\n\n  do_refresh() {\n    window.scrollTo(0, 0);\n    this.setState({\n      search_text: '',\n    });\n    this.set_mode('list', null);\n    window.location.hash = '';\n  }\n\n  do_attention() {\n    window.scrollTo(0, 0);\n    this.setState({\n      search_text: '',\n    });\n    this.set_mode('attention', null);\n  }\n\n  render() {\n    return (\n      <TokenCtx.Consumer>\n        {({ value: token }) => (\n          <div className=\"control-bar\">\n            <a\n              className=\"no-underline control-btn\"\n              onClick={this.do_refresh_bound}\n            >\n              <span className=\"icon icon-refresh\" />\n              <span className=\"control-btn-label\">刷新</span>\n            </a>\n            {!!token && (\n              <a\n                className=\"no-underline control-btn\"\n                onClick={this.do_attention_bound}\n              >\n                <span className=\"icon icon-attention\" />\n                <span className=\"control-btn-label\">关注</span>\n              </a>\n            )}\n            <input\n              className=\"control-search\"\n              value={this.state.search_text}\n              placeholder={\n                this.props.mode === 'attention'\n                  ? '在关注列表中搜索'\n                  : '关键词 / tag / #树洞号'\n              }\n              onChange={this.on_change_bound}\n              onKeyPress={this.on_keypress_bound}\n            />\n            <a\n              className=\"no-underline control-btn\"\n              onClick={() => {\n                this.props.show_sidebar(\n                  '新T树洞',\n                  <InfoSidebar show_sidebar={this.props.show_sidebar} />,\n                );\n              }}\n            >\n              <span className={'icon icon-' + (token ? 'about' : 'login')} />\n              <span className=\"control-btn-label\">\n                {token ? '账户' : '登录'}\n              </span>\n            </a>\n            {!!token && (\n              <a\n                className=\"no-underline control-btn\"\n                onClick={() => {\n                  this.props.show_sidebar(\n                    '发表树洞',\n                    <PostForm\n                      token={token}\n                      on_complete={() => {\n                        this.props.show_sidebar(null, null, 'clear');\n                        this.do_refresh();\n                      }}\n                    />,\n                  );\n                }}\n              >\n                <span className=\"icon icon-plus\" />\n                <span className=\"control-btn-label\">发表</span>\n              </a>\n            )}\n          </div>\n        )}\n      </TokenCtx.Consumer>\n    );\n  }\n}\n\nexport function Title(props) {\n  return (\n    <div className=\"title-bar\">\n      {/* <AppSwitcher appid=\"hole\" /> */}\n      <div className=\"aux-margin\">\n        <div className=\"title\">\n          <p className=\"centered-line\">\n            <span\n              onClick={() =>\n                props.show_sidebar(\n                  '新T树洞',\n                  <InfoSidebar show_sidebar={props.show_sidebar} />,\n                )\n              }\n            >\n              新T树洞\n            </span>\n          </p>\n        </div>\n        <ControlBar\n          show_sidebar={props.show_sidebar}\n          set_mode={props.set_mode}\n          mode={props.mode}\n        />\n      </div>\n    </div>\n  );\n}\n","import React, { PureComponent } from 'react';\nimport './Sidebar.css';\n\nexport class Sidebar extends PureComponent {\n  constructor(props) {\n    super(props);\n    // this.sidebar_ref = React.createRef();\n    this.do_close_bound = this.do_close.bind(this);\n    this.do_back_bound = this.do_back.bind(this);\n  }\n\n  do_close() {\n    this.props.show_sidebar(null, null, 'clear');\n  }\n  do_back() {\n    this.props.show_sidebar(null, null, 'pop');\n  }\n\n  render() {\n    // hide old contents to remember state\n    let contents = this.props.stack.map(\n      ({ 1: content }, i) =>\n        content && (\n          <div\n            key={i}\n            className={\n              'sidebar-content ' +\n              (i === this.props.stack.length - 1\n                ? 'sidebar-content-show'\n                : 'sidebar-content-hide')\n            }\n          >\n            {content}\n          </div>\n        ),\n    );\n    let cur_title = this.props.stack[this.props.stack.length - 1][0];\n    return (\n      <div\n        className={\n          'sidebar-container ' +\n          (cur_title !== null ? 'sidebar-on' : 'sidebar-off')\n        }\n      >\n        <div\n          className=\"sidebar-shadow\"\n          onClick={this.do_back_bound}\n          onTouchEnd={(e) => {\n            e.preventDefault();\n            e.target.click();\n          }}\n        />\n        <div className=\"sidebar\">{contents}</div>\n        <div className=\"sidebar-title\">\n          <a className=\"no-underline\" onClick={this.do_close_bound}>\n            &nbsp;\n            <span className=\"icon icon-close\" />\n            &nbsp;\n          </a>\n          {this.props.stack.length > 2 && (\n            <a className=\"no-underline\" onClick={this.do_back_bound}>\n              &nbsp;\n              <span className=\"icon icon-back\" />\n              &nbsp;\n            </a>\n          )}\n          {cur_title}\n        </div>\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport Pressure from 'pressure';\n\nimport './PressureHelper.css';\n\nconst THRESHOLD = 0.4;\nconst MULTIPLIER = 25;\nconst BORDER_WIDTH = 500; // also change css!\n\nexport class PressureHelper extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      level: 0,\n      fired: false,\n    };\n    this.callback = props.callback;\n    this.esc_interval = null;\n  }\n\n  do_fire() {\n    if (this.esc_interval) {\n      clearInterval(this.esc_interval);\n      this.esc_interval = null;\n    }\n    this.setState({\n      level: 1,\n      fired: true,\n    });\n    this.callback();\n    window.setTimeout(() => {\n      this.setState({\n        level: 0,\n        fired: false,\n      });\n    }, 300);\n  }\n\n  componentDidMount() {\n    if (window.config.pressure) {\n      Pressure.set(\n        document.body,\n        {\n          change: (force) => {\n            if (!this.state.fired) {\n              if (force >= 0.999) {\n                this.do_fire();\n              } else\n                this.setState({\n                  level: force,\n                });\n            }\n          },\n          end: () => {\n            this.setState({\n              level: 0,\n              fired: false,\n            });\n          },\n        },\n        {\n          polyfill: false,\n          only: 'touch',\n          preventSelect: false,\n        },\n      );\n\n      document.addEventListener('keydown', (e) => {\n        if (!e.repeat && e.key === 'Escape') {\n          if (this.esc_interval) clearInterval(this.esc_interval);\n          this.setState(\n            {\n              level: THRESHOLD / 2,\n            },\n            () => {\n              this.esc_interval = setInterval(() => {\n                let new_level = this.state.level + 0.1;\n                if (new_level >= 0.999) this.do_fire();\n                else\n                  this.setState({\n                    level: new_level,\n                  });\n              }, 30);\n            },\n          );\n        }\n      });\n      document.addEventListener('keyup', (e) => {\n        if (e.key === 'Escape') {\n          if (this.esc_interval) {\n            clearInterval(this.esc_interval);\n            this.esc_interval = null;\n          }\n          this.setState({\n            level: 0,\n          });\n        }\n      });\n    }\n  }\n\n  render() {\n    const pad = MULTIPLIER * (this.state.level - THRESHOLD) - BORDER_WIDTH;\n    return (\n      <div\n        className={\n          'pressure-box' +\n          (this.state.fired ? ' pressure-box-fired' : '') +\n          (this.state.level <= 0.0001 ? ' pressure-box-empty' : '')\n        }\n        style={{\n          left: pad,\n          right: pad,\n          top: pad,\n          bottom: pad,\n        }}\n      />\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport { Flow } from './Flows';\nimport { Title } from './Title';\nimport { Sidebar } from './Sidebar';\nimport { PressureHelper } from './PressureHelper';\nimport { TokenCtx } from './UserAction';\nimport { load_config, bgimg_style } from './Config';\nimport { load_attentions } from './Attention.js';\nimport { listen_darkmode } from './infrastructure/functions';\nimport { LoginPopup, TitleLine } from './infrastructure/widgets';\n\nconst MAX_SIDEBAR_STACK_SIZE = 10;\n\nfunction DeprecatedAlert(props) {\n  return <div id=\"global-hint-container\" style={{ display: 'none' }} />;\n}\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    load_config();\n    load_attentions();\n    window.AS_BACKUP = localStorage['DEFAULT_ALLOW_SEARCH'] ? true : false;\n    listen_darkmode(\n      { default: undefined, light: false, dark: true }[\n        window.config.color_scheme\n      ],\n    );\n    this.state = {\n      sidebar_stack: [[null, null]], // list of [status, content]\n      mode: 'list', // list, single, search, attention\n      search_text: null,\n      flow_render_key: +new Date(),\n      token: localStorage['TOKEN'] || null,\n    };\n    this.show_sidebar_bound = this.show_sidebar.bind(this);\n    this.set_mode_bound = this.set_mode.bind(this);\n    this.on_pressure_bound = this.on_pressure.bind(this);\n  }\n\n  static is_darkmode() {\n    if (window.config.color_scheme === 'dark') return true;\n    if (window.config.color_scheme === 'light') return false;\n    else {\n      // 'default'\n      return window.matchMedia('(prefers-color-scheme: dark)').matches;\n    }\n  }\n\n  on_pressure() {\n    if (this.state.sidebar_stack.length > 1)\n      this.show_sidebar(null, null, 'clear');\n    else this.set_mode('list', null);\n  }\n\n  show_sidebar(title, content, mode = 'push') {\n    this.setState((prevState) => {\n      let ns = prevState.sidebar_stack.slice();\n      if (mode === 'push') {\n        if (ns.length === 1) {\n          document.body.style.top = `-${window.scrollY}px`;\n          document.body.style.position = 'fixed';\n          document.body.style.width = '100vw'; // Be responsive with fixed position\n        }\n        if (ns.length > MAX_SIDEBAR_STACK_SIZE) ns.splice(1, 1);\n        ns = ns.concat([[title, content]]);\n      } else if (mode === 'pop') {\n        if (ns.length === 1) return;\n        if (ns.length === 2) {\n          const scrollY = document.body.style.top;\n          document.body.style.position = '';\n          document.body.style.top = '';\n          document.body.style.width = '';\n          window.scrollTo(0, parseInt(scrollY || '0') * -1);\n        }\n        ns.pop();\n      } else if (mode === 'replace') {\n        ns.pop();\n        ns = ns.concat([[title, content]]);\n      } else if (mode === 'clear') {\n        const scrollY = document.body.style.top;\n        document.body.style.position = '';\n        document.body.style.top = '';\n        document.body.style.width = '';\n        window.scrollTo(0, parseInt(scrollY || '0') * -1);\n        ns = [[null, null]];\n      } else throw new Error('bad show_sidebar mode');\n      return {\n        sidebar_stack: ns,\n      };\n    });\n  }\n\n  set_mode(mode, search_text) {\n    this.setState({\n      mode: mode,\n      search_text: search_text,\n      flow_render_key: +new Date(),\n    });\n  }\n\n  componentDidMount() {\n    if (\n      window.location.protocol === 'http:' &&\n      window.location.hostname !== '127.0.0.1' &&\n      !window.location.hostname.endsWith('localhost')\n    ) {\n      window.location.protocol = 'https:'; // 因为CDN的原因先在前端做下https跳转\n      return;\n    }\n    let arg = window.location.search;\n    console.log(arg);\n    if (arg.startsWith('?token=')) {\n      let token = arg.substr(7);\n      if (token.endsWith(encodeURI('_任意自定义后缀'))) {\n        let tmp_token_suf =\n          localStorage['TOKEN_SUF'] ||\n          prompt('设置一个你专属的临时token后缀吧') ||\n          Math.random();\n        localStorage['TOKEN_SUF'] = tmp_token_suf;\n        token = `${token.split('_')[0]}_${tmp_token_suf}`;\n      }\n      localStorage['TOKEN'] = token;\n      window.location.search = '';\n    }\n  }\n\n  render() {\n    return (\n      <TokenCtx.Provider\n        value={{\n          value: this.state.token,\n          set_value: (x) => {\n            localStorage['TOKEN'] = x || '';\n            this.setState({\n              token: x,\n            });\n          },\n        }}\n      >\n        <PressureHelper callback={this.on_pressure_bound} />\n        <div className=\"bg-img\" style={bgimg_style()} />\n        <Title\n          show_sidebar={this.show_sidebar_bound}\n          set_mode={this.set_mode_bound}\n          mode={this.state.mode}\n        />\n        <TokenCtx.Consumer>\n          {(token) => (\n            <div className=\"left-container\">\n              <DeprecatedAlert token={token.value} />\n              {!token.value && (\n                <div className=\"flow-item-row aux-margin\">\n                  <div className=\"box box-tip\">\n                    <LoginPopup token_callback={token.set_value}>\n                      {(do_popup) => (\n                        <a onClick={do_popup}>\n                          <span className=\"icon icon-login\" />\n                          &nbsp;登录到 新T树洞\n                        </a>\n                      )}\n                    </LoginPopup>\n                  </div>\n                </div>\n              )}\n              {token.value ? (\n                <Flow\n                  key={this.state.flow_render_key}\n                  show_sidebar={this.show_sidebar_bound}\n                  mode={this.state.mode}\n                  search_text={this.state.search_text}\n                  token={token.value}\n                />\n              ) : (\n                <TitleLine text=\"请登录后查看内容\" />\n              )}\n              <br />\n            </div>\n          )}\n        </TokenCtx.Consumer>\n        <Sidebar\n          show_sidebar={this.show_sidebar_bound}\n          stack={this.state.sidebar_stack}\n        />\n      </TokenCtx.Provider>\n    );\n  }\n}\n\nexport default App;\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    // const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    // if (publicUrl.origin !== window.location.origin) {\n    // Our service worker won't work if PUBLIC_URL is on a different origin\n    // from what our page is served on. This might happen if a CDN is used to\n    // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n    // return;\n    // }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ',\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.',\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport './fonts_7/icomoon.css';\nimport App from './App';\n//import {elevate} from './infrastructure/elevator';\nimport registerServiceWorker from './registerServiceWorker';\n\n//elevate();\n\nReactDOM.render(<App />, document.getElementById('root'));\nregisterServiceWorker();\n"],"sourceRoot":""}