(this.webpackJsonpwebhole=this.webpackJsonpwebhole||[]).push([[0],{130:function(e,t){},149:function(e,t,n){},150:function(e,t,n){},428:function(e,t,n){},430:function(e,t,n){},437:function(e,t,n){},438:function(e,t,n){},439:function(e,t,n){},440:function(e,t,n){},441:function(e,t,n){},442:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(42),s=n.n(r),i=(n(86),n(87),n(1)),c=n(2),l=n(3),u=n(5),d=n(4),h=n(29),p=n(12),m=n(26),_=n(9),f=n(6),b=n.n(f),g=n(8),v=n(27),w=n.n(v),k=function(){function e(){Object(i.a)(this,e),this.names={},this.current_h=Math.random()}return Object(c.a)(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e=e.toLowerCase(),t?["hsl(0, 0%, 86%)","hsl(0, 0%, 25%)"]:"\u6d1e\u4e3b"===e?["hsl(0, 0%, 97%)","hsl(0, 0%, 16%)"]:(this.names[e]||(this.current_h+=.618033988749895,this.current_h%=1,this.names[e]=["hsl(".concat(360*this.current_h,", 50%, 90%)"),"hsl(".concat(360*this.current_h,", 60%, 20%)")]),this.names[e])}}]),e}(),E=/(^|[^\d\u20e3\ufe0e\ufe0f])(#\d{1,7})(?![\d\u20e3\ufe0e\ufe0f])/g,y=/((?:https?:\/\/)?hole\.thu\.monster\/?#(?:#|%23)(\d{1,7}))(?!\d|\u20e3|\ufe0e|\ufe0f)/g,x=/(^|[^A-Za-z])((?:(?:Angry|Baby|Crazy|Diligent|Excited|Fat|Greedy|Hungry|Interesting|Jolly|Kind|Little|Magic|Na\xefve|Old|PKU|Quiet|Rich|Superman|Tough|Undefined|Valuable|Wifeless|Xiangbuchulai|Young|Zombie)\s)?(?:Alice|Bob|Carol|Dave|Eve|Francis|Grace|Hans|Isabella|Jason|Kate|Louis|Margaret|Nathan|Olivia|Paul|Queen|Richard|Susan|Thomas|Uma|Vivian|Winnie|Xander|Yasmine|Zach)|You Win(?: \d+)?|\u6d1e\u4e3b)(?![A-Za-z])/gi,O=/(^|[^.@a-zA-Z0-9_])((?:https?:\/\/)?(?:(?:[\w-]+\.)+[a-zA-Z]{2,7}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,5})(?::\d{1,5})?(?:\/[\w~!@#$%^&*()\-_=+[\]{};:,./?|]*)?)(?![a-zA-Z0-9])/gi,N=/(^|\s)(#[^#\s]{1,32})($|\s|#)/g;function j(e,t){return e=[[null,e]],t.forEach((function(t){var n=Object(p.a)(t,2),a=n[0],o=n[1];e=[].concat.apply([],e.map((function(e){var t=Object(p.a)(e,2),n=t[0],r=t[1];return n?[e]:r.split(o).map((function(e){return o.test(e)?[a,e]:[null,e]})).filter((function(e){var t=Object(p.a)(e,2),n=t[0],a=t[1];return null!==n||a}))})))})),e}var S=n(74),C=n.n(S),T=n(75),P=n.n(T),L=n(76),U=n.n(L);n(92),n(93);function I(e){return e.ok?e.text().then((function(e){try{return JSON.parse(e)}catch(t){throw console.error("json parse error"),console.trace(t),console.log(e),new SyntaxError("JSON Parse Error "+e.substr(0,50))}})):e.text().then((function(t){throw console.log("error:",e),t=t.length<100?t:"",Error("".concat(e.status," ").concat(e.statusText," ").concat(t))}))}var A=["Alice","Bob","Carol","Dave","Eve","Francis","Grace","Hans","Isabella","Jason","Kate","Louis","Margaret","Nathan","Olivia","Paul","Queen","Richard","Susan","Thomas","Uma","Vivian","Winnie","Xander","Yasmine","Zach"];function D(e){return e<10?"0"+e:""+e}function R(e){return"".concat(e.getMonth()+1,"-").concat(D(e.getDate())," ").concat(e.getHours(),":").concat(D(e.getMinutes()),":").concat(D(e.getSeconds()))}var K=U()(P.a);function M(e){var t=new Date(1e3*e.stamp);return o.a.createElement("span",{className:"time-str"},o.a.createElement(C.a,{date:t,formatter:K,title:t.toLocaleString("zh-CN",{timeZone:"Asia/Shanghai",hour12:!1})}),"\xa0",e.short?null:R(t))}function B(e){return o.a.createElement("p",{className:"centered-line title-line aux-margin"},o.a.createElement("span",{className:"black-outline"},e.text))}var W,F=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={loading_status:"idle"},a.input_token_ref=o.a.createRef(),a}return Object(c.a)(n,[{key:"setThuhole",value:function(e,t,n){console.log(t),e.preventDefault(),t.href="/_login?p=thuhole&token="+n.current.value,console.log(t),alert("T\u5927\u6811\u6d1e\u5df2\u7ecf\u6ca1\u6709\u5566\ud83d\ude2d")}},{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("div",{className:"thuhole-login-popup-shadow"}),o.a.createElement("div",{className:"thuhole-login-popup"},o.a.createElement("p",null,o.a.createElement("b",null,"\u901a\u8fc7\u7b2c\u4e09\u65b9\u9a8c\u8bc1\u767b\u9646\u65b0T\u6811\u6d1e")),o.a.createElement("p",null,o.a.createElement("a",{href:"https://api.t-hole.red/_login?p=cs",target:"_blank",referrerPolicy:"origin"},o.a.createElement("span",{className:"icon icon-login"}),"\xa0\u95ed\u793e")),o.a.createElement("p",null,o.a.createElement("input",{ref:this.input_token_ref,placeholder:"T\u5927\u6811\u6d1eToken"}),o.a.createElement("br",null),o.a.createElement("a",{href:"/_login?p=thuhole",target:"_blank",onClick:function(t){e.setThuhole(t,t.target,e.input_token_ref)}},o.a.createElement("span",{className:"icon icon-login"}),"\xa0T\u5927\u6811\u6d1e")),o.a.createElement("p",null,o.a.createElement("small",null,"\u524d\u5f80Telegram\u7fa4\u67e5\u8be215\u5206\u949f\u4e34\u65f6token"),o.a.createElement("br",null),o.a.createElement("a",{href:"//t.me/THUChatBot",target:"_blank"},o.a.createElement("span",{className:"icon icon-login"}),"\xa0\u6e05\u534e\u5927\u6c34\u7fa4")),o.a.createElement("p",null,o.a.createElement("button",{type:"button",disabled:!0},o.a.createElement("span",{className:"icon icon-login"}),"\xa0\u672a\u540dbbs")),o.a.createElement("p",null,o.a.createElement("button",{type:"button",disabled:!0},o.a.createElement("span",{className:"icon icon-login"}),"\xa0\u6e05\u534e\u7edf\u4e00\u8eab\u4efd\u8ba4\u8bc1")),o.a.createElement("hr",null),o.a.createElement("p",null,o.a.createElement("button",{onClick:this.props.on_close},"\u53d6\u6d88")),o.a.createElement("hr",null),o.a.createElement("div",{className:"thuhole-login-popup-info"},o.a.createElement("p",null,"\u63d0\u9192:"),o.a.createElement("ul",null,o.a.createElement("li",null," ","\u65e0\u8bba\u91c7\u7528\u54ea\u79cd\u65b9\u5f0f\u6ce8\u518c\uff0c\u4f60\u540e\u53f0\u8bb0\u5f55\u7684\u7528\u6237\u540d\u90fd\u662f\u672c\u8d28\u5b9e\u540d\u7684\uff08\u9664\u4e34\u65f6token\uff09\uff0c\u56e0\u4e3a\u95ed\u793e/T\u5927\u6811\u6d1e\u7684\u7ba1\u7406\u5458\u53ef\u4ee5\u6839\u636e\u4f60\u7684\u95ed\u793eid/\u6811\u6d1e\u8bc4\u8bba\u533a\u4ee3\u53f7\u67e5\u5230\u90ae\u7bb1\u3002\u4f46\u662f\u8fd9\u4e0d\u5f71\u54cd\u65b0T\u6811\u6d1e\u7684\u5b89\u5168\u6027\u3002\u65b0T\u6811\u6d1e\u7684\u533f\u540d\u6027\u6765\u81ea\u9694\u79bb\u7528\u6237\u540d\u4e0e\u53d1\u5e03\u7684\u5185\u5bb9\uff0c\u800c\u975e\u8bd5\u56fe\u9694\u79bb\u7528\u6237\u540d\u4e0e\u771f\u5b9e\u8eab\u4efd\u3002"),o.a.createElement("li",null," ","\u7531\u4e8eT\u5927\u6811\u6d1e\u4ecd\u672a\u63d0\u4f9b\u6388\u6743\u63a5\u53e3\uff0c\u4f7f\u7528T\u5927\u6811\u6d1e\u65b9\u5f0f\u767b\u9646\u9700\u8981\u7528\u4f60\u7684token\u5728\u7279\u5b9a\u6d1e\u53d1\u5e03\u4e00\u6bb5\u968f\u673a\u5185\u5bb9\u4ee5\u786e\u5b9a\u8eab\u4efd\u3002\u8fd9\u662f\u5426\u8fdd\u53cd\u7528\u6237\u6761\u4f8b\u7531T\u5927\u6811\u6d1e\u7ba1\u7406\u5458\u51b3\u5b9a\uff0c\u9700\u81ea\u884c\u627f\u62c5\u76f8\u5173\u98ce\u9669\u3002\u5b8c\u6210\u767b\u9646\u540e\u5efa\u8bae\u7acb\u5373\u91cd\u7f6eT\u5927\u6811\u6d1etoken\u3002"," "),o.a.createElement("li",null," \u76ee\u524d\u4e00\u4e2a\u4eba\u53ef\u80fd\u6709\u4e24\u4e2a\u5e10\u53f7\u3002")))))}}]),n}(a.Component),q=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={popup_show:!1},a.on_popup_bound=a.on_popup.bind(Object(l.a)(a)),a.on_close_bound=a.on_close.bind(Object(l.a)(a)),a}return Object(c.a)(n,[{key:"on_popup",value:function(){this.setState({popup_show:!0})}},{key:"on_close",value:function(){this.setState({popup_show:!1})}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,this.props.children(this.on_popup_bound),this.state.popup_show&&o.a.createElement(F,{token_callback:this.props.token_callback,on_close:this.on_close_bound}))}}]),n}(a.Component),z=n(43),H=n.n(z),J=(n(149),n(150),W={"https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/gbp.jpg":"\u6000\u65e7\u80cc\u666f\uff08\u9ed8\u8ba4\uff09","https://www.tsinghua.edu.cn/image/nav-bg.jpg":"\u6e05\u534e\u7d2b"},Object(_.a)(W,"https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/gbp.jpg","\u5bfb\u89c5\u7e41\u661f"),Object(_.a)(W,"https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/eriri.jpg","\u5e73\u6210\u8457\u540d\u753b\u5e08"),Object(_.a)(W,"https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/yurucamp.jpg","\u9732\u8425\u5929\u4e0b\u7b2c\u4e00"),Object(_.a)(W,"https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/minecraft.jpg","\u9ea6\u6069\xb7\u5e93\u62c9\u592b\u7279"),Object(_.a)(W,"https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/cyberpunk.jpg","\u8d5b\u535a\u57ce\u5e02"),Object(_.a)(W,"https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/bj.jpg","\u57ce\u5e02\u7684\u661f\u5149"),Object(_.a)(W,"https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/sif.jpg","\u68a6\u5f00\u59cb\u7684\u5730\u65b9"),W),Z={background_img:"//cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/gbp.jpg",background_color:"#113366",pressure:!1,easter_egg:!0,color_scheme:"default",block_tmp:!0,block_cw:["xxg","zzxg"],block_words_v4:["\ud83d\udd77\ufe0f","[\u7cfb\u7edf\u81ea\u52a8\u4ee3\u53d1]"],whitelist_cw:[],ipfs_gateway_list:["https://<hash>.ipfs.dweb.link/","https://<hash>.ipfs.infura-ipfs.io/","https://gateway.pinata.cloud/ipfs/<hash>","https://ipfs.eth.aragon.network/ipfs/<hash>","https://gateway.ipfs.io/ipfs/<hash>","https://ipfs.fleek.co/ipfs/<hash>","https://cloudflare-ipfs.com/ipfs/<hash>","https://ipfs.2read.net/ipfs/<hash>"]};function Y(){var e,t=Object.assign({},Z);try{e=JSON.parse(localStorage.hole_config||"{}")}catch(n){alert("\u8bbe\u7f6e\u52a0\u8f7d\u5931\u8d25\uff0c\u5c06\u91cd\u7f6e\u4e3a\u9ed8\u8ba4\u8bbe\u7f6e\uff01\n"+n),delete localStorage.hole_config,e={}}Object.keys(e).forEach((function(n){void 0!==t[n]&&(t[n]=e[n])})),e.block_words_v3&&(t.block_words_v4=e.block_words_v3.concat(t.block_words_v4)),console.log("config loaded",t),window.config=t}function X(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];localStorage.hole_config=JSON.stringify(window.config),e&&Y()}function V(e,t){return void 0===e&&(e=window.config.background_img),void 0===t&&(t=window.config.background_color),{background:"transparent center center",backgroundImage:null===e?"unset":'url("'+encodeURI(e)+'")',backgroundColor:t,backgroundSize:"cover"}}var $=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={img:window.config.background_img,color:window.config.background_color},a}return Object(c.a)(n,[{key:"save_changes",value:function(){this.props.callback({background_img:this.state.img,background_color:this.state.color})}},{key:"on_select",value:function(e){var t=e.target.value;this.setState({img:"##other"===t?"":"##color"===t?null:t},this.save_changes.bind(this))}},{key:"on_change_img",value:function(e){this.setState({img:e.target.value},this.save_changes.bind(this))}},{key:"on_change_color",value:function(e){this.setState({color:e.target.value},this.save_changes.bind(this))}},{key:"render",value:function(){var e=null===this.state.img?"##color":-1===Object.keys(J).indexOf(this.state.img)?"##other":this.state.img;return o.a.createElement("div",null,o.a.createElement("p",null,o.a.createElement("b",null,"\u80cc\u666f\u56fe\u7247\uff1a"),o.a.createElement("select",{className:"config-select",value:e,onChange:this.on_select.bind(this)},Object.keys(J).map((function(e){return o.a.createElement("option",{key:e,value:e},J[e])})),o.a.createElement("option",{value:"##other"},"\u8f93\u5165\u56fe\u7247\u7f51\u5740\u2026\u2026"),o.a.createElement("option",{value:"##color"},"\u7eaf\u8272\u80cc\u666f\u2026\u2026")),"\xa0",o.a.createElement("small",null,"#background_img"),"\xa0","##other"===e&&o.a.createElement("input",{type:"url",placeholder:"\u56fe\u7247\u7f51\u5740",value:this.state.img,onChange:this.on_change_img.bind(this)}),"##color"===e&&o.a.createElement("input",{type:"color",value:this.state.color,onChange:this.on_change_color.bind(this)})),o.a.createElement("div",{className:"bg-preview",style:V(this.state.img,this.state.color)}))}}]),n}(a.PureComponent),G=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={color_scheme:window.config.color_scheme},a}return Object(c.a)(n,[{key:"save_changes",value:function(){this.props.callback({color_scheme:this.state.color_scheme})}},{key:"on_select",value:function(e){var t=e.target.value;this.setState({color_scheme:t},this.save_changes.bind(this))}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("p",null,o.a.createElement("b",null,"\u591c\u95f4\u6a21\u5f0f\uff1a"),o.a.createElement("select",{className:"config-select",value:this.state.color_scheme,onChange:this.on_select.bind(this)},o.a.createElement("option",{value:"default"},"\u8ddf\u968f\u7cfb\u7edf"),o.a.createElement("option",{value:"light"},"\u59cb\u7ec8\u6d45\u8272\u6a21\u5f0f"),o.a.createElement("option",{value:"dark"},"\u59cb\u7ec8\u6df1\u8272\u6a21\u5f0f")),"\xa0",o.a.createElement("small",null,"#color_scheme")),o.a.createElement("p",{className:"config-description"},"\u9009\u62e9\u6d45\u8272\u6216\u6df1\u8272\u6a21\u5f0f\uff0c\u6df1\u8272\u6a21\u5f0f\u4e0b\u5c06\u4f1a\u8c03\u6697\u56fe\u7247\u4eae\u5ea6"))}}]),n}(a.PureComponent),Q=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state=Object(_.a)({},e.id,window.config[e.id]),a}return Object(c.a)(n,[{key:"save_changes",value:function(){this.props.callback(Object(_.a)({},this.props.id,this.props.sift(this.state[this.props.id])))}},{key:"on_change",value:function(e){var t=this.props.parse(e.target.value);this.setState(Object(_.a)({},this.props.id,t),this.save_changes.bind(this))}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("label",null,o.a.createElement("p",null,o.a.createElement("b",null,this.props.name),"\xa0",o.a.createElement("small",null,"#",this.props.id)),o.a.createElement("p",{className:"config-description"},this.props.description),o.a.createElement("textarea",{name:"config-"+this.props.id,id:"config-textarea-".concat(this.props.id),className:"config-textarea",value:this.props.display(this.state[this.props.id]),onChange:this.on_change.bind(this)})))}}]),n}(a.PureComponent),ee=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={switch:window.config[a.props.id]},a}return Object(c.a)(n,[{key:"on_change",value:function(e){var t=this,n=e.target.checked;this.setState({switch:n},(function(){t.props.callback(Object(_.a)({},t.props.id,n))}))}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("p",null,o.a.createElement("label",null,o.a.createElement("input",{name:"config-"+this.props.id,type:"checkbox",checked:this.state.switch,onChange:this.on_change.bind(this)}),"\xa0",o.a.createElement("b",null,this.props.name),"\xa0",o.a.createElement("small",null,"#",this.props.id))),o.a.createElement("p",{className:"config-description"},this.props.description))}}]),n}(a.PureComponent),te=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).save_changes_bound=a.save_changes.bind(Object(l.a)(a)),a}return Object(c.a)(n,[{key:"save_changes",value:function(e){console.log(e),Object.keys(e).forEach((function(t){window.config[t]=e[t]})),X(!1)}},{key:"reset_settings",value:function(){window.confirm("\u91cd\u7f6e\u6240\u6709\u8bbe\u7f6e\uff1f")&&(window.config={},X(),window.location.reload())}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("div",{className:"box config-ui-header"},o.a.createElement("p",null,"\u8fd9\u4e9b\u529f\u80fd\u4ecd\u5728\u6d4b\u8bd5\uff0c\u53ef\u80fd\u4e0d\u7a33\u5b9a\uff08",o.a.createElement("a",{onClick:this.reset_settings.bind(this)},"\u5168\u90e8\u91cd\u7f6e"),"\uff09"),o.a.createElement("p",null,o.a.createElement("b",null,"\u90e8\u5206\u8bbe\u7f6e\u4fee\u6539\u540e\u9700\u8981"," ",o.a.createElement("a",{onClick:function(){window.location.reload()}},"\u5237\u65b0\u9875\u9762")," ","\u65b9\u53ef\u751f\u6548"))),o.a.createElement("div",{className:"box"},o.a.createElement($,{id:"background",callback:this.save_changes_bound}),o.a.createElement("hr",null),o.a.createElement(G,{id:"color-scheme",callback:this.save_changes_bound}),o.a.createElement("hr",null),o.a.createElement(ee,{callback:this.save_changes_bound,id:"block_tmp",name:"\u5c4f\u853d\u4e34\u65f6\u5e10\u53f7",description:"\u5c4f\u853d\u6240\u6709\u4e34\u65f6\u5e10\u53f7\u7684\u53d1\u8a00"}),o.a.createElement("hr",null),o.a.createElement(Q,{id:"block_cw",callback:this.save_changes_bound,name:"\u8bbe\u7f6e\u5c4f\u853d\u7684\u6298\u53e0\u8b66\u544a",description:"\u6298\u53e0\u8b66\u544a\u5305\u542b\u5c4f\u853d\u8bcd\u7684\u6811\u6d1e\u4f1a\u4e0d\u663e\u793a\u800c\u975e\u6298\u53e0\uff0c\u6bcf\u884c\u4e00\u4e2a\u5c4f\u853d\u8bcd",display:function(e){return e.join("\n")},sift:function(e){return e.filter((function(e){return e}))},parse:function(e){return e.split("\n")}}),o.a.createElement("hr",null),o.a.createElement(Q,{id:"block_words_v4",callback:this.save_changes_bound,name:"\u8bbe\u7f6e\u5c4f\u853d\u8bcd",description:"\u5305\u542b\u5c4f\u853d\u8bcd\u7684\u6811\u6d1e\u4f1a\u4e0d\u88ab\u663e\u793a\uff0c\u6bcf\u884c\u4e00\u4e2a\u5c4f\u853d\u8bcd",display:function(e){return e.join("\n")},sift:function(e){return e.filter((function(e){return e}))},parse:function(e){return e.split("\n")}}),o.a.createElement("hr",null),o.a.createElement(Q,{id:"whitelist_cw",callback:this.save_changes_bound,name:"\u5c55\u5f00\u6307\u5b9a\u7684\u6298\u53e0\u8b66\u544a",description:'\u5b8c\u5168\u5339\u914d\u7684\u6811\u6d1e\u4e0d\u4f1a\u88ab\u6298\u53e0\uff0c\u6bcf\u884c\u4e00\u4e2a\u8c41\u514d\u8bcd\uff0c\u4e5f\u53ef\u4f7f\u7528\u4e00\u4e2a\u661f\u53f7("*")\u8868\u793a\u8c41\u514d\u6240\u6709',display:function(e){return e.join("\n")},sift:function(e){return e.filter((function(e){return e}))},parse:function(e){return e.split("\n")}}),o.a.createElement("hr",null),o.a.createElement(Q,{id:"ipfs_gateway_list",callback:this.save_changes_bound,name:"\u5019\u9009ipfs\u7f51\u5173",description:"<hash>\u8868\u793a\u8981\u66ff\u6362\u7684\u54c8\u5e0c\u503c\u3002\u4e0b\u6b21\u4e0a\u4f20\u6587\u4ef6\u4f1a\u4f7f\u7528\u7b2c\u4e00\u884c\u7684\uff0c\u4e0a\u4f20\u540e\u6839\u636e\u901f\u5ea6\u8c03\u6574\u3002",display:function(e){return e.join("\n")},sift:function(e){return e.filter((function(e){return e}))},parse:function(e){return e.split("\n")}}),o.a.createElement("hr",null),o.a.createElement(ee,{callback:this.save_changes_bound,id:"pressure",name:"\u5feb\u901f\u8fd4\u56de",description:"\u77ed\u6682\u6309\u4f4f Esc \u952e\u6216\u91cd\u538b\u5c4f\u5e55\uff083D Touch\uff09\u53ef\u4ee5\u5feb\u901f\u8fd4\u56de\u6216\u8005\u5237\u65b0\u6811\u6d1e"}),o.a.createElement("hr",null),o.a.createElement(ee,{callback:this.save_changes_bound,id:"easter_egg",name:"\u5141\u8bb8\u5f69\u86cb",description:"\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u663e\u793a\u5f69\u86cb"}),o.a.createElement("hr",null),o.a.createElement("p",null,"\u65b0\u529f\u80fd\u5efa\u8bae\u6216\u95ee\u9898\u53cd\u9988\u8bf7\u5728\xa0",o.a.createElement("a",{href:"https://git.thu.monster/newthuhole/hole-backend-rust/issues",target:"_blank"},"Gitea"),"\xa0\u63d0\u51fa\u3002")))}}]),n}(a.PureComponent),ne=n(77),ae=n.n(ne),oe=n(78),re=n.n(oe),se=n(44),ie=n.n(se),ce=(n(427),n(428),n(429),new ae.a({html:!1,linkify:!1,breaks:!0,inline:!0,highlight:function(e,t){if(t&&ie.a.getLanguage(t))try{return'<pre class="hljs"><code>'+ie.a.highlight(t,e,!0).value+"</code></pre>"}catch(n){}return'<pre class="hljs"><code>'+ce.utils.escapeHtml(e)+"</code></pre>"}}).use(re.a,{throwOnError:!1,errorColor:"#aa0000"})),le="".concat("https://api.t-hole.red/","_api/v1");function ue(e){return o.a.createElement("span",{className:"colored-span",style:{"--coloredspan-bgcolor-light":e.colors[0],"--coloredspan-bgcolor-dark":e.colors[1]}},e.children)}function de(e){return/^https?:\/\//.test(e)?e:"http://"+e}function he(e){e.target.parentNode.classList.remove("loading")}var pe=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){var e,t=this.props,n=[{shouldProcessNode:function(e){return/^h[123456]$/.test(e.name)},processNode:function(e,t,n){var a=+e.name[1];a<3&&(a=3);var r="h".concat(a);return o.a.createElement(r,{key:n},t)}},{shouldProcessNode:function(e){return"img"===e.name},processNode:function(e,t){return o.a.createElement("span",{className:"ext-img__warpper loading"},o.a.createElement("img",{src:de(e.attribs.src),alt:e.alt,className:"ext-img",referrerPolicy:"no-referrer",onError:he,onLoad:he}))}},{shouldProcessNode:function(e){return"a"===e.name},processNode:function(e,t,n){return o.a.createElement("a",{href:de(e.attribs.href),target:"_blank",rel:"noopenner noreferrer",className:"ext-link",key:n},t,o.a.createElement("span",{className:"icon icon-new-tab"}))}},{shouldProcessNode:function(e){return"text"===e.type&&(!e.parent||!e.parent.attribs||"application/x-tex"!==e.parent.attribs.encoding)},processNode:function(e,n,a){var r=e.data,s=[["url_pid",y],["url",O],["pid",E],["nickname",x],["tag",N]];if(t.search_param){var i=t.search_param.split(" ").filter((function(e){return!!e}));s.push(["search",new RegExp("(".concat(i.map((function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})).join("|"),")"),"g")])}var c=j(r,s);return o.a.createElement(o.a.Fragment,{key:a},c.map((function(e,n){var a=Object(p.a)(e,2),r=a[0],s=a[1];return o.a.createElement("span",{key:n},"url_pid"===r?o.a.createElement("span",{className:"url-pid-link",title:s},"/##"):"url"===r?o.a.createElement(o.a.Fragment,null,o.a.createElement("a",{href:de(s),className:"ext-link",target:"_blank",rel:"noopener noreferrer"},s,o.a.createElement("span",{className:"icon icon-new-tab"})),function(e){try{var t=new URL(e);return t.pathname.endsWith(".mp4")||t.pathname.endsWith(".mov")||(t.searchParams.get("filetype")||"").startsWith("video/")}catch(n){return!1}}(s)&&o.a.createElement("video",{className:"ext-video",src:s,controls:!0}),function(e){try{var t=new URL(e);return t.pathname.endsWith(".mp3")||(t.searchParams.get("filetype")||"").startsWith("audio/")}catch(n){return!1}}(s)&&o.a.createElement("audio",{className:"ext-audio",src:s,controls:!0})):"pid"===r?o.a.createElement("a",{href:"#"+s,onClick:function(e){e.preventDefault(),t.show_pid(s.substring(1))}},s):"nickname"===r?o.a.createElement(ue,{colors:t.color_picker.get(s)},s):"search"===r?o.a.createElement("span",{className:"search-query-highlight"},s):"tag"===r?o.a.createElement("a",{href:s},s):s)})))}},{shouldProcessNode:function(){return!0},processNode:new H.a.ProcessNodeDefinitions(o.a).processDefaultNode}],a=new H.a.Parser,r=t.text,s=(e=r,ce.render(e));return a.parseWithInstructions(s,(function(e){return"script"!==e.type}),n)||null}}]),n}(a.Component);window.TEXTAREA_BACKUP={};var me=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={text:""},a.on_change_bound=a.on_change.bind(Object(l.a)(a)),a.on_keydown_bound=a.on_keydown.bind(Object(l.a)(a)),a.clear=a.clear.bind(Object(l.a)(a)),a.area_ref=o.a.createRef(),a.change_callback=e.on_change||function(){},a.submit_callback=e.on_submit||function(){},a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.setState({text:window.TEXTAREA_BACKUP[this.props.id]||""},(function(){e.change_callback(e.state.text)}))}},{key:"componentWillUnmount",value:function(){window.TEXTAREA_BACKUP[this.props.id]=this.state.text,this.change_callback(this.state.text)}},{key:"on_change",value:function(e){this.setState({text:e.target.value}),this.change_callback(e.target.value)}},{key:"on_keydown",value:function(e){"Enter"===e.key&&e.ctrlKey&&!e.altKey&&(e.preventDefault(),this.submit_callback())}},{key:"clear",value:function(){this.setState({text:""})}},{key:"set",value:function(e){this.change_callback(e),this.setState({text:e})}},{key:"get",value:function(){return this.state.text}},{key:"focus",value:function(){this.area_ref.current.focus()}},{key:"render",value:function(){return o.a.createElement("textarea",{ref:this.area_ref,onChange:this.on_change_bound,value:this.state.text,onKeyDown:this.on_keydown_bound,maxLength:"4096"})}}]),n}(a.Component),_e=null;function fe(e){var t=/iPhone|iPad|iPod/i.test(window.navigator.userAgent);return window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone?null:t?navigator.standalone?null:o.a.createElement("div",{className:"box promotion-bar"},o.a.createElement("span",{className:"icon icon-about"}),"\xa0 \u7528 Safari \u628a\u6811\u6d1e ",o.a.createElement("b",null,"\u6dfb\u52a0\u5230\u4e3b\u5c4f\u5e55")," \u66f4\u597d\u7528"):_e?o.a.createElement("div",{className:"box promotion-bar"},o.a.createElement("span",{className:"icon icon-about"}),"\xa0 \u628a\u7f51\u9875\u7248\u6811\u6d1e"," ",o.a.createElement("b",null,o.a.createElement("a",{onClick:function(){_e&&_e.prompt()}},"\u5b89\u88c5\u5230\u684c\u9762"))," ","\u66f4\u597d\u7528"):null}window.addEventListener("beforeinstallprompt",(function(e){console.log("pwa: received before install prompt"),_e=e}));var be=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={moved:!0,init_y:0,init_x:0},a.on_begin_bound=a.on_begin.bind(Object(l.a)(a)),a.on_move_bound=a.on_move.bind(Object(l.a)(a)),a.on_end_bound=a.on_end.bind(Object(l.a)(a)),a.MOVE_THRESHOLD=3,a.last_fire=0,a}return Object(c.a)(n,[{key:"on_begin",value:function(e){this.setState({moved:!1,init_y:(e.touches?e.touches[0]:e).screenY,init_x:(e.touches?e.touches[0]:e).screenX})}},{key:"on_move",value:function(e){this.state.moved||Math.abs((e.touches?e.touches[0]:e).screenY-this.state.init_y)+Math.abs((e.touches?e.touches[0]:e).screenX-this.state.init_x)>this.MOVE_THRESHOLD&&this.setState({moved:!0})}},{key:"on_end",value:function(e){this.state.moved||this.do_callback(e),this.setState({moved:!0})}},{key:"do_callback",value:function(e){this.last_fire+100>+new Date||(this.last_fire=+new Date,this.props.callback(e))}},{key:"render",value:function(){return o.a.createElement("div",{onTouchStart:this.on_begin_bound,onMouseDown:this.on_begin_bound,onTouchMove:this.on_move_bound,onMouseMove:this.on_move_bound,onClick:this.on_end_bound},this.props.children)}}]),n}(a.PureComponent);n(430);var ge=n(28),ve=n.n(ge),we=(n(437),function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={loading_status:"idle",msg:[]},a.input_suf_ref=o.a.createRef(),a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){var e=this;"loading"!==this.state.loading_status&&this.setState({loading_status:"loading"},(function(){fetch(le+"/systemlog",{headers:{"User-Token":e.props.token}}).then(I).then((function(t){e.setState({loading_status:"done",msg:t.data,start_time:t.start_time,salt:t.salt,tmp_token:t.tmp_token})})).catch((function(t){console.error(t),alert(""+t),e.setState({loading_status:"failed"})}))}))}},{key:"do_set_token",value:function(){if("loading"!==this.state.loading_status)if(this.input_suf_ref.current.value){var e=this.state.tmp_token+"_"+this.input_suf_ref.current.value;console.log(e),localStorage.TOKEN=e,alert("\u5df2\u767b\u5f55\u4e3a\u4e34\u65f6\u7528\u6237\uff0c\u8fc7\u671f\u540e\u9700\u6ce8\u9500\u91cd\u65b0\u767b\u9646"),window.location.reload()}else alert("\u4e0d\u5efa\u8bae\u540e\u7f00\u4e3a\u7a7a")}},{key:"render",value:function(){var e=this;return"loading"===this.state.loading_status?o.a.createElement("p",{className:"box box-tip"},"\u52a0\u8f7d\u4e2d\u2026\u2026"):"failed"===this.state.loading_status?o.a.createElement("div",{className:"box box-tip"},o.a.createElement("a",{onClick:function(){e.load()}},"\u91cd\u65b0\u52a0\u8f7d")):"done"===this.state.loading_status?o.a.createElement(o.a.Fragment,null,o.a.createElement("br",null),o.a.createElement("p",null,"\u6700\u8fd1\u4e00\u6b21\u91cd\u7f6e ",o.a.createElement(M,{stamp:this.state.start_time,short:!1})),o.a.createElement("p",null,"\u968f\u673a\u76d0 ",o.a.createElement("b",null,this.state.salt)),o.a.createElement("br",null),o.a.createElement("div",null,o.a.createElement("p",null,"15\u5206\u949f\u4e34\u65f6token:"),o.a.createElement("div",{className:"input-prepend"},this.state.tmp_token,"_ "),o.a.createElement("input",{type:"text",className:"input-suf",ref:this.input_suf_ref,placeholder:"\u81ea\u5b9a\u4e49\u540e\u7f00",maxLength:10}),o.a.createElement("button",{type:"button",disabled:"loading"===this.state.loading_status,onClick:function(t){return e.do_set_token()}},"\u4f7f\u7528")),this.state.msg.map((function(e){return o.a.createElement("div",{className:"box",key:e.type+e.timestamp},o.a.createElement("div",{className:"box-header"},o.a.createElement(M,{stamp:e.timestamp,short:!1}),"\xa0 \xa0",o.a.createElement("b",null,e.type),"\xa0",o.a.createElement("span",{className:"box-header-name"},e.user)),o.a.createElement("div",{className:"box-content"},o.a.createElement("pre",null,e.detail)))}))):null}}]),n}(a.PureComponent)),ke=function(){function e(){var t=this;Object(i.a)(this,e),this.db=null,this.added_items_since_maintenance=0,this.encrypt=this.encrypt.bind(this),this.decrypt=this.decrypt.bind(this);var n=indexedDB.open("hole_cache_db",1);n.onerror=console.error.bind(console),n.onupgradeneeded=function(e){console.log("comment cache db upgrade"),e.target.result.createObjectStore("comment",{keyPath:"pid"}).createIndex("last_access","last_access",{unique:!1})},n.onsuccess=function(e){console.log("comment cache db loaded"),t.db=e.target.result,setTimeout(t.maintenance.bind(t),1)}}return Object(c.a)(e,[{key:"encrypt",value:function(e,t){for(var n=JSON.stringify(t),a="",o=0,r=(42^e)%128;o<n.length;o++){var s=(r^n.charCodeAt(o)/2)%128;a+=String.fromCharCode(r^n.charCodeAt(o)),r=s}return a}},{key:"decrypt",value:function(e,t){var n="";if("string"!==typeof t)return null;for(var a=0,o=(42^e)%128;a<t.length;a++){var r=o^t.charCodeAt(a);n+=String.fromCharCode(r),o=(o^r/2)%128}try{return JSON.parse(n)}catch(s){return console.error("decrypt failed"),console.trace(s),null}}},{key:"get",value:function(e,t){var n=this;return e=parseInt(e),new Promise((function(a,o){if(!n.db)return a(null);var r=n.db.transaction(["comment"],"readwrite").objectStore("comment"),s=r.get(e);s.onsuccess=function(){var o=s.result;if(o&&o.data_str)if(t===o.version){o.last_access=+new Date,r.put(o);var i=n.decrypt(e,o.data_str);a(i)}else console.log("comment cache expired",e,": ver",o.version,"target",t),r.delete(e),a(null);else a(null)},s.onerror=function(e){console.warn("comment cache indexeddb open failed"),console.error(e),a(null)}}))}},{key:"put",value:function(e,t,n){var a=this;return e=parseInt(e),new Promise((function(o,r){if(!a.db)return o();a.db.transaction(["comment"],"readwrite").objectStore("comment").put({pid:e,version:t,data_str:a.encrypt(e,n),last_access:+new Date}),150===++a.added_items_since_maintenance&&setTimeout(a.maintenance.bind(a),1)}))}},{key:"delete",value:function(e){var t=this;return e=parseInt(e),new Promise((function(n,a){if(!t.db)return n();var o=t.db.transaction(["comment"],"readwrite").objectStore("comment").delete(e);console.log("comment cache delete",e),o.onerror=function(){return console.warn("comment cache delete failed ",e),n()},o.onsuccess=function(){return n()}}))}},{key:"maintenance",value:function(){var e=this;if(this.db){var t=this.db.transaction(["comment"],"readwrite").objectStore("comment"),n=t.count();n.onsuccess=function(){var a=n.result;a>1e3?(console.log("comment cache db maintenance",a),t.index("last_access").openKeyCursor().onsuccess=function(e){var n=e.target.result;n&&(t.delete(n.primaryKey),--a>1e3&&n.continue())}):console.log("comment cache db no need to maintenance",a),e.added_items_since_maintenance=0},n.onerror=console.error.bind(console)}}},{key:"clear",value:function(){this.db&&(indexedDB.deleteDatabase("hole_cache_db"),console.log("delete comment cache db"))}}]),e}();function Ee(){return window.hole_cache||(window.hole_cache=new ke),window.hole_cache}var ye=function(){var e=Object(g.a)(b.a.mark((function e(t){var n,a,o=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]&&o[1],e.next=3,I(t);case 3:if(0===(a=e.sent).code){e.next=14;break}if(!a.msg){e.next=13;break}if(!n){e.next=10;break}alert(a.msg),e.next=11;break;case 10:throw new Error(a.msg);case 11:e.next=14;break;case 13:throw new Error(JSON.stringify(a));case 14:return e.abrupt("return",a);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=function(e,t){return e.sort((function(e,t){return parseInt(e.cid,10)-parseInt(t.cid,10)})).map((function(e){return e.name=function(e){if(0==e)return"\u6d1e\u4e3b";var t=e,n="";do{n+=" "+A[(t-=1)%26],t=parseInt(t/26)}while(t);return n.substr(1)}(e.name_id),e._display_color=t.get(e.name,e.is_tmp),e.variant={},e}))},Oe={load_replies:function(){var e=Object(g.a)(b.a.mark((function e(t,n,a,o){var r,s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=parseInt(t),e.next=3,fetch(le+"/getcomment?pid="+t,{headers:{"User-Token":n}});case 3:return r=e.sent,e.next=6,ye(r);case 6:return s=e.sent,Ee().put(t,o,s),s.data=xe(s.data,a),e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})));return function(t,n,a,o){return e.apply(this,arguments)}}(),load_replies_with_cache:function(){var e=Object(g.a)(b.a.mark((function e(t,n,a,o){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=parseInt(t),e.next=3,Ee().get(t,o);case 3:if(!(r=e.sent)){e.next=9;break}return r.data=xe(r.data,a),e.abrupt("return",{data:r,cached:!0});case 9:return e.next=11,Oe.load_replies(t,n,a,o);case 11:return r=e.sent,e.abrupt("return",{data:r,cached:!r});case 13:case"end":return e.stop()}}),e)})));return function(t,n,a,o){return e.apply(this,arguments)}}(),set_attention:function(){var e=Object(g.a)(b.a.mark((function e(t,n,a){var o,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new URLSearchParams).append("pid",t),o.append("switch",n?"1":"0"),e.next=5,fetch(le+"/attention",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Token":a},body:o});case 5:return r=e.sent,Ee().delete(t),e.abrupt("return",ye(r,!1));case 8:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),report:function(){var e=Object(g.a)(b.a.mark((function e(t,n,a){var o,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new URLSearchParams).append("pid",t),o.append("reason",n),e.next=5,fetch(le+"/report",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Token":a},body:o});case 5:return r=e.sent,e.abrupt("return",ye(r,!1));case 7:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),block:function(){var e=Object(g.a)(b.a.mark((function e(t,n,a){var o,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new URLSearchParams([["type",t],["id",n]]),e.next=3,fetch(le+"/block",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Token":a},body:o});case 3:return r=e.sent,e.abrupt("return",ye(r,!1));case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),del:function(){var e=Object(g.a)(b.a.mark((function e(t,n,a,o){var r,s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new URLSearchParams).append("type",t),r.append("id",n),r.append("note",a),e.next=6,fetch(le+"/delete",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Token":o},body:r});case 6:return s=e.sent,e.abrupt("return",ye(s,!1));case 8:case"end":return e.stop()}}),e)})));return function(t,n,a,o){return e.apply(this,arguments)}}(),update_cw:function(){var e=Object(g.a)(b.a.mark((function e(t,n,a){var o,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=new URLSearchParams).append("cw",t),o.append("pid",n),e.next=5,fetch(le+"/editcw",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Token":a},body:o});case 5:return r=e.sent,e.abrupt("return",ye(r,!1));case 7:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),get_list:function(){var e=Object(g.a)(b.a.mark((function e(t,n,a){var o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(le,"/getlist?p=").concat(t,"&order_mode=").concat(a),{headers:{"User-Token":n}});case 2:return o=e.sent,e.abrupt("return",ye(o));case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),get_search:function(){var e=Object(g.a)(b.a.mark((function e(t,n,a,o){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(le,"/search?search_mode=").concat(o,"&page=").concat(t,"&keywords=").concat(encodeURIComponent(n),"&pagesize=").concat(50),{headers:{"User-Token":a}});case 2:return r=e.sent,e.abrupt("return",ye(r));case 4:case"end":return e.stop()}}),e)})));return function(t,n,a,o){return e.apply(this,arguments)}}(),get_single:function(){var e=Object(g.a)(b.a.mark((function e(t,n){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(le+"/getone?pid="+t,{headers:{"User-Token":n}});case 2:return a=e.sent,e.abrupt("return",ye(a));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),get_attention:function(){var e=Object(g.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(le+"/getattention",{headers:{"User-Token":t}});case 2:return n=e.sent,e.abrupt("return",ye(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),add_vote:function(){var e=Object(g.a)(b.a.mark((function e(t,n,a){var o,r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new URLSearchParams([["vote",t],["pid",n]]),e.next=3,fetch(le+"/vote",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Token":a},body:o});case 3:return r=e.sent,e.abrupt("return",ye(r,!0));case 5:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),get_multi:function(){var e=Object(g.a)(b.a.mark((function e(t,n){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(le+"/getmulti?"+t.map((function(e){return"pids=".concat(e)})).join("&"),{headers:{"User-Token":n}});case 2:return a=e.sent,e.abrupt("return",ye(a,!0));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),set_title:function(){var e=Object(g.a)(b.a.mark((function e(t,n){var a,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("title: ",t),a=new URLSearchParams([["title",t]]),e.next=4,fetch(le+"/title",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Token":n},body:a});case 4:return o=e.sent,e.abrupt("return",ye(o,!0));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()};function Ne(){localStorage.saved_attentions=JSON.stringify(window.saved_attentions)}n(438);var je="https://git.thu.monster/newthuhole/",Se="hole_thu@riseup.net",Ce=o.a.createContext({value:null,set_value:function(){}});function Te(e){return o.a.createElement("div",null,o.a.createElement(fe,null),o.a.createElement(Pe,{show_sidebar:e.show_sidebar}),o.a.createElement("div",{className:"box list-menu"},o.a.createElement("a",{href:"/about.html",target:"_blank"},o.a.createElement("span",{className:"icon icon-about"}),o.a.createElement("label",null,"\u5173\u4e8e")),"\xa0\xa0",o.a.createElement("a",{onClick:function(){e.show_sidebar("\u8bbe\u7f6e",o.a.createElement(te,null))}},o.a.createElement("span",{className:"icon icon-settings"}),o.a.createElement("label",null,"\u672c\u5730\u8bbe\u7f6e")),"\xa0\xa0",o.a.createElement("a",{href:"/policy.html",target:"_blank"},o.a.createElement("span",{className:"icon icon-textfile"}),o.a.createElement("label",null,"\u6811\u6d1e\u89c4\u8303\uff08\u8bd5\u884c\uff09")),o.a.createElement("p",null,o.a.createElement("em",null,"\u5f3a\u70c8\u5efa\u8bae\u5f00\u59cb\u4f7f\u7528\u524d\u5148\u770b\u4e00\u904d\u6240\u6709\u8bbe\u7f6e\u9009\u9879"))),o.a.createElement("div",{className:"box help-desc-box"},o.a.createElement("p",null,o.a.createElement("a",{onClick:function(){"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then((function(e){var t,n=Object(m.a)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;console.log("unregister",a),a.unregister()}}catch(o){n.e(o)}finally{n.f()}})),Ee().clear(),setTimeout((function(){window.location.reload(!0)}),200)}},"\u5f3a\u5236\u68c0\u67e5\u66f4\u65b0"),"\uff08\u5f53\u524d\u7248\u672c\uff1a\u3010","version-2022-05-31"," ","production","\u3011 \u4f1a\u81ea\u52a8\u5728\u540e\u53f0\u68c0\u67e5\u66f4\u65b0\u5e76\u5728\u4e0b\u6b21\u8bbf\u95ee\u65f6\u66f4\u65b0\uff09")),o.a.createElement("div",{className:"box help-desc-box"},o.a.createElement("p",null,"\u610f\u89c1\u53cd\u9988\u8bf7\u52a0tag #\u610f\u89c1\u53cd\u9988 \u6216\u5230github\u540e\u7aef\u7684issue\u533a\u3002"),o.a.createElement("p",null,"\u65b0T\u6811\u6d1e\u5f3a\u70c8\u671f\u5f85\u6709\u5176\u4ed6\u66f4\u591a\u6811\u6d1e\u7684\u51fa\u73b0\uff0c\u4e00\u8d77\u5206\u5e03\u5f0f\u4e92\u8054\uff0c\u6784\u5efa\u6e05\u534e\u6811\u6d1e\u65cf\u3002\u8be6\u60c5\u89c1 \u5173\u4e8e \u4e2d\u7684\u63cf\u8ff0\u3002"),o.a.createElement("p",null,"\u8054\u7cfb\u6211\u4eec\uff1a",o.a.createElement("a",{href:"mailto:"+Se},Se)," \u3002")),o.a.createElement("div",{className:"box help-desc-box"},o.a.createElement("p",null,"\u65b0T\u6811\u6d1e \u7f51\u9875\u7248 by @hole_thu\uff0c\u57fa\u4e8e",o.a.createElement("a",{href:"https://www.gnu.org/licenses/agpl-3.0.html",target:"_blank"},"AGPLv3"),"\u534f\u8bae\u5728"," ",o.a.createElement("a",{href:je,target:"_blank"},"Gitea")," ","\u5f00\u6e90\u3002"),o.a.createElement("p",null,"\u65b0T\u6811\u6d1e \u7f51\u9875\u7248\u57fa\u4e8e",o.a.createElement("a",{href:"https://github.com/pkuhelper-web/webhole",target:"_blank",rel:"noopener"},"P\u5927\u6811\u6d1e\u7f51\u9875\u7248 by @xmcp"),"\u3001",o.a.createElement("a",{href:"https://github.com/thuhole/webhole",target:"_blank",rel:"noopener"},"T\u5927\u6811\u6d1e\u7f51\u9875\u7248 by @thuhole"),"\u3001"," ",o.a.createElement("a",{href:"https://reactjs.org/",target:"_blank",rel:"noopener"},"React"),"\u3001",o.a.createElement("a",{href:"https://icomoon.io/#icons",target:"_blank",rel:"noopener"},"IcoMoon"),"\u7b49\u5f00\u6e90\u9879\u76ee\u3002"),o.a.createElement("hr",null),o.a.createElement("p",null,"\u65b0T\u6811\u6d1e \u540e\u7aef by @hole_thu\uff0c\u57fa\u4e8e",o.a.createElement("a",{href:"http://www.wtfpl.net/about/",target:"_blank"},"WTFPLv2"),"\u534f\u8bae\u5728"," ",o.a.createElement("a",{href:je,target:"_blank"},"Gitea")," ","\u5f00\u6e90\u3002")))}var Pe=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={custom_title:window.TITLE||"",auto_block_rank:window.AUTO_BLCOK||2},a}return Object(c.a)(n,[{key:"update_title",value:function(e,t){if(e!==window.TITLE){var n=new FormData;n.append("title",e),fetch(le+"/title",{method:"POST",headers:{"User-Token":t},body:n}).then(I).then((function(t){if(0!==t.code)throw new Error(t.msg);window.TITLE=e,alert("\u4e13\u5c5e\u5934\u8854\u8bbe\u7f6e\u6210\u529f")})).catch((function(e){return alert("\u8bbe\u7f6e\u5934\u8854\u51fa\u9519\u4e86:\n"+e)}))}else alert("\u65e0\u53d8\u5316")}},{key:"update_auto_block",value:function(e,t){var n=new FormData;n.append("rank",e),fetch(le+"/auto_block",{method:"POST",headers:{"User-Token":t},body:n}).then(I).then((function(t){if(0!==t.code)throw new Error(t.msg);window.AUTO_BLCOK=e,alert("\u8bbe\u7f6e\u81ea\u52a8\u62c9\u9ed1\u9608\u503c\u6210\u529f")})).catch((function(e){return alert("\u8bbe\u7f6e\u81ea\u52a8\u62c9\u9ed1\u51fa\u9519\u4e86:\n"+e)}))}},{key:"copy_token",value:function(e){w()(e)&&alert("\u590d\u5236\u6210\u529f\uff01\n\u8bf7\u4e00\u5b9a\u4e0d\u8981\u6cc4\u9732\u54e6")}},{key:"render",value:function(){var e=this;return o.a.createElement(Ce.Consumer,null,(function(t){return o.a.createElement("div",null,o.a.createElement("div",{className:"login-form box"},t.value?o.a.createElement("div",null,o.a.createElement("p",null,o.a.createElement("b",null,"\u60a8\u5df2\u767b\u5f55\u3002"),o.a.createElement("button",{type:"button",onClick:function(){t.set_value(null)}},o.a.createElement("span",{className:"icon icon-logout"})," \u6ce8\u9500"),o.a.createElement("br",null)),o.a.createElement("p",null,o.a.createElement("a",{onClick:function(){e.props.show_sidebar("\u7cfb\u7edf\u65e5\u5fd7",o.a.createElement(we,{token:t.value}))}},"\u67e5\u770b\u7cfb\u7edf\u65e5\u5fd7"),o.a.createElement("br",null),"\u4e3e\u62a5\u8bb0\u5f55\u3001\u7ba1\u7406\u65e5\u5fd7\u7b49\u90fd\u662f\u516c\u5f00\u7684\u3002"),o.a.createElement("p",null,o.a.createElement("a",{onClick:e.copy_token.bind(e,t.value)},"\u590d\u5236 User Token"),o.a.createElement("br",null),"User Token\u4ec5\u7528\u4e8e\u5f00\u53d1bot\uff0c\u5207\u52ff\u544a\u77e5\u4ed6\u4eba\u3002\u82e5\u6000\u7591\u88ab\u76d7\u53f7\u8bf7\u5237\u65b0Token(\u5237\u65b0\u529f\u80fd\u5373\u5c06\u4e0a\u7ebf)\u3002"),o.a.createElement("p",null,"\u4e13\u5c5e\u5934\u8854\uff1a",o.a.createElement("input",{value:e.state.custom_title,onChange:function(t){e.setState({custom_title:t.target.value})},maxLength:10}),o.a.createElement("button",{className:"update-title-btn",type:"button",onClick:function(n){e.update_title(e.state.custom_title,t.value)},disabled:!e.state.custom_title},"\u63d0\u4ea4"),o.a.createElement("br",null),"\u8bbe\u7f6e\u4e13\u5c5e\u5934\u8854\u540e\uff0c\u53ef\u5728\u53d1\u8a00\u65f6\u9009\u62e9\u4f7f\u7528\u3002\u91cd\u7f6e\u540e\u9700\u91cd\u65b0\u8bbe\u7f6e\u3002\u4e34\u65f6\u7528\u6237\u5982\u9700\u4fdd\u6301\u5934\u8854\u8bf7\u4f7f\u7528\u76f8\u540c\u540e\u7f00\u3002"),o.a.createElement("p",null,"\u81ea\u52a8\u62c9\u9ed1\u9608\u503c:",o.a.createElement("span",{style:{display:"inline-block",width:"3rem"}},o.a.createElement("b",null,5*e.state.auto_block_rank)),o.a.createElement("input",{value:e.state.auto_block_rank,type:"range",min:"1",max:"10",list:"autoBlock",onChange:function(t){e.setState({auto_block_rank:t.target.value})}}),o.a.createElement("button",{className:"update-title-btn",type:"button",onClick:function(n){e.update_auto_block(e.state.auto_block_rank,t.value)}},"\u63d0\u4ea4"),o.a.createElement("datalist",{id:"autoBlock"},o.a.createElement("option",null,"1"),o.a.createElement("option",null,"2"),o.a.createElement("option",null,"3")),o.a.createElement("br",null),"\u81ea\u52a8\u4e0d\u5c55\u793a\u88ab\u62c9\u9ed1\u6b21\u6570\u8f83\u591a\u7528\u6237\u53d1\u5e03\u7684\u5185\u5bb9\uff0c\u5305\u62ec\u81ea\u5df1\u3002\u5bf9\u6bcf\u4e2a\u6d1e\u53ca\u5176\u8bc4\u8bba\u7684\u53ef\u89c1\u6027\u4f1a\u67091\u5c0f\u65f6\u7f13\u5b58\uff0c\u9891\u7e41\u4fee\u6539\u65e0\u6548\u3002")):o.a.createElement(q,{token_callback:t.set_value},(function(e){return o.a.createElement("div",null,o.a.createElement("p",null,o.a.createElement("button",{type:"button",onClick:e},o.a.createElement("span",{className:"icon icon-login"}),"\xa0\u767b\u5f55")),o.a.createElement("p",null,o.a.createElement("small",null,"\u65b0T\u6811\u6d1e \u9762\u5411T\u5927\u5b66\u751f\uff0c\u901a\u8fc7\u5df2\u9a8c\u8bc1\u8eab\u4efd\u7684\u7b2c\u4e09\u65b9\u670d\u52a1\u6388\u6743\u767b\u9646\u3002")))}))))}))}}]),n}(a.Component),Le=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={text:"",loading_status:"done",preview:!1,use_title:!1},a.on_change_bound=a.on_change.bind(Object(l.a)(a)),a.on_use_title_change_bound=a.on_use_title_change.bind(Object(l.a)(a)),a.area_ref=a.props.area_ref||o.a.createRef(),a.global_keypress_handler_bound=a.global_keypress_handler.bind(Object(l.a)(a)),a.color_picker=new k,a}return Object(c.a)(n,[{key:"global_keypress_handler",value:function(e){"Enter"!==e.code||e.ctrlKey||e.altKey||-1!==["input","textarea"].indexOf(e.target.tagName.toLowerCase())||this.area_ref.current&&(e.preventDefault(),this.area_ref.current.focus())}},{key:"componentDidMount",value:function(){document.addEventListener("keypress",this.global_keypress_handler_bound)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keypress",this.global_keypress_handler_bound)}},{key:"on_change",value:function(e){this.setState({text:e})}},{key:"on_use_title_change",value:function(e){this.setState({use_title:e.target.checked})}},{key:"on_submit",value:function(e){var t=this;if(e&&e.preventDefault(),"loading"!==this.state.loading_status&&this.state.text){this.setState({loading_status:"loading"});var n=this.props.pid,a=this.state,o=a.text,r=a.use_title,s=new URLSearchParams({pid:n,text:o,use_title:r?"1":""});fetch(le+"/docomment",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Token":this.props.token},body:s}).then(I).then((function(e){if(0!==e.code)throw new Error(e.msg);var a=window.saved_attentions;a.includes(n)||(a.unshift(n),window.saved_attentions=a,Ne()),t.setState({loading_status:"done",text:"",preview:!1}),t.area_ref.current.clear(),t.props.on_complete()})).catch((function(e){console.error(e),alert("\u56de\u590d\u5931\u8d25\n"+e),t.setState({loading_status:"done"})}))}}},{key:"toggle_preview",value:function(){this.setState({preview:!this.state.preview})}},{key:"render",value:function(){var e=this;return o.a.createElement("form",{onSubmit:this.on_submit.bind(this),className:"reply-form box"+(this.state.text?" reply-sticky":"")},this.state.preview?o.a.createElement("div",{className:"reply-preview"},o.a.createElement(pe,{text:this.state.text,color_picker:this.color_picker,show_pid:function(){}})):o.a.createElement(me,{ref:this.area_ref,id:this.props.pid,on_change:this.on_change_bound,on_submit:this.on_submit.bind(this)}),o.a.createElement("div",{className:"reply-form-opt-box"},o.a.createElement("div",{className:"reply-form-buttons"},o.a.createElement("button",{type:"button",onClick:function(){e.toggle_preview()}},this.state.preview?o.a.createElement("span",{className:"icon icon-eye-blocked"}):o.a.createElement("span",{className:"icon icon-eye"})),"loading"===this.state.loading_status?o.a.createElement("button",{disabled:"disabled"},o.a.createElement("span",{className:"icon icon-loading"})):o.a.createElement("button",{type:"submit"},o.a.createElement("span",{className:"icon icon-send"}))),window.TITLE&&o.a.createElement("label",null,o.a.createElement("input",{type:"checkbox",onChange:this.on_use_title_change_bound,checked:this.state.use_title})," ","\u4f7f\u7528\u5934\u8854")))}}]),n}(a.Component),Ue=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={text:"",upload_progress_text:"",is_loading:!1,file_name:"",file_type:"",cw:window.CW_BACKUP||"",allow_search:window.AS_BACKUP||!1,loading_status:"done",preview:!1,has_poll:!!window.POLL_BACKUP,poll_options:JSON.parse(window.POLL_BACKUP||'[""]'),use_title:!1},a.area_ref=o.a.createRef(),a.on_change_bound=a.on_change.bind(Object(l.a)(a)),a.on_allow_search_change_bound=a.on_allow_search_change.bind(Object(l.a)(a)),a.on_use_title_change_bound=a.on_use_title_change.bind(Object(l.a)(a)),a.on_cw_change_bound=a.on_cw_change.bind(Object(l.a)(a)),a.on_poll_option_change_bound=a.on_poll_option_change.bind(Object(l.a)(a)),a.color_picker=new k,a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.area_ref.current&&this.area_ref.current.focus()}},{key:"componentWillUnmount",value:function(){var e=this.state,t=e.cw,n=e.allow_search,a=e.has_poll,o=e.poll_options;window.CW_BACKUP=t,window.AS_BACKUP=n,localStorage.DEFAULT_ALLOW_SEARCH=n?"1":"",window.POLL_BACKUP=a?JSON.stringify(o):null}},{key:"on_allow_search_change",value:function(e){this.setState({allow_search:e.target.checked})}},{key:"on_use_title_change",value:function(e){this.setState({use_title:e.target.checked})}},{key:"on_cw_change",value:function(e){this.setState({cw:e.target.value})}},{key:"on_change",value:function(e){this.setState({text:e})}},{key:"do_post",value:function(){var e=this,t=this.state,n=t.cw,a=t.text,o=t.allow_search,r=t.use_title,s=t.has_poll,i=t.poll_options,c=new URLSearchParams({cw:n,text:a,allow_search:o?"1":"",use_title:r?"1":"",type:"text"});s&&i.forEach((function(e){e&&c.append("poll_options",e)})),fetch(le+"/dopost",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Token":this.props.token},body:c}).then(I).then((function(t){if(0!==t.code)throw new Error(t.msg);e.setState({loading_status:"done",text:"",preview:!1}),e.area_ref.current.clear(),e.props.on_complete(),window.CW_BACKUP="",window.POLL_BACKUP=null})).catch((function(t){console.error(t),alert("\u53d1\u8868\u5931\u8d25\n"+t),e.setState({loading_status:"done"})}))}},{key:"on_submit",value:function(e){e&&e.preventDefault(),"loading"!==this.state.loading_status&&this.state.text&&(this.setState({loading_status:"loading"}),this.do_post())}},{key:"toggle_preview",value:function(){this.setState({preview:!this.state.preview})}},{key:"on_poll_option_change",value:function(e,t){var n=this.state.poll_options,a=e.target.value;n[t]=a,!a&&n.length>1&&n.splice(t,1),n[n.length-1]&&n.length<8&&n.push(""),this.setState({poll_options:n})}},{key:"on_file_change",value:function(e){console.log(e);var t=e.target.files[0];if(t){console.log(t),this.setState({is_loading:!0,file_name:t.name,file_type:t.type});var n=new XMLHttpRequest;n.upload.addEventListener("progress",this.upload_progress.bind(this),!1),n.addEventListener("load",this.upload_complete.bind(this),!1),n.addEventListener("error",this.upload_error.bind(this),!1),n.addEventListener("abort",this.upload_abort.bind(this),!1),n.open("POST",le+"/upload"),n.setRequestHeader("User-Token",this.props.token),n.send(t)}}},{key:"update_text_after_upload",value:function(e){var t=this.state,n=t.file_name,a=t.file_type,o=(window.config.ipfs_gateway_list[0]||"<hash>(\u65e0ipfs\u7f51\u5173)").replaceAll("<hash>",e.hash)+"?filename=".concat(encodeURIComponent(n),"&filetype=").concat(encodeURIComponent(a));!function(e){var t="testing_"+e;window[t]={curr:0},window.config.ipfs_gateway_list.forEach((function(n){fetch(n.replaceAll("<hash>",e),{method:"HEAD"}).then((function(e){if(e.ok&&(console.log(n,"success!"),window[t])){window[t].curr+=1,window[t][n]=window[t].curr;var a=window.config.ipfs_gateway_list;a.sort((function(e,n){return(window[t][e]||9999)-(window[t][n]||999)})),window.config.ipfs_gateway_list=a,X(!1)}})).catch((function(e){console.log(n,"fail!")}))}))}(e.hash);var r=this.state.text+"\n"+(a.startsWith("image/")?"![](".concat(o,")"):o)+" [\u52a0\u8f7d\u5931\u8d25\u8bf7\u70b9\u51fb\u6b64](".concat(window.location.origin,"/ipfs.html#").concat(e.hash,")\n\n---\n");this.setState({text:r}),this.area_ref.current.set(r)}},{key:"upload_progress",value:function(e){console.log(e.loaded,e.total),this.setState({upload_progress_text:"".concat((100*e.loaded/e.total).toFixed(2),"%")})}},{key:"upload_complete",value:function(e){try{var t=JSON.parse(e.target.responseText);if(0!=t.code)throw alert(t.msg),new Error;this.update_text_after_upload(t.data),this.setState({is_loading:!1})}catch(n){console.log(n),this.upload_error(e)}}},{key:"upload_error",value:function(e){alert("\u4e0a\u4f20\u5931\u8d25\n"+(e.target.responseText.length<100?e.target.responseText:e.target.status)),this.setState({is_loading:!1})}},{key:"upload_abort",value:function(e){alert("\u4e0a\u4f20\u5df2\u4e2d\u65ad"),this.setState({is_loading:!1})}},{key:"render",value:function(){var e=this,t=this.state,n=t.has_poll,a=t.poll_options,r=t.preview,s=t.loading_status,i=t.upload_progress_text,c=t.is_loading,l=t.file_name;return o.a.createElement("form",{onSubmit:this.on_submit.bind(this),className:"post-form box"},o.a.createElement("div",{className:"post-form-bar"},o.a.createElement("div",null,r?o.a.createElement("button",{type:"button",onClick:function(){e.toggle_preview()}},o.a.createElement("span",{className:"icon icon-eye-blocked"}),"\xa0\u7f16\u8f91"):o.a.createElement("button",{type:"button",onClick:function(){e.toggle_preview()}},o.a.createElement("span",{className:"icon icon-eye"}),"\xa0\u9884\u89c8"),"done"!==s?o.a.createElement("button",{disabled:"disabled"},o.a.createElement("span",{className:"icon icon-loading"}),"\xa0\u4e0a\u4f20"):o.a.createElement("button",{type:"submit"},o.a.createElement("span",{className:"icon icon-send"}),"\xa0\u53d1\u8868")),o.a.createElement("div",{className:"checkbox-bar"},o.a.createElement("label",null,o.a.createElement("input",{type:"checkbox",onChange:this.on_allow_search_change_bound,checked:this.state.allow_search})," ","\u5141\u8bb8\u641c\u7d22"),window.TITLE&&o.a.createElement("label",null,o.a.createElement("input",{type:"checkbox",onChange:this.on_use_title_change_bound,checked:this.state.use_title})," ","\u4f7f\u7528\u5934\u8854"))),r?o.a.createElement("div",{className:"post-preview"},o.a.createElement(pe,{text:this.state.text,color_picker:this.color_picker,show_pid:function(){}})):o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,"\u4e0a\u4f20\u5e76\u63d2\u5165\u6587\u4ef6: "),o.a.createElement("input",{className:"file-input",type:"file",name:"file",onChange:this.on_file_change.bind(this),disabled:c}),c&&o.a.createElement("p",null,o.a.createElement("small",null,"\u4e0a\u4f20 ",o.a.createElement("i",null,l)," \u4e2d: ",i)),o.a.createElement("input",{type:"text",placeholder:"\u6298\u53e0\u8b66\u544a(\u7559\u7a7a\u8868\u793a\u4e0d\u6298\u53e0)",value:this.state.cw,id:"post_cw",className:"spoiler-input",onChange:this.on_cw_change_bound,maxLength:"32"}),o.a.createElement(me,{ref:this.area_ref,id:"new_post",on_change:this.on_change_bound,on_submit:this.on_submit.bind(this)})),o.a.createElement("button",{type:"button",onClick:function(){e.setState({has_poll:!n})}},n?"\u53d6\u6d88":"\u6dfb\u52a0","\u6295\u7968"),n&&o.a.createElement("div",{className:"post-form-poll-options"},o.a.createElement("h6",null,"\u6295\u7968\u9009\u9879"),a.map((function(t,n){return o.a.createElement("input",{key:n,type:"text",value:t,placeholder:"\u8f93\u5165\u4ee5\u6dfb\u52a0\u9009\u9879...",onChange:function(t){return e.on_poll_option_change_bound(t,n)},maxLength:"32"})}))),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("br",null),o.a.createElement("p",null,o.a.createElement("small",null,"\u8bf7\u9075\u5b88",o.a.createElement("a",{href:"/policy.html",target:"_blank"},"\u6811\u6d1e\u7ba1\u7406\u89c4\u8303\uff08\u8bd5\u884c\uff09"),"\uff0c\u6587\u660e\u53d1\u8a00\u3002")),o.a.createElement("p",null,o.a.createElement("small",null,"\u9996\u9009ipfs\u7f51\u5173\u53ef\u4ee5\u5728\u8bbe\u7f6e\u4e2d\u4fee\u6539\uff0c\u5982\u6548\u679c\u4e0d\u4f73\u4ecd\u53ef\u4f7f\u7528\u56fe\u5e8a\uff0c\u4f8b\u5982\uff1a",o.a.createElement("a",{href:"https://imgtu.com/",target:"_blank"},"\u8def\u8fc7\u56fe\u5e8a"),"\u3001",o.a.createElement("a",{href:"https://sm.ms/",target:"_blank"},"sm.ms"),"\u3001",o.a.createElement("a",{href:"https://bbs.pku.edu.cn/v2/post-read.php?bid=154&threadid=3743",target:"_blank"},"\u672a\u540dBBS"),"\u3001",o.a.createElement("a",{href:"https://zhuanlan.zhihu.com/write",target:"_blank"},"\u77e5\u4e4e"),"\u3002")))}}]),n}(a.Component),Ie=n(79),Ae={a:!0,audio:!0},De=[];window.LATEST_POST_ID=parseInt(localStorage._LATEST_POST_ID,10)||0;function Re(e){return(window.config.block_tmp&&e.is_tmp||window.config.block_words_v4.some((function(t){return e.text.includes(t)}))||e.cw&&window.config.block_words_v4.concat(window.config.block_cw).some((function(t){return e.cw.includes(t)})))&&!e.can_del}function Ke(e,t){return function(){var n=Object(g.a)(b.a.mark((function n(a){var r,s,i,c,l,u,d=arguments;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=d.length>1&&void 0!==d[1]&&d[1],s=new k,e(i="\u6811\u6d1e #"+a,o.a.createElement("div",{className:"box box-tip"},"\u6b63\u5728\u52a0\u8f7d #",a),r?"replace":"push"),n.prev=4,n.next=7,Oe.get_single(a,t);case 7:return(c=n.sent).data.variant={},n.next=11,Oe.load_replies_with_cache(a,t,s,parseInt(c.data.reply));case 11:l=n.sent,u=l.data,e(i,o.a.createElement(We,{key:+new Date,info:c.data,replies:u.data,attention:u.attention,token:t,show_sidebar:e,color_picker:s,deletion_detect:"on"===localStorage.DELETION_DETECT}),"replace"),n.next=20;break;case 16:n.prev=16,n.t0=n.catch(4),console.error(n.t0),e(i,o.a.createElement("div",{className:"box box-tip"},o.a.createElement("p",null,o.a.createElement("a",{onClick:function(){return Ke(e,t)(a,!0)}},"\u91cd\u65b0\u52a0\u8f7d")),o.a.createElement("p",null,""+n.t0)),"replace");case 20:case"end":return n.stop()}}),n,null,[[4,16]])})));return function(e){return n.apply(this,arguments)}}()}var Me=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){return Object(i.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"render",value:function(){var e=this.props,t=e.info,n=e.color_picker,a=e.show_pid,r=e.do_filter_name,s=e.do_delete,i=e.do_report,c=e.do_block,l=e.search_param,u=t.name,d=t.text,h=Re(t);return this.color_picker=new k,o.a.createElement("div",{className:"flow-reply box",style:t._display_color?{"--box-bgcolor-light":t._display_color[0],"--box-bgcolor-dark":t._display_color[1]}:null},o.a.createElement("div",{className:"box-header"},!!r&&o.a.createElement("span",{className:"reply-header-badge clickable",onClick:function(){r(t.name)}},o.a.createElement("span",{className:"icon icon-locate"})),"\xa0",o.a.createElement("span",{className:"box-header-name"},t.name),t.author_title&&o.a.createElement("span",{className:"box-header-name author-title"},'"'.concat(t.author_title,'"')),t.is_tmp&&o.a.createElement("span",{className:"box-header-name tmp-title"},"\u4e34\u65f6\u8d26\u53f7"),!!s&&!!t.can_del&&o.a.createElement("span",{className:"clickable",onClick:function(){s("cid",t.cid)}}," ","\ud83d\uddd1\ufe0f"," "),!!c&&o.a.createElement("span",{className:"clickable",onClick:c}," ","\ud83d\udeab"," "),!!i&&o.a.createElement(o.a.Fragment,null,"\xa0",o.a.createElement("span",{className:"clickable",onClick:i},o.a.createElement("span",{className:"icon icon-flag"})),"\xa0"),t.dangerous_user&&o.a.createElement("span",{className:"danger-info"}," ",t.dangerous_user," "),t.blocked_count&&o.a.createElement("span",{className:"danger-info"}," ",t.blocked_count," "),o.a.createElement(M,{stamp:t.timestamp,short:!i}),"\xa0",h&&o.a.createElement("span",{className:"box-header-badge"},"\u5df2\u5c4f\u853d")),!h&&o.a.createElement("div",{className:"box-content"},o.a.createElement(pe,{author:u,text:d,color_picker:n,show_pid:a,search_param:l})))}}]),n}(a.PureComponent),Be=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={cw:e.info.cw||""},a}return Object(c.a)(n,[{key:"copy_link",value:function(e){e.preventDefault(),w()("".concat(e.target.href).concat(this.props.info.cw?" \u3010"+this.props.info.cw+"\u3011":"","\n\n").concat(this.props.info.text,"\n")+"\uff08".concat(R(new Date(1e3*this.props.info.timestamp))," ").concat(this.props.info.likenum,"\u5173\u6ce8 ").concat(this.props.info.reply,"\u56de\u590d\uff09\n\n")+this.props.replies.map((function(e){return"\u3010".concat(e.name,"\u3011\n").concat(e.text,"\n")})).join("\n"))}},{key:"on_cw_change",value:function(e){this.setState({cw:e.target.value})}},{key:"render",value:function(){var e=this.props,t=e.info,n=e.is_quote,a=e.cached,r=e.attention,s=e.do_filter_name,i=e.do_delete,c=e.do_edit_cw,l=e.img_clickable,u=e.color_picker,d=e.show_pid,h=e.do_vote,p=e.do_block,m=e.search_param,_=this.state.cw,f=u.get("\u6d1e\u4e3b",t.is_tmp);return o.a.createElement("div",{className:"flow-item"+(n?" flow-item-quote":"")},!!n&&o.a.createElement("div",{className:"quote-tip black-outline"},o.a.createElement("div",null,o.a.createElement("span",{className:"icon icon-quote"}))),o.a.createElement("div",{className:"box",style:{"--box-bgcolor-light":f[0],"--box-bgcolor-dark":f[1]}},!!window.LATEST_POST_ID&&parseInt(t.pid,10)>window.LATEST_POST_ID&&o.a.createElement("div",{className:"flow-item-dot"}),!!r&&!a&&o.a.createElement("div",{className:"flow-item-dot"}),o.a.createElement("div",{className:"box-header"},!!s&&o.a.createElement("span",{className:"reply-header-badge clickable",onClick:function(){s("\u6d1e\u4e3b")}},o.a.createElement("span",{className:"icon icon-locate"})),!!parseInt(t.likenum,10)&&o.a.createElement("span",{className:"box-header-badge"},t.likenum,"\xa0",o.a.createElement("span",{className:"icon icon-"+(r?"star-ok":"star")})),!!parseInt(t.reply,10)&&o.a.createElement("span",{className:"box-header-badge"},t.reply,"\xa0",o.a.createElement("span",{className:"icon icon-reply"})),o.a.createElement("code",{className:"box-id"},o.a.createElement("a",{href:"##"+t.pid,onClick:this.copy_link.bind(this)},"#",t.pid)),"\xa0",t.author_title&&o.a.createElement("span",{className:"box-header-name author-title"},'"'.concat(t.author_title,'"')),t.is_tmp&&o.a.createElement("span",{className:"box-header-name tmp-title"},"\u4e34\u65f6\u8d26\u53f7"),t.is_reported&&o.a.createElement("span",{className:"danger-info"}," R "),!!i&&!!t.can_del&&o.a.createElement("span",{className:"clickable",onClick:function(){i("pid",t.pid)}}," ","\ud83d\uddd1\ufe0f"," "),!!p&&o.a.createElement("span",{className:"clickable",onClick:p}," ","\ud83d\udeab"," "),t.dangerous_user&&o.a.createElement("span",{className:"danger-info"}," ",t.dangerous_user," "),t.blocked_count&&o.a.createElement("span",{className:"danger-info"}," ",t.blocked_count," "),null!==t.cw&&(!c||!t.can_del)&&o.a.createElement("span",{className:"box-header-cw"},t.cw),!!c&&!!t.can_del&&o.a.createElement("div",{className:"box-header-cw-edit clickable"},o.a.createElement("input",{type:"text",value:_,maxLength:"32",placeholder:"\u7f16\u8f91\u6298\u53e0\u8b66\u544a",onChange:this.on_cw_change.bind(this)}),o.a.createElement("button",{type:"button",onClick:function(e){return c(_,t.pid)}},"\u66f4\u65b0")),t.allow_search&&o.a.createElement("span",null," \ud83d\udce2 "),o.a.createElement(M,{stamp:t.timestamp,short:!l})),!!t.hot_score&&o.a.createElement("span",{className:"box-header"},"hot score: ",t.hot_score),o.a.createElement("div",{className:"box-content"},o.a.createElement(pe,{text:t.text,color_picker:u,show_pid:d,search_param:m})),t.poll&&o.a.createElement("div",{className:h?"box-poll":"box-poll disabled"},o.a.createElement(Ie.a,{key:t.poll.vote||"x",question:"",answers:t.poll.answers,onVote:h||function(){},customStyles:{theme:"cyan"},noStorage:!0,vote:localStorage["VOTE_RECORD:"+t.pid]||t.poll.vote})),!(!r||!t.variant.latest_reply)&&o.a.createElement("p",{className:"box-footer"},"\u6700\u65b0\u56de\u590d ",o.a.createElement(M,{stamp:t.variant.latest_reply,short:!1}))))}}]),n}(a.PureComponent),We=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={attention:e.attention,info:e.info,replies:e.replies,loading_status:"done",error_msg:null,filter_name:null,rev:!1},a.color_picker=e.color_picker,a.syncState=e.sync_state||function(){},a.reply_ref=o.a.createRef(),a}return Object(c.a)(n,[{key:"set_variant",value:function(e,t){this.setState((function(n){return e?{replies:n.replies.map((function(n){return n.cid===e?Object.assign({},n,{variant:Object.assign({},n.variant,t)}):n}))}:{info:Object.assign({},n.info,{variant:Object.assign({},n.info.variant,t)})}}),(function(){this.syncState({info:this.state.info,replies:this.state.replies})}))}},{key:"load_replies",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.setState({loading_status:"loading",error_msg:null}),Oe.load_replies(this.state.info.pid,this.props.token,this.color_picker,null).then((function(n){e.setState((function(e,a){return{replies:n.data,info:t?Object.assign({},e.info,{reply:""+n.data.length,likenum:""+n.likenum}):e.info,attention:!!n.attention,loading_status:"done",error_msg:null}}),(function(){e.syncState({replies:e.state.replies,attention:e.state.attention,info:e.state.info}),e.state.replies.length&&e.set_variant(null,{latest_reply:Math.max.apply(null,e.state.replies.map((function(e){return parseInt(e.timestamp)})))})}))})).catch((function(t){console.error(t),e.setState({replies:[],loading_status:"done",error_msg:""+t})}))}},{key:"toggle_attention",value:function(){var e=this,t=this.state.info,n=t.pid;Oe.set_attention(n,!this.state.attention,this.props.token).then((function(a){e.setState({attention:a.attention,info:Object.assign({},t,{likenum:""+a.likenum})});var o=window.saved_attentions;if(a.attention&&!o.includes(n))o.unshift(n);else if(!a.attention&&o.includes(n)){var r=o.indexOf(n);o.splice(r,1)}window.saved_attentions=o,Ne(),e.syncState({attention:a.attention,info:Object.assign({},t,{likenum:""+a.likenum})})})).catch((function(t){e.setState({loading_status:"done"}),alert("\u8bbe\u7f6e\u5173\u6ce8\u5931\u8d25\n"+t),console.error(t)}))}},{key:"do_vote",value:function(e){var t=this;this.setState({loading_status:"loading",error_msg:null}),Oe.add_vote(e,this.state.info.pid,this.props.token).then((function(n){0===n.code&&(localStorage["VOTE_RECORD:"+t.state.info.pid]=e,t.setState((function(e,t){return{info:Object.assign({},e.info,{poll:n.data}),loading_status:"done"}}),(function(){t.syncState({info:t.state.info})})))})).catch((function(e){console.error(e),t.setState({loading_status:"done",error_msg:""+e})}))}},{key:"report",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";console.log(t);var n=prompt("\u4e3e\u62a5 #".concat(this.state.info.pid," \u7684\u7406\u7531\uff1a"),t);null!==n&&Oe.report(this.state.info.pid,n,this.props.token).then((function(e){alert("\u4e3e\u62a5\u6210\u529f")})).catch((function(e){alert("\u4e3e\u62a5\u5931\u8d25\n"+e),console.error(e)}))}},{key:"block",value:function(e,t,n,a){confirm("\u786e\u5b9a\u62c9\u9ed1".concat(e,"\u5417\uff1f\u540e\u7eed\u5c06\u4e0d\u4f1a\u6536\u5230\u5176\u53d1\u5e03\u7684\u4efb\u4f55\u5185\u5bb9"))&&Oe.block(t,n,this.props.token).then((function(e){var t=e.data;alert("\u64cd\u4f5c\u6210\u529f\uff0c\u5f53\u524d\u62c9\u9ed1\u6570 ".concat(t.curr)),a&&a()})).catch((function(e){alert("\u62c9\u9ed1\u5931\u8d25\n"+e),console.error(e)}))}},{key:"set_filter_name",value:function(e){this.setState((function(t){return{filter_name:e===t.filter_name?null:e}}))}},{key:"toggle_rev",value:function(){this.setState((function(e){return{rev:!e.rev}}),ge.forceCheck)}},{key:"show_reply_bar",value:function(e,t){if(this.reply_ref.current&&!t.target.closest("a, .clickable")){var n=this.reply_ref.current.get();if(/^\s*(?:Re (?:|\u6d1e\u4e3b|(?:[A-Z][a-z]+ )?(?:[A-Z][a-z]+)|You Win(?: \d+)?):)?\s*$/.test(n)){var a="Re "+e+": ";a===this.reply_ref.current.get()?this.reply_ref.current.set(""):this.reply_ref.current.set(a)}}}},{key:"make_do_delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=function(n,a){var o=prompt("\u5c06\u5220\u9664".concat(n,"=").concat(a,", \u5907\u6ce8\uff1a"),"(\u65e0)");null!==o&&Oe.del(n,a,o,e).then((function(e){alert("\u5220\u9664\u6210\u529f"),t()})).catch((function(e){alert("\u5220\u9664\u5931\u8d25\n"+e),console.error(e)}))};return n}},{key:"do_edit_cw",value:function(e,t){var n=this;Oe.update_cw(e,t,this.props.token).then((function(t){n.setState({info:Object.assign({},n.state.info,{cw:e})},(function(){n.syncState({info:n.state.info})})),alert("\u5df2\u66f4\u65b0")})).catch((function(e){alert("\u66f4\u65b0\u5931\u8d25\n"+e),console.error(e)}))}},{key:"render",value:function(){var e=this;if("loading"===this.state.loading_status)return o.a.createElement("p",{className:"box box-tip"},"\u52a0\u8f7d\u4e2d\u2026\u2026");var t=Ke(this.props.show_sidebar,this.props.token),n=this.state.filter_name?this.state.replies.filter((function(t){return t.name===e.state.filter_name})):this.state.replies.slice();this.state.rev&&n.reverse();var a=Object(_.a)({},"\u6d1e\u4e3b",1);n.forEach((function(e){void 0===a[e.name]&&(a[e.name]=0),a[e.name]++}));var r=this.state.filter_name&&"\u6d1e\u4e3b"!==this.state.filter_name?null:o.a.createElement(be,{callback:function(t){e.show_reply_bar("",t)}},o.a.createElement(Be,{info:this.state.info,attention:this.state.attention,img_clickable:!0,color_picker:this.color_picker,show_pid:t,search_param:this.props.search_param,replies:this.state.replies,set_variant:function(t){e.set_variant(null,t)},do_filter_name:a["\u6d1e\u4e3b"]>1?this.set_filter_name.bind(this):null,do_delete:this.make_do_delete(this.props.token,(function(){window.location.reload()})),do_edit_cw:this.do_edit_cw.bind(this),do_vote:this.do_vote.bind(this),do_block:function(){e.block("\u6d1e\u4e3b","post",e.state.info.pid,(function(){window.location.reload()}))}}));return o.a.createElement("div",{className:"flow-item-row sidebar-flow-item"},o.a.createElement("div",{className:"box box-tip"},!!this.props.token&&o.a.createElement("span",null,o.a.createElement("a",{onClick:this.report.bind(this)},o.a.createElement("span",{className:"icon icon-flag"}),o.a.createElement("label",null,"\u4e3e\u62a5")),"\xa0\xa0"),o.a.createElement("a",{onClick:this.load_replies.bind(this)},o.a.createElement("span",{className:"icon icon-refresh"}),o.a.createElement("label",null,"\u5237\u65b0")),(this.state.replies.length>=1||this.state.rev)&&o.a.createElement("span",null,"\xa0\xa0",o.a.createElement("a",{onClick:this.toggle_rev.bind(this)},o.a.createElement("span",{className:"icon icon-order-rev"}),o.a.createElement("label",null,this.state.rev?"\u8fd8\u539f":"\u9006\u5e8f"))),!!this.props.token&&o.a.createElement("span",null,"\xa0\xa0",o.a.createElement("a",{onClick:function(){e.toggle_attention()}},this.state.attention?o.a.createElement("span",null,o.a.createElement("span",{className:"icon icon-star-ok"}),o.a.createElement("label",null,"\u5df2\u5173\u6ce8")):o.a.createElement("span",null,o.a.createElement("span",{className:"icon icon-star"}),o.a.createElement("label",null,"\u672a\u5173\u6ce8"))))),!!this.state.filter_name&&o.a.createElement("div",{className:"box box-tip flow-item filter-name-bar"},o.a.createElement("p",null,o.a.createElement("span",{style:{float:"left"}},o.a.createElement("a",{onClick:function(){e.set_filter_name(null)}},"\u8fd8\u539f")),o.a.createElement("span",{className:"icon icon-locate"}),"\xa0\u5f53\u524d\u53ea\u770b\xa0",o.a.createElement(ue,{colors:this.color_picker.get(this.state.filter_name)},this.state.filter_name))),!this.state.rev&&r,!!this.state.error_msg&&o.a.createElement("div",{className:"box box-tip flow-item"},o.a.createElement("p",null,"\u52a0\u8f7d\u5931\u8d25"),o.a.createElement("p",null,this.state.error_msg)),this.props.deletion_detect&&parseInt(this.state.info.reply)>this.state.replies.length&&!!this.state.replies.length&&o.a.createElement("div",{className:"box box-tip flow-item box-danger"},parseInt(this.state.info.reply)-this.state.replies.length," ","\u6761\u56de\u590d\u88ab\u5220\u9664"),n.map((function(n,r){return(n.can_del||!n.is_blocked)&&o.a.createElement(ve.a,{key:r,offset:1500,height:"5em",overflow:!0,once:!0},o.a.createElement(be,{callback:function(t){e.show_reply_bar(n.name,t)}},o.a.createElement(Me,{info:n,color_picker:e.color_picker,show_pid:t,search_param:e.props.search_param,set_variant:function(t){e.set_variant(n.cid,t)},do_filter_name:a[n.name]>1?e.set_filter_name.bind(e):null,do_delete:e.make_do_delete(e.props.token,e.load_replies.bind(e)),do_block:function(){e.block(n.name,"comment",n.cid,e.load_replies.bind(e))},do_report:function(t){e.report(t,"\u8bc4\u8bba\u533a".concat(n.name,"\uff0c\u8bc4\u8bbaid ").concat(n.cid))}})))})),this.state.rev&&r,this.props.token?o.a.createElement(Le,{pid:this.state.info.pid,token:this.props.token,area_ref:this.reply_ref,on_complete:this.load_replies.bind(this)}):o.a.createElement("div",{className:"box box-tip flow-item"},"\u767b\u5f55\u540e\u53ef\u4ee5\u56de\u590d\u6811\u6d1e"))}}]),n}(a.PureComponent),Fe=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).needFold=e.info.cw&&-1==window.config.whitelist_cw.indexOf("*")&&-1==window.config.whitelist_cw.indexOf(e.info.cw)&&"list"===e.mode,a.has_block_words=Re(e.info),a.color_picker=new k,a.state={replies:e.info.comments?xe(e.info.comments,a.color_picker):[],reply_status:"done",reply_error:null,info:Object.assign({},e.info,{variant:{}}),attention:e.info.attention,cached:!0},a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.props.info.comments||this.load_replies(null,!1)}},{key:"load_replies",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.setState({reply_status:"loading",reply_error:null}),Oe.load_replies_with_cache(this.state.info.pid,this.props.token,this.color_picker,parseInt(this.state.info.reply)).then((function(a){var o=a.data,r=a.cached;t.setState((function(e,t){return{replies:o.data,info:Object.assign({},e.info,{reply:n?""+o.data.length:e.info.reply,variant:o.data.length?{latest_reply:Math.max.apply(null,o.data.map((function(e){return parseInt(e.timestamp)})))}:{}}),attention:!!o.attention,reply_status:"done",reply_error:null,cached:r}}),e)})).catch((function(n){console.error(n),t.setState({replies:[],reply_status:"failed",reply_error:""+n},e)}))}},{key:"show_sidebar",value:function(){this.props.show_sidebar("\u6811\u6d1e #"+this.state.info.pid,o.a.createElement(We,{key:+new Date,info:this.state.info,search_param:this.props.search_param,replies:this.state.replies,attention:this.state.attention,sync_state:this.setState.bind(this),token:this.props.token,show_sidebar:this.props.show_sidebar,color_picker:this.color_picker,deletion_detect:this.props.deletion_detect}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.show_sidebar,a=t.token,r=t.search_param,s=t.is_quote,i=t.mode,c=Ke(n,a,this.state.info.pid),l=[["pid",E]],u=j(this.state.info.text,l),d=null;if(!s){var h,_=Object(m.a)(u);try{for(_.s();!(h=_.n()).done;){var f=Object(p.a)(h.value,2),b=f[0],g=f[1];if(g=g.length>0?g.substring(1):g,"pid"===b&&-1===De.indexOf(g)&&parseInt(g)<parseInt(this.state.info.pid)){if(null!==d){d=null;break}d=parseInt(g)}}}catch(w){_.e(w)}finally{_.f()}}var v=o.a.createElement("div",{className:"flow-item-row flow-item-row-with-prompt"+(s?" flow-item-row-quote":""),onClick:function(t){Ae[t.target.tagName.toLowerCase()]||e.show_sidebar()}},o.a.createElement(Be,{info:this.state.info,attention:this.state.attention,img_clickable:!1,is_quote:this.props.is_quote,color_picker:this.color_picker,show_pid:c,replies:this.state.replies,cached:this.state.cached,search_param:r}),o.a.createElement("div",{className:"flow-reply-row"},"loading"===this.state.reply_status&&o.a.createElement("div",{className:"box box-tip"},"\u52a0\u8f7d\u4e2d"),"failed"===this.state.reply_status&&o.a.createElement("div",{className:"box box-tip"},o.a.createElement("p",null,o.a.createElement("a",{onClick:function(){e.load_replies()}},"\u91cd\u65b0\u52a0\u8f7d\u8bc4\u8bba")),o.a.createElement("p",null,this.state.reply_error)),this.state.replies.slice(0,10).map((function(t){return(t.can_del||!t.is_blocked)&&o.a.createElement(Me,{key:t.cid,info:t,color_picker:e.color_picker,show_pid:c,search_param:r})})),this.state.replies.length>10&&o.a.createElement("div",{className:"box box-tip"},"\u8fd8\u6709 ",this.state.replies.length-10," \u6761")));return this.needFold||this.has_block_words?(!this.has_block_words||"list"!==i)&&o.a.createElement("div",{className:"flow-item-row flow-item-row-with-prompt",onClick:function(t){Ae[t.target.tagName.toLowerCase()]||e.show_sidebar()}},o.a.createElement("div",{className:"flow-item"+(this.props.is_quote?" flow-item-quote":"")},!!this.props.is_quote&&o.a.createElement("div",{className:"quote-tip black-outline"},o.a.createElement("div",null,o.a.createElement("span",{className:"icon icon-quote"}))),o.a.createElement("div",{className:"box"},o.a.createElement("div",{className:"box-header"},!!this.props.do_filter_name&&o.a.createElement("span",{className:"reply-header-badge clickable",onClick:function(){e.props.do_filter_name("\u6d1e\u4e3b")}},o.a.createElement("span",{className:"icon icon-locate"})),o.a.createElement("code",{className:"box-id"},"#",this.props.info.pid),"\xa0",this.props.info.author_title&&o.a.createElement("span",{className:"box-header-name author-title"},'"'.concat(this.props.info.author_title,'"')),this.props.info.is_tmp&&o.a.createElement("span",{className:"box-header-name tmp-title"},"\u4e34\u65f6\u8d26\u53f7"),null!==this.props.info.cw&&o.a.createElement("span",{className:"box-header-cw"},this.props.info.cw),o.a.createElement(M,{stamp:this.props.info.timestamp,short:!0}),o.a.createElement("span",{className:"box-header-badge"},this.needFold?"\u5df2\u6298\u53e0":"\u5df2\u5c4f\u853d"),o.a.createElement("div",{style:{clear:"both"}}))))):d?o.a.createElement("div",null,v,o.a.createElement(qe,{pid:d,show_sidebar:this.props.show_sidebar,token:this.props.token,deletion_detect:this.props.deletion_detect})):v}}]),n}(a.PureComponent),qe=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={loading_status:"empty",error_msg:null,info:null},a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){var e=this;this.setState({loading_status:"loading"},(function(){Oe.get_single(e.props.pid,e.props.token).then((function(t){e.setState({loading_status:"done",info:t.data})})).catch((function(t){-1!==(""+t).indexOf("\u6ca1\u6709\u8fd9\u6761\u6811\u6d1e")?e.setState({loading_status:"empty"}):e.setState({loading_status:"error",error_msg:""+t})}))}))}},{key:"render",value:function(){return"empty"===this.state.loading_status?null:"loading"===this.state.loading_status?o.a.createElement("div",{className:"aux-margin"},o.a.createElement("div",{className:"box box-tip"},o.a.createElement("span",{className:"icon icon-loading"}),"\u63d0\u5230\u4e86 #",this.props.pid)):"error"===this.state.loading_status?o.a.createElement("div",{className:"aux-margin"},o.a.createElement("div",{className:"box box-tip"},o.a.createElement("p",null,o.a.createElement("a",{onClick:this.load.bind(this)},"\u91cd\u65b0\u52a0\u8f7d")),o.a.createElement("p",null,this.state.error_msg))):o.a.createElement(Fe,{info:this.state.info,mode:this.props.mode,show_sidebar:this.props.show_sidebar,token:this.props.token,is_quote:!0,deletion_detect:this.props.deletion_detect})}}]),n}(a.PureComponent);function ze(e){return o.a.createElement(Ce.Consumer,null,(function(t){var n=t.value;return o.a.createElement("div",{className:"flow-chunk"},!!e.title&&o.a.createElement(B,{text:e.title}),e.list.map((function(t,a){return(t.can_del||!t.is_blocked)&&o.a.createElement(ve.a,{key:t.key||t.pid,offset:500,height:"15em",hiddenIfInvisible:!1},o.a.createElement("div",null,!!(e.deletion_detect&&"list"===e.mode&&a&&e.list[a-1].pid-t.pid>1)&&o.a.createElement("div",{className:"flow-item-row"},o.a.createElement("div",{className:"box box-tip flow-item box-danger"},e.list[a-1].pid-t.pid-1," \u6761\u88ab\u5220\u9664")),o.a.createElement(Fe,{info:t,mode:e.mode,show_sidebar:e.show_sidebar,token:n,deletion_detect:e.deletion_detect,search_param:e.search_param})))})))}))}var He=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(i.a)(this,n),a=t.call(this,e);var o=window[e.mode.toUpperCase()+"_SUBMODE_BACKUP"];return void 0===o&&(o="list"===e.mode&&window.config.by_c?1:0),a.state={submode:o},a}return Object(c.a)(n,[{key:"get_submode_names",value:function(e){switch(e){case"list":return["\u6700\u65b0","\u6700\u8fd1\u56de\u590d","\u8fd1\u671f\u70ed\u95e8","\u968f\u673a"];case"attention":return["\u7ebf\u4e0a\u5173\u6ce8","\u672c\u5730\u6536\u85cf"];case"search":return["Tag\u641c\u7d22","\u5168\u6587\u641c\u7d22","\u5934\u8854"]}return[]}},{key:"set_submode",value:function(e){window[this.props.mode.toUpperCase()+"_SUBMODE_BACKUP"]=e,this.setState({submode:e})}},{key:"render",value:function(){var e=this,t=this.state.submode,n=this.get_submode_names(this.props.mode);return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"aux-margin flow-submode-choice"},n.map((function(n,a){return o.a.createElement("a",{key:a,className:t===a?"choiced":"",onClick:e.set_submode.bind(e,a)},n)}))),o.a.createElement(Je,{key:t,show_sidebar:this.props.show_sidebar,mode:this.props.mode,submode:t,search_text:this.props.search_text,token:this.props.token}))}}]),n}(a.PureComponent),Je=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={mode:e.mode,search_param:e.search_text,loaded_pages:0,chunks:{title:"",data:[]},local_attention_text:null,loading_status:"done",error_msg:null},a.on_scroll_bound=a.on_scroll.bind(Object(l.a)(a)),window.LATEST_POST_ID=parseInt(localStorage._LATEST_POST_ID,10)||0,a}return Object(c.a)(n,[{key:"load_page",value:function(e){var t=this,n=function(e){console.error(e),t.setState((function(t,n){return{loaded_pages:t.loaded_pages-1,loading_status:"failed",error_msg:""+e}}))};if(e>this.state.loaded_pages+1)throw new Error("bad page");if(e===this.state.loaded_pages+1){var a=this.state,o=a.mode,r=a.search_param,s=this.props,i=s.token,c=s.submode;if(console.log("fetching page",e),Ee(),"list"===o)Oe.get_list(e,i,c).then((function(n){if(1===e&&n.data.length){var a=window.LATEST_POST_ID||-1;n.data.forEach((function(e){parseInt(e.pid,10)>a&&(a=parseInt(e.pid,10))})),localStorage._LATEST_POST_ID=""+a}window.TITLE=n.custom_title,window.AUTO_BLCOK=n.auto_block_rank,n.data.forEach((function(e){if(e.comments){var t={code:0,attention:e.attention,data:e.comments};Ee().put(e.pid,parseInt(e.reply,10),t)}})),t.setState((function(e,t){return{chunks:{title:"News Feed",data:e.chunks.data.concat(n.data.filter((function(t){return 0===e.chunks.data.length||!e.chunks.data.slice(-100).some((function(e){return e.pid===t.pid}))})))},loading_status:"done"}}))})).catch(n);else if("search"===o&&r)Oe.get_search(e,r,i,c).then((function(e){var n=0===e.data.length;t.setState((function(t,a){return{chunks:{title:'Result for "'+r+'"',data:t.chunks.data.concat(e.data)},mode:n?"search_finished":"search",loading_status:"done"}}))})).catch(n);else if("single"===o){var l=parseInt(this.state.search_param.substr(1),10);Oe.get_single(l,this.props.token).then((function(e){var n=e.data;if(n.comments){var a={code:0,attention:n.attention,data:n.comments};Ee().put(n.pid,parseInt(n.reply,10),a)}t.setState({chunks:{title:"PID = "+l,data:[e.data]},mode:"single_finished",loading_status:"done"})})).catch(n)}else{if("attention"!==o)return void console.log("nothing to load");var u=!!this.state.search_param,d=u&&!!this.state.search_param.match(/\/.+\//),p=/.+/;if(d)try{p=new RegExp(this.state.search_param.slice(1,-1))}catch(_){alert("\u8bf7\u68c0\u67e5\u6b63\u5219\u8868\u8fbe\u5f0f\u5408\u6cd5\u6027\uff01\n".concat(_)),p=/.+/}if(console.log(u,d),0===this.props.submode)Oe.get_attention(this.props.token).then((function(e){t.setState({chunks:{title:"".concat(u?d?"Result for RegEx ".concat(p.toString()," in "):'Result for "'.concat(t.state.search_param,'" in '):"","Attention List"),data:u?d?e.data.filter((function(e){return!!e.text.match(p)})):e.data.filter((function(e){return t.state.search_param.split(" ").every((function(t){return e.text.includes(t)}))})):e.data},mode:"attention_finished",loading_status:"done"}),u||(window.saved_attentions=Array.from(new Set([].concat(Object(h.a)(window.saved_attentions),Object(h.a)(e.data.map((function(e){return e.pid})))))).sort((function(e,t){return t-e})),Ne())})).catch(n);else if(1===this.props.submode){var m=window.saved_attentions.sort((function(e,t){return t-e})).slice(50*(e-1),50*e);if(!m.length)return console.log("local attention finished"),void this.setState({loading_status:"done",mode:"attention_finished"});Oe.get_multi(m,this.props.token).then((function(e){e.data.forEach((function(e){if(e.comments){var t={code:0,attention:e.attention,data:e.comments};Ee().put(e.pid,parseInt(e.reply,10),t)}})),t.setState((function(t,n){return{chunks:{title:"Attention List: Local",data:t.chunks.data.concat(e.data)},loading_status:"done"}}))})).catch(n)}}this.setState((function(e,t){return{loaded_pages:e.loaded_pages+1,loading_status:"loading",error_msg:null}}))}}},{key:"on_scroll",value:function(e){e.target===document&&(document.body.scrollHeight-window.scrollY-window.innerHeight<window.innerHeight&&"done"===this.state.loading_status&&this.load_page(this.state.loaded_pages+1))}},{key:"componentDidMount",value:function(){this.load_page(1),window.addEventListener("scroll",this.on_scroll_bound),window.addEventListener("resize",this.on_scroll_bound)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.on_scroll_bound),window.removeEventListener("resize",this.on_scroll_bound)}},{key:"trunc_string",value:function(e,t){return e.substr(0,t)+(e.length>t?"...":"")}},{key:"gen_export",value:function(){this.setState({can_export:!1,local_attention_text:JSON.parse(localStorage.saved_attentions||"[]").map((function(e){return"#".concat(e)})).join(" ")})}},{key:"render",value:function(){var e=this,t="on"===localStorage.DELETION_DETECT,n=this.state,a=n.mode,r=n.chunks,s=n.local_attention_text,i=n.search_param;return o.a.createElement("div",{className:"flow-container"},"attention"===a&&1===this.props.submode&&null===s&&o.a.createElement("button",{className:"export-btn",type:"button",onClick:this.gen_export.bind(this)},"\u5bfc\u51fa/\u5bfc\u5165"),s&&o.a.createElement(Ze,{init_text:s}),o.a.createElement(ze,{title:r.title,list:r.data,mode:a,search_param:i||null,show_sidebar:this.props.show_sidebar,deletion_detect:t}),"failed"===this.state.loading_status&&o.a.createElement("div",{className:"aux-margin"},o.a.createElement("div",{className:"box box-tip"},o.a.createElement("p",null,o.a.createElement("a",{onClick:function(){e.load_page(e.state.loaded_pages+1)}},"\u91cd\u65b0\u52a0\u8f7d")),o.a.createElement("p",null,this.state.error_msg))),o.a.createElement(B,{text:"loading"===this.state.loading_status?o.a.createElement("span",null,o.a.createElement("span",{className:"icon icon-loading"}),"\xa0Loading..."):"\ud83c\udd2f 2020 copyleft: hole_thu"}))}}]),n}(a.PureComponent);function Ze(e){var t=Object(a.useState)(e.init_text),n=Object(p.a)(t,2),r=n[0],s=n[1],i=/#(\d+)/g;return o.a.createElement("div",{className:"box"},o.a.createElement("textarea",{className:"export-textarea",value:r,onChange:function(e){return s(e.target.value)}}),o.a.createElement("button",{className:"export-btn",type:"button",onClick:function(){var e=Object(h.a)(r.matchAll(i)).map((function(e){return parseInt(e[1])})).sort((function(e,t){return t-e}));console.log(e),window.saved_attentions=e,Ne(),s(e.map((function(e){return"#".concat(e)})).join(" "))}},"\u4fdd\u5b58"))}n(439);var Ye=/^\/\/setflag ([a-zA-Z0-9_]+)=(.*)$/,Xe=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={search_text:""},a.set_mode=e.set_mode,a.on_change_bound=a.on_change.bind(Object(l.a)(a)),a.on_keypress_bound=a.on_keypress.bind(Object(l.a)(a)),a.do_refresh_bound=a.do_refresh.bind(Object(l.a)(a)),a.do_attention_bound=a.do_attention.bind(Object(l.a)(a)),a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this;if(window.location.hash){var t=decodeURIComponent(window.location.hash).substr(1);-1!==t.lastIndexOf("?")&&(t=t.substr(0,t.lastIndexOf("?"))),this.setState({search_text:t},(function(){e.on_keypress({key:"Enter"})}))}window.addEventListener("hashchange",(function(){var t=decodeURIComponent(window.location.hash).substr(1);t&&"#"!=t[0]&&(console.log("search",t),e.setState({search_text:t},(function(){e.on_keypress({key:"Enter"})})))}),!1)}},{key:"on_change",value:function(e){this.setState({search_text:e.target.value})}},{key:"on_keypress",value:function(e){if("Enter"===e.key){var t=Ye.exec(this.state.search_text);if(t)return void(t[2]?(localStorage[t[1]]=t[2],alert("Set Flag "+t[1]+"="+t[2]+"\nYou may need to refresh this webpage.")):(delete localStorage[t[1]],alert("Clear Flag "+t[1]+"\nYou may need to refresh this webpage.")));var n=this.state.search_text.startsWith("#")?"single":"attention"!==this.props.mode?"search":"attention";this.set_mode(n,this.state.search_text||"")}}},{key:"do_refresh",value:function(){window.scrollTo(0,0),this.setState({search_text:""}),this.set_mode("list",null),window.location.hash=""}},{key:"do_attention",value:function(){window.scrollTo(0,0),this.setState({search_text:""}),this.set_mode("attention",null)}},{key:"render",value:function(){var e=this;return o.a.createElement(Ce.Consumer,null,(function(t){var n=t.value;return o.a.createElement("div",{className:"control-bar"},o.a.createElement("a",{className:"no-underline control-btn",onClick:e.do_refresh_bound},o.a.createElement("span",{className:"icon icon-refresh"}),o.a.createElement("span",{className:"control-btn-label"},"\u5237\u65b0")),!!n&&o.a.createElement("a",{className:"no-underline control-btn",onClick:e.do_attention_bound},o.a.createElement("span",{className:"icon icon-attention"}),o.a.createElement("span",{className:"control-btn-label"},"\u5173\u6ce8")),o.a.createElement("input",{className:"control-search",value:e.state.search_text,placeholder:"attention"===e.props.mode?"\u5728\u5173\u6ce8\u5217\u8868\u4e2d\u641c\u7d22":"\u5173\u952e\u8bcd / tag / #\u6811\u6d1e\u53f7",onChange:e.on_change_bound,onKeyPress:e.on_keypress_bound}),o.a.createElement("a",{className:"no-underline control-btn",onClick:function(){e.props.show_sidebar("\u65b0T\u6811\u6d1e",o.a.createElement(Te,{show_sidebar:e.props.show_sidebar}))}},o.a.createElement("span",{className:"icon icon-"+(n?"about":"login")}),o.a.createElement("span",{className:"control-btn-label"},n?"\u8d26\u6237":"\u767b\u5f55")),!!n&&o.a.createElement("a",{className:"no-underline control-btn",onClick:function(){e.props.show_sidebar("\u53d1\u8868\u6811\u6d1e",o.a.createElement(Ue,{token:n,on_complete:function(){e.props.show_sidebar(null,null,"clear"),e.do_refresh()}}))}},o.a.createElement("span",{className:"icon icon-plus"}),o.a.createElement("span",{className:"control-btn-label"},"\u53d1\u8868")))}))}}]),n}(a.PureComponent);function Ve(e){return o.a.createElement("div",{className:"title-bar"},o.a.createElement("div",{className:"aux-margin"},o.a.createElement("div",{className:"title"},o.a.createElement("p",{className:"centered-line"},o.a.createElement("span",{onClick:function(){return e.show_sidebar("\u65b0T\u6811\u6d1e",o.a.createElement(Te,{show_sidebar:e.show_sidebar}))}},"\u65b0T\u6811\u6d1e"))),o.a.createElement(Xe,{show_sidebar:e.show_sidebar,set_mode:e.set_mode,mode:e.mode})))}n(440);var $e=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).do_close_bound=a.do_close.bind(Object(l.a)(a)),a.do_back_bound=a.do_back.bind(Object(l.a)(a)),a}return Object(c.a)(n,[{key:"do_close",value:function(){this.props.show_sidebar(null,null,"clear")}},{key:"do_back",value:function(){this.props.show_sidebar(null,null,"pop")}},{key:"render",value:function(){var e=this,t=this.props.stack.map((function(t,n){var a=t[1];return a&&o.a.createElement("div",{key:n,className:"sidebar-content "+(n===e.props.stack.length-1?"sidebar-content-show":"sidebar-content-hide")},a)})),n=this.props.stack[this.props.stack.length-1][0];return o.a.createElement("div",{className:"sidebar-container "+(null!==n?"sidebar-on":"sidebar-off")},o.a.createElement("div",{className:"sidebar-shadow",onClick:this.do_back_bound,onTouchEnd:function(e){e.preventDefault(),e.target.click()}}),o.a.createElement("div",{className:"sidebar"},t),o.a.createElement("div",{className:"sidebar-title"},o.a.createElement("a",{className:"no-underline",onClick:this.do_close_bound},"\xa0",o.a.createElement("span",{className:"icon icon-close"}),"\xa0"),this.props.stack.length>2&&o.a.createElement("a",{className:"no-underline",onClick:this.do_back_bound},"\xa0",o.a.createElement("span",{className:"icon icon-back"}),"\xa0"),n))}}]),n}(a.PureComponent),Ge=n(80),Qe=n.n(Ge),et=(n(441),function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={level:0,fired:!1},a.callback=e.callback,a.esc_interval=null,a}return Object(c.a)(n,[{key:"do_fire",value:function(){var e=this;this.esc_interval&&(clearInterval(this.esc_interval),this.esc_interval=null),this.setState({level:1,fired:!0}),this.callback(),window.setTimeout((function(){e.setState({level:0,fired:!1})}),300)}},{key:"componentDidMount",value:function(){var e=this;window.config.pressure&&(Qe.a.set(document.body,{change:function(t){e.state.fired||(t>=.999?e.do_fire():e.setState({level:t}))},end:function(){e.setState({level:0,fired:!1})}},{polyfill:!1,only:"touch",preventSelect:!1}),document.addEventListener("keydown",(function(t){t.repeat||"Escape"!==t.key||(e.esc_interval&&clearInterval(e.esc_interval),e.setState({level:.2},(function(){e.esc_interval=setInterval((function(){var t=e.state.level+.1;t>=.999?e.do_fire():e.setState({level:t})}),30)})))})),document.addEventListener("keyup",(function(t){"Escape"===t.key&&(e.esc_interval&&(clearInterval(e.esc_interval),e.esc_interval=null),e.setState({level:0}))})))}},{key:"render",value:function(){var e=25*(this.state.level-.4)-500;return o.a.createElement("div",{className:"pressure-box"+(this.state.fired?" pressure-box-fired":"")+(this.state.level<=1e-4?" pressure-box-empty":""),style:{left:e,right:e,top:e,bottom:e}})}}]),n}(a.Component));function tt(e){return o.a.createElement("div",{id:"global-hint-container",style:{display:"none"}})}var nt=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),a=t.call(this,e),Y(),window.saved_attentions=JSON.parse(localStorage.saved_attentions||"[]"),window.AS_BACKUP=!!localStorage.DEFAULT_ALLOW_SEARCH,function(e){function t(){(void 0===e?window.matchMedia("(prefers-color-scheme: dark)").matches:e)?document.body.classList.add("root-dark-mode"):document.body.classList.remove("root-dark-mode")}t(),window.matchMedia("(prefers-color-scheme: dark)").addListener((function(){t()}))}({default:void 0,light:!1,dark:!0}[window.config.color_scheme]),a.state={sidebar_stack:[[null,null]],mode:"list",search_text:null,flow_render_key:+new Date,token:localStorage.TOKEN||null},a.show_sidebar_bound=a.show_sidebar.bind(Object(l.a)(a)),a.set_mode_bound=a.set_mode.bind(Object(l.a)(a)),a.on_pressure_bound=a.on_pressure.bind(Object(l.a)(a)),a}return Object(c.a)(n,[{key:"on_pressure",value:function(){this.state.sidebar_stack.length>1?this.show_sidebar(null,null,"clear"):this.set_mode("list",null)}},{key:"show_sidebar",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"push";this.setState((function(a){var o=a.sidebar_stack.slice();if("push"===n)1===o.length&&(document.body.style.top="-".concat(window.scrollY,"px"),document.body.style.position="fixed",document.body.style.width="100vw"),o.length>10&&o.splice(1,1),o=o.concat([[e,t]]);else if("pop"===n){if(1===o.length)return;if(2===o.length){var r=document.body.style.top;document.body.style.position="",document.body.style.top="",document.body.style.width="",window.scrollTo(0,-1*parseInt(r||"0"))}o.pop()}else if("replace"===n)o.pop(),o=o.concat([[e,t]]);else{if("clear"!==n)throw new Error("bad show_sidebar mode");var s=document.body.style.top;document.body.style.position="",document.body.style.top="",document.body.style.width="",window.scrollTo(0,-1*parseInt(s||"0")),o=[[null,null]]}return{sidebar_stack:o}}))}},{key:"set_mode",value:function(e,t){this.setState({mode:e,search_text:t,flow_render_key:+new Date})}},{key:"render",value:function(){var e=this;return o.a.createElement(Ce.Provider,{value:{value:this.state.token,set_value:function(t){localStorage.TOKEN=t||"",e.setState({token:t})}}},o.a.createElement(et,{callback:this.on_pressure_bound}),o.a.createElement("div",{className:"bg-img",style:V()}),o.a.createElement(Ve,{show_sidebar:this.show_sidebar_bound,set_mode:this.set_mode_bound,mode:this.state.mode}),o.a.createElement(Ce.Consumer,null,(function(t){return o.a.createElement("div",{className:"left-container"},o.a.createElement(tt,{token:t.value}),!t.value&&o.a.createElement("div",{className:"flow-item-row aux-margin"},o.a.createElement("div",{className:"box box-tip"},o.a.createElement(q,{token_callback:t.set_value},(function(e){return o.a.createElement("a",{onClick:e},o.a.createElement("span",{className:"icon icon-login"}),"\xa0\u767b\u5f55\u5230 \u65b0T\u6811\u6d1e")})))),t.value?o.a.createElement(He,{key:e.state.flow_render_key,show_sidebar:e.show_sidebar_bound,mode:e.state.mode,search_text:e.state.search_text,token:t.value}):o.a.createElement(B,{text:"\u8bf7\u767b\u5f55\u540e\u67e5\u770b\u5185\u5bb9"}),o.a.createElement("br",null))})),o.a.createElement($e,{show_sidebar:this.show_sidebar_bound,stack:this.state.sidebar_stack}))}}],[{key:"is_darkmode",value:function(){return"dark"===window.config.color_scheme||"light"!==window.config.color_scheme&&window.matchMedia("(prefers-color-scheme: dark)").matches}}]),n}(a.Component),at=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ot(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}s.a.render(o.a.createElement(nt,null),document.getElementById("root")),"serviceWorker"in navigator&&window.addEventListener("load",(function(){var e="".concat(".","/service-worker.js");at?(function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ot(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):ot(e)}))},81:function(e,t,n){e.exports=n(442)},86:function(e,t,n){},87:function(e,t,n){},92:function(e,t,n){},93:function(e,t,n){}},[[81,1,2]]]);
//# sourceMappingURL=main.4d984748.chunk.js.map